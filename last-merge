commit 97104f1bb7a2f7e7eb11b312b4180dd386e1efa3
Merge: 86f7483 3f78f63
Author: Coder <coder@Commanders-MBP.Home>
Date:   Mon Mar 17 19:03:38 2025 +0000

    Merge remote-tracking branch 'upstream/master' into merging-master

diff --cc Help/gettingstarted.html
index a798380,4b3d539..c4c3cb2
--- a/Help/gettingstarted.html
+++ b/Help/gettingstarted.html
@@@ -141,26 -141,10 +141,26 @@@
          image. See the <a href="tapes.html">Tape Images</a> section for more
          info.
        </p>
 -    </main>
 +      <h2>
 +        Apple Mac
 +      </h2>
 +      <p>
 +        On Mac...
 +      </p>
 +	  <figure>
 +		<img src="startup-mac.png" alt="BeebEm Startup Image" width="642" height="564">
 +	  </figure>
 +	  
 +	  <h2>Downloading disc images</h2>
 +	  <p>
 +		When you download a disc image file (and unzipped it if necessary) put
 +		the image file into the <span class="file">DiscIms</span> folder within your
 +		<span class="file">Documents/BeebEm</span> folder. Do NOT put disc
 +		images in the folders under <span class="file">~/Library/Application Support/BeebEm-mac/UserData</span>.
 +	  </p>    </main>
  
      <footer>
-       <p>Copyright &copy; 2024 BeebEm contributors</p>
+       <p>Copyright &copy; 2025 BeebEm contributors</p>
      </footer>
    </body>
  </html>
diff --cc Src/6502core.cpp
index 4876600,52f9049..d1344f1
--- a/Src/6502core.cpp
+++ b/Src/6502core.cpp
@@@ -1395,12 -1392,8 +1392,8 @@@ static void ClipboardREMVHandler(
  	{
  		// Examine buffer state
  
- #ifndef __APPLE__
  		if (mainWin->m_ClipboardIndex < mainWin->m_ClipboardLength)
- #else
- 		if (mainWin->m_ClipboardIndex < mainWin->m_ClipboardBuffer.size())
- #endif
 -		{
 +			{
  			Accumulator = mainWin->m_ClipboardBuffer[mainWin->m_ClipboardIndex];
  			PSR &= ~FlagC;
  		}
diff --cc Src/AviWriter.cpp
index 6de54be,3ede3f9..7de4d96
--- a/Src/AviWriter.cpp
+++ b/Src/AviWriter.cpp
@@@ -25,21 -25,18 +25,19 @@@ Boston, MA  02110-1301, USA
  //
  
  #include <windows.h>
 +#ifndef __APPLE__
  #include <mmreg.h>
- #include "AviWriter.h"
- #else
- #include "AVIWriter.h"
 -
 +#endif
+ #include "AviWriter.h"
  
  /*--------------------------------------------------------------------------*/
  
- AVIWriter *aviWriter = nullptr;
+ AviWriter *aviWriter = nullptr;
  
  /*--------------------------------------------------------------------------*/
 -
 +#ifndef __APPLE__
- AVIWriter::AVIWriter() :
- 	m_pAVIFile(nullptr),
+ AviWriter::AviWriter() :
+ 	m_pAviFile(nullptr),
  	m_pAudioStream(nullptr),
  	m_pCompressedAudioStream(nullptr),
  	m_pVideoStream(nullptr),
diff --cc Src/AviWriter.h
index 4edb4ce,49511b0..f45e38f
--- a/Src/AviWriter.h
+++ b/Src/AviWriter.h
@@@ -31,12 -31,12 +31,13 @@@ Boston, MA  02110-1301, USA
  
  #include "BeebWin.h"
  
- class AVIWriter
+ class AviWriter
  {
  public:
- 	AVIWriter();
- 	virtual ~AVIWriter();
+ 	AviWriter();
+ 	virtual ~AviWriter();
 -
++	
 +#ifndef __APPLE__
  	// Open file
  	HRESULT Initialise(const CHAR *psFileName,
  	                   const WAVEFORMATEX *WaveFormat,
@@@ -63,9 -63,9 +64,10 @@@ private
  	LPVOID m_lastVideoFrame;
  	int m_videoBufferSize;
  	LONG m_nFrame;
 +#endif
  };
  
- extern AVIWriter *aviWriter;
+ extern AviWriter *aviWriter;
  
  #endif
+ 
diff --cc Src/BeebMem.cpp
index 8e1f299,a27e15f..2a01361
--- a/Src/BeebMem.cpp
+++ b/Src/BeebMem.cpp
@@@ -1230,14 -1229,18 +1229,30 @@@ static bool ReadRom(const std::string& 
  
  			// Read PAL ROM:
  			fseek(File, 0L, SEEK_SET);
- 			fread(PALRom[Bank].Rom, 1, Size, File);
+ 			BytesRead = fread(PALRom[Bank].Rom, 1, Size, File);
  			fclose(File);
  
+ 			if (BytesRead != (size_t)Size)
+ 			{
+ 				mainWin->Report(MessageType::Error,
+ 				                "Failed to read ROM file:\n %s", RomFileName.c_str());
+ 
+ 				return false;
+ 			}
+ 
++			if (BytesRead != (size_t)Size)
++			{
++				mainWin->Report(MessageType::Error,
++				                "Failed to read ROM file:\n %s", RomFileName.c_str());
++
++				return false;
++			}
++
 +#ifndef __APPLE__
  			PALRom[Bank].Type = GuessRomType(PALRom[Bank].Rom, Size);
 +#else
 +			PALRom[Bank].Type = GuessRomType(PALRom[Bank].Rom, (uint32_t)Size);
 +#endif
  
  			if (PALRom[Bank].Type != PALRomType::none)
  			{
diff --cc Src/BeebWin.cpp
index 140545f,79155fa..b623581
--- a/Src/BeebWin.cpp
+++ b/Src/BeebWin.cpp
@@@ -46,12 -46,12 +46,14 @@@ Boston, MA  02110-1301, USA
  #include <array>
  #include <string>
  
++#ifndef __APPLE__
  #pragma warning(push)
  #pragma warning(disable: 4458) // declaration of 'xxx' hides class member
  using std::min;
  using std::max;
  #include <gdiplus.h>
  #pragma warning(pop)
++#endif
  
  #include "BeebWin.h"
  #include "6502core.h"
@@@ -111,15 -113,7 +115,7 @@@
  // Some LED based constants
  constexpr int LED_COL_BASE = 64;
  
- #ifndef __APPLE__
--static const char *CFG_REG_KEY = "Software\\BeebEm";
- 
- static const unsigned char CFG_DISABLE_WINDOWS_KEYS[24] = {
- 	00,00,00,00,00,00,00,00,03,00,00,00,00,00,0x5B,0xE0,00,00,0x5C,0xE0,00,00,00,00
- };
- #endif
++//static const char *CFG_REG_KEY = "Software\\BeebEm";
  
  CArm *arm = nullptr;
  CSprowCoPro *sprow = nullptr;
@@@ -266,35 -262,23 +266,36 @@@ BeebWin::BeebWin(
  
  	// File paths
  
 +#ifndef __APPLE__
  	// Get the applications path - used for non-user files
- 	char AppPath[_MAX_PATH];
- 	char AppDrive[_MAX_DRIVE];
- 	char AppDir[_MAX_DIR];
- 	GetModuleFileName(nullptr, AppPath, _MAX_PATH);
- 	_splitpath(AppPath, AppDrive, AppDir, nullptr, nullptr);
- 	_makepath(m_AppPath, AppDrive, AppDir, nullptr, nullptr);
+ 	char AppPath[MAX_PATH];
+ 	GetModuleFileName(nullptr, AppPath, MAX_PATH);
+ 	GetPathFromFileName(AppPath, m_AppPath, MAX_PATH);
 -
 +#else
 +	// Resources for the APP are in the bundle directory
- 	swift_GetBundleDirectory(m_AppPath, _MAX_PATH);
++	swift_GetBundleDirectory(m_AppPath, MAX_PATH);
 +#endif
  	// Read user data path from registry
  	if (!RegGetStringValue(HKEY_CURRENT_USER, CFG_REG_KEY, "UserDataFolder",
- 	                       m_UserDataPath, _MAX_PATH))
+ 	                       m_UserDataPath, MAX_PATH))
  	{
  		// Default user data path to a sub-directory in My Docs
- 		if (SHGetFolderPath(NULL, CSIDL_PERSONAL, NULL, SHGFP_TYPE_CURRENT, m_UserDataPath) == NOERROR)
+ 		if (SHGetFolderPath(NULL,
+ 		                    CSIDL_PERSONAL,
+ 		                    NULL,
+ 		                    SHGFP_TYPE_CURRENT,
+ 		                    m_UserDataPath) == NOERROR)
  		{
 +#ifndef __APPLE__
- 			strcat(m_UserDataPath, "\\BeebEm\\");
+ 			AppendPath(m_UserDataPath, "BeebEm");
 +#else
 +			// m_UserDataPath is either
 +			// 'BeebEm-mac' sub-directory in Application Support Directory
 +			// or
 +			// 'BeebEm' sub-directory in Documents Directory
 +            // or
 +            // a folder selected by the user from IDM_SELECT_USER_DATA_FOLDER
 +#endif
  		}
  	}
  
@@@ -463,10 -456,17 +474,17 @@@ bool BeebWin::Initialise(
  		Report(MessageType::Error, "WSA initialisation failed");
  		return false;
  	}
 -
 +#endif
+ 	if (!InitClass())
+ 	{
+ 		return false;
+ 	}
+ 
+ 	if (!CreateBeebWindow())
+ 	{
+ 		return false;
+ 	}
  
- 	InitClass();
- 	CreateBeebWindow();
  	CreateBitmap();
  
  	m_hMenu = GetMenu(m_hWnd);
@@@ -653,11 -646,9 +664,11 @@@ BeebWin::~BeebWin(
  	if (m_hDCBitmap != NULL)
  		DeleteDC(m_hDCBitmap);
  
 +#ifndef __APPLE__
- 	GdiplusShutdown(m_gdiplusToken);
+ 	Gdiplus::GdiplusShutdown(m_gdiplusToken);
  
  	CoUninitialize();
 +#endif
  }
  
  /****************************************************************************/
@@@ -1194,9 -1204,8 +1231,9 @@@ bool BeebWin::InitClass(
  
  /****************************************************************************/
  
- void BeebWin::CreateBeebWindow()
+ bool BeebWin::CreateBeebWindow()
  {
 +#ifndef __APPLE__
  	int x = m_XWinPos;
  	int y = m_YWinPos;
  
@@@ -1246,7 -1263,8 +1291,9 @@@
  	UpdateWindow(m_hWnd); // Sends WM_PAINT message
  
  	SetWindowAttributes(false);
+ 
 +#endif
+ 	return true;
  }
  
  /****************************************************************************/
@@@ -1291,9 -1282,9 +1311,10 @@@ DWORD BeebWin::SetWindowStyle(DWORD Sty
  }
  
  /****************************************************************************/
+ 
  void BeebWin::FlashWindow()
  {
 +#ifndef __APPLE__
  	::FlashWindow(m_hWnd, TRUE);
  
  	MessageBeep(MB_ICONEXCLAMATION);
@@@ -1859,9 -1822,13 +1870,14 @@@ void BeebWin::UpdateSFXMenu(
  
  /****************************************************************************/
  
+ static const unsigned char CFG_DISABLE_WINDOWS_KEYS[24] =
+ {
+ 	00,00,00,00,00,00,00,00,03,00,00,00,00,00,0x5B,0xE0,00,00,0x5C,0xE0,00,00,00,00
+ };
+ 
  void BeebWin::DisableWindowsKeys()
  {
 +#ifndef __APPLE__
  	bool Reboot = false;
  
  	m_DisableKeysWindows = !m_DisableKeysWindows;
@@@ -3452,17 -3358,13 +3460,14 @@@ void BeebWin::SetWindowAttributes(bool 
  		m_XWinSize = xs;
  		m_YWinSize = ys;
  
 +#ifndef __APPLE__
- 		DWORD dwStyle = GetWindowLong(m_hWnd, GWL_STYLE);
- 		dwStyle &= ~WS_POPUP;
- 		dwStyle |= WS_OVERLAPPEDWINDOW;
- 		SetWindowLong(m_hWnd, GWL_STYLE, dwStyle);
+ 		DWORD Style = SetWindowStyle(WS_OVERLAPPEDWINDOW, WS_POPUP);
  
  		RECT Rect{ 0, 0, m_XWinSize, m_YWinSize };
- 		AdjustWindowRect(&Rect, dwStyle, TRUE);
+ 		AdjustWindowRect(&Rect, Style, TRUE);
  
  		SetWindowPos(m_hWnd,
- 		             HWND_TOP,
+ 		             HWND_NOTOPMOST,
  		             m_XWinPos,
  		             m_YWinPos,
  		             Rect.right - Rect.left,
@@@ -5225,36 -5124,38 +5249,46 @@@ void BeebWin::ParseCommandLine(
  
  			if (Data || CustomData)
  			{
- 				strcpy(m_UserDataPath, __argv[++i]);
+ 				++i;
  
- 				if (strcmp(m_UserDataPath, "-") == 0)
+ 				if (strlen(__argv[i]) < MAX_PATH)
  				{
- 					// Use app path
- 					strcpy(m_UserDataPath, m_AppPath);
- #ifndef __APPLE__
+ 					strcpy(m_UserDataPath, __argv[++i]);
+ 
+ 					if (strcmp(m_UserDataPath, "-") == 0)
+ 					{
+ 						// Use app path
+ 						strcpy(m_UserDataPath, m_AppPath);
 -						strcat(m_UserDataPath, "UserData\\");
 -					}
++	#ifndef __APPLE__
 +                    strcat(m_UserDataPath, "UserData\\");
- #else
++	#else
 +                    strcat(m_UserDataPath, "UserData/");
 +#endif
 +				}
- 				else
- 				{
- 					if (m_UserDataPath[strlen(m_UserDataPath) - 1] != '\\' &&
- 					    m_UserDataPath[strlen(m_UserDataPath) - 1] != '/')
+ 					else
  					{
- #ifndef __APPLE__
+ 						if (m_UserDataPath[strlen(m_UserDataPath) - 1] != '\\' &&
+ 							m_UserDataPath[strlen(m_UserDataPath) - 1] != '/')
+ 						{
 -							strcat(m_UserDataPath, "\\");
 -						}
++	#ifndef __APPLE__
 +                        strcat(m_UserDataPath, "\\");
- #else
++	#else
 +						strcat(m_UserDataPath, "/");
 +#endif
 +					}
- 				}
+ 					}
  
- 				if (CustomData) {
- 					m_CustomData = true;
+ 					if (CustomData)
+ 					{
+ 						m_CustomData = true;
+ 					}
+ 				}
+ 				else
+ 				{
+ 					Invalid = true;
  				}
  			}
- 			else if (_stricmp(__argv[i], "-Prefs") == 0)
+ 			else if (StrCaseCmp(__argv[i], "-Prefs") == 0)
  			{
  				m_PrefsFileName = __argv[++i];
  			}
@@@ -5714,12 -5664,9 +5799,12 @@@ bool BeebWin::CheckUserDataPath(bool Pe
  		{
  			// Use data dir installed with BeebEm
  			strcpy(m_UserDataPath, m_AppPath);
 +#ifndef __APPLE__
- 			strcat(m_UserDataPath, "UserData\\");
+ 			AppendPath(m_UserDataPath, "UserData");
 -
 +#else
 +			strcat(m_UserDataPath, "UserData/");
 +#endif
- 			store_user_data_path = true;
+ 			UpdateUserDataPath = true;
  		}
  		else
  		{
diff --cc Src/BeebWin.h
index 58ae965,3755ff4..501728e
--- a/Src/BeebWin.h
+++ b/Src/BeebWin.h
@@@ -251,19 -239,12 +239,19 @@@ public
  	void ApplyPrefs();
  	void Shutdown();
  
 +#ifndef __APPLE__
  	static LRESULT CALLBACK WndProc(HWND hWnd,
- 	                                  UINT nMessage,
- 	                                  WPARAM wParam,
- 	                                  LPARAM lParam);
+ 	                                UINT nMessage,
+ 	                                WPARAM wParam,
+ 	                                LPARAM lParam);
  
  	LRESULT WndProc(UINT nMessage, WPARAM wParam, LPARAM lParam);
 +	
 +#else
 +	LRESULT AppProc(UINT nMessage, WPARAM wParam, LPARAM lParam);
 +
 +#endif
 +
  
  	void UpdateModelMenu();
  	void SetSoundMenu(void);
@@@ -274,10 -255,7 +262,10 @@@
  	void SelectTube(TubeDevice Device);
  	void UpdateTubeMenu();
  	void SelectFDC();
 +#ifdef __APPLE__
 +	void SelectFDC(int FDC);
 +#endif
- 	void LoadFDC(char *DLLName, bool save);
+ 	bool LoadFDC(char *DLLName, bool Save);
  	void UpdateLEDMenu();
  	void SetDriveControl(unsigned char value);
  	unsigned char GetDriveControl(void);
@@@ -320,25 -290,17 +308,25 @@@
  	}
  
  	EightUChars *GetLinePtr(int y) {
 +#ifndef __APPLE__
- 		int d = (y*800)+ScreenAdjust;
+ 		int d = (y * 800) + ScreenAdjust;
 +#else
 +		long d = (y*800)+ScreenAdjust;
 +#endif
- 		if (d > (MAX_VIDEO_SCAN_LINES*800))
- 			return((EightUChars *)(m_screen+(MAX_VIDEO_SCAN_LINES*800)));
- 		return((EightUChars *)(m_screen + d));
+ 		if (d > MAX_VIDEO_SCAN_LINES * 800)
+ 			return (EightUChars *)(m_screen + MAX_VIDEO_SCAN_LINES * 800);
+ 		return (EightUChars *)(m_screen + d);
  	}
  
  	SixteenUChars *GetLinePtr16(int y) {
 +#ifndef __APPLE__
- 		int d = (y*800)+ScreenAdjust;
+ 		int d = (y * 800) + ScreenAdjust;
 +#else
 +		long d = (y*800)+ScreenAdjust;
 +#endif
- 		if (d > (MAX_VIDEO_SCAN_LINES*800))
- 			return((SixteenUChars *)(m_screen+(MAX_VIDEO_SCAN_LINES*800)));
- 		return((SixteenUChars *)(m_screen + d));
+ 		if (d > MAX_VIDEO_SCAN_LINES * 800)
+ 			return (SixteenUChars *)(m_screen + MAX_VIDEO_SCAN_LINES * 800);
+ 		return (SixteenUChars *)(m_screen + d);
  	}
  
  	HWND GethWnd() { return m_hWnd; }
diff --cc Src/BeebWinIo.cpp
index aebd68f,ee59192..b42645d
--- a/Src/BeebWinIo.cpp
+++ b/Src/BeebWinIo.cpp
@@@ -84,26 -77,20 +85,22 @@@ void BeebWin::SetImageName(const char *
  
  	const int maxMenuItemLen = 100;
  	char menuStr[maxMenuItemLen+1];
- 	char *fname = strrchr(DiscInfo[Drive].FileName, '\\');
- 	if (fname == NULL)
- 		fname = strrchr(DiscInfo[Drive].FileName, '/');
- 	if (fname == NULL)
- 		fname = DiscInfo[Drive].FileName;
- 	else
- 		fname++;
+ 
+ 	const char* FileName = GetFileNameFromPath(DiscInfo[Drive].FileName);
  
  	sprintf(menuStr, "Eject Disc %d: ", Drive);
- 	strncat(menuStr, fname, maxMenuItemLen-strlen(menuStr));
+ 	strncat(menuStr, FileName, maxMenuItemLen-strlen(menuStr));
  	menuStr[maxMenuItemLen] = '\0';
  
 +#ifndef __APPLE__
  	MENUITEMINFO mii = {0};
  	mii.cbSize = sizeof(mii);
  	mii.fMask = MIIM_STRING;
  	mii.fType = MFT_STRING;
  	mii.dwTypeData = menuStr;
+ 
  	SetMenuItemInfo(m_hMenu, Drive == 0 ? IDM_EJECTDISC0 : IDM_EJECTDISC1, FALSE, &mii);
 +#endif
  }
  
  /****************************************************************************/
@@@ -466,8 -451,7 +463,8 @@@ bool BeebWin::NewTape(char *FileName, i
  
  void BeebWin::SelectFDC()
  {
 +#ifndef __APPLE__
- 	char DefaultPath[_MAX_PATH];
+ 	char DefaultPath[MAX_PATH];
  	char FileName[256];
  	FileName[0] = '\0';
  
@@@ -1050,9 -950,8 +991,9 @@@ void BeebWin::UpdateVideoCaptureFrameSk
  
  void BeebWin::CaptureVideo()
  {
 +#ifndef __APPLE__
- 	char DefaultPath[_MAX_PATH];
- 	char FileName[_MAX_PATH];
+ 	char DefaultPath[MAX_PATH];
+ 	char FileName[MAX_PATH];
  	FileName[0] = '\0';
  
  	const char* filter = "AVI File (*.avi)\0*.avi\0";
@@@ -1217,21 -1173,22 +1218,28 @@@ void BeebWin::QuickLoad(
  	}
  }
  
+ /****************************************************************************/
+ 
  void BeebWin::QuickSave()
  {
- 	char FileName1[_MAX_PATH];
- 	char FileName2[_MAX_PATH];
+ 	char FileName1[MAX_PATH];
+ 	char FileName2[MAX_PATH];
 +#ifdef __APPLE__
- 	char DirName[_MAX_PATH];
++	char DirName[MAX_PATH];
 +	strcpy(DirName, m_UserDataPath);
 +	strcat(DirName, "BeebState");
 +#endif
  
  	// Bump old quicksave files down
  	for (int i = 1; i <= 9; ++i)
  	{
+ 		char FileName[100];
 +#ifndef __APPLE__
- 		sprintf(FileName1, "%sBeebState\\quicksave%d.uefstate", m_UserDataPath, i);
+ 		sprintf(FileName, "quicksave%d.uefstate", i);
+ 
+ 		strcpy(FileName1, m_UserDataPath);
+ 		AppendPath(FileName1, "BeebState");
+ 		AppendPath(FileName1, FileName);
  
  		if (i == 9)
  		{
@@@ -1676,19 -1655,6 +1720,19 @@@ void BeebWin::OnPaste(
  	}
  
  	CloseClipboard();
 +#else
 +	static const int ClipboardBufferSize = 32768;
 +	char clipboardBuffer[ClipboardBufferSize];
 +	
 +	if (swift_getPasteboard(clipboardBuffer,ClipboardBufferSize))		
 +	{
 +		size_t Size = strlen(clipboardBuffer);
 +
 +		m_ClipboardBuffer.insert(m_ClipboardBuffer.end(), &clipboardBuffer[0], &clipboardBuffer[Size]);
- 
++        m_ClipboardLength = m_ClipboardBuffer.size();
 +		m_ClipboardIndex = 0;
 +	}
 +#endif
  }
  
  void BeebWin::ClearClipboardBuffer()
@@@ -1721,9 -1685,15 +1763,16 @@@ void BeebWin::PrintChar(unsigned char V
  
  void BeebWin::CopyPrinterBufferToClipboard()
  {
+ 	if (m_PrinterBuffer.size() == 0)
+ 	{
+ 		return;
+ 	}
+ 
 +#ifndef __APPLE__
  	if (!OpenClipboard(m_hWnd))
+ 	{
  		return;
+ 	}
  
  	EmptyClipboard();
  
@@@ -1736,16 -1706,17 +1785,20 @@@
  	}
  
  	unsigned char* pData = (unsigned char*)GlobalLock(hClipboardData);
- 	memcpy(pData, &m_PrinterBuffer[0], m_PrinterBuffer.size());
- 	pData[m_PrinterBuffer.size()] = '\0';
- 	GlobalUnlock(hClipboardData);
  
- 	SetClipboardData(CF_TEXT, hClipboardData);
+ 	if (pData != nullptr)
+ 	{
+ 		memcpy(pData, &m_PrinterBuffer[0], m_PrinterBuffer.size());
+ 		pData[m_PrinterBuffer.size()] = '\0';
+ 		GlobalUnlock(hClipboardData);
+ 
+ 		SetClipboardData(CF_TEXT, hClipboardData);
+ 	}
  
  	CloseClipboard();
 +#else
 +	swift_setPasteboard((const char*)m_PrinterBuffer.data(), m_PrinterBuffer.size());
 +#endif
  }
  
  /****************************************************************************/
@@@ -1999,15 -1966,11 +2052,15 @@@ void BeebWin::SelectHardDriveFolder(
  	m_Preferences.GetStringValue(CFG_HARD_DRIVE_PATH, DefaultPath);
  	GetDataPath(m_UserDataPath, DefaultPath);
  
- 	FileDialog fileDialog(m_hWnd, FileName, sizeof(FileName), DefaultPath, filter);
+ 	FileDialog Dialog(m_hWnd, FileName, sizeof(FileName), DefaultPath, filter);
  
- 	if (fileDialog.Open())
+ 	if (Dialog.Open())
  	{
 +#ifndef __APPLE__
  		unsigned int PathLength = (unsigned int)(strrchr(FileName, '\\') - FileName);
 +#else
 +		unsigned int PathLength = (unsigned int)(strrchr(FileName, '/') - FileName);
 +#endif
  		strncpy(DefaultPath, FileName, PathLength);
  		DefaultPath[PathLength] = 0;
  
@@@ -2258,10 -2218,9 +2311,10 @@@ void BeebWin::CaptureBitmap(int SourceX
  		        systemTime.wMilliseconds / 100,
  		        fileExt);
  
- 		strcat(m_CaptureFileName, AutoName);
+ 		AppendPath(m_CaptureFileName, AutoName);
  	}
  
 +#ifndef __APPLE__
  	int BitmapWidth, BitmapHeight;
  	int DestX, DestY;
  	int DestWidth, DestHeight;
diff --cc Src/Csw.cpp
index 5fb00b7,a88900b..a5dce01
--- a/Src/Csw.cpp
+++ b/Src/Csw.cpp
@@@ -112,24 -111,50 +111,51 @@@ CSWResult CSWOpen(const char *FileName
  		fclose(csw_file);
  		return CSWResult::InvalidHeaderExtension;
  	}
- #ifndef __APPLE__
- 
- 	int end = ftell(csw_file);
- 	fseek(csw_file, 0, SEEK_END);
- 	int sourcesize = ftell(csw_file) - end + 1;
- #else
- 	int end = (int)ftell(csw_file);
- 	fseek(csw_file, 0, SEEK_END);
- 	int sourcesize = (int)ftell(csw_file) - end + 1;
- #endif
- 	fseek(csw_file, end, SEEK_SET);
+ 
++
+ 	long end = ftell(csw_file);
+ 
+ 	if (end == -1)
+ 	{
+ 		fclose(csw_file);
+ 		return CSWResult::ReadFailed;
+ 	}
+ 
+ 	if (fseek(csw_file, 0, SEEK_END) == -1)
+ 	{
+ 		fclose(csw_file);
+ 		return CSWResult::ReadFailed;
+ 	}
+ 
+ 	long pos = ftell(csw_file);
+ 
+ 	if (pos == -1)
+ 	{
+ 		fclose(csw_file);
+ 		return CSWResult::ReadFailed;
+ 	}
+ 
+ 	long sourcesize = pos - end;
+ 
+ 	if (fseek(csw_file, end, SEEK_SET) == -1)
+ 	{
+ 		fclose(csw_file);
+ 		return CSWResult::ReadFailed;
+ 	}
  
  	csw_bufflen = 8 * 1024 * 1024;
- 	csw_buff = (unsigned char *) malloc(csw_bufflen);
- 	unsigned char *sourcebuff = (unsigned char *) malloc(sourcesize);
+ 	csw_buff = (unsigned char *)malloc(csw_bufflen);
+ 	unsigned char *sourcebuff = (unsigned char *)malloc(sourcesize);
+ 
+ 	size_t BytesRead = fread(sourcebuff, 1, sourcesize, csw_file);
  
- 	fread(sourcebuff, 1, sourcesize, csw_file);
  	fclose(csw_file);
+ 
+ 	if (BytesRead != (size_t)sourcesize)
+ 	{
+ 		return CSWResult::ReadFailed;
+ 	}
+ 
  	csw_file = nullptr;
  
  	uncompress(csw_buff, &csw_bufflen, sourcebuff, sourcesize);
diff --cc Src/Dialog.h
index a2d0be6,707e882..cc20b57
--- a/Src/Dialog.h
+++ b/Src/Dialog.h
@@@ -64,10 -63,5 +64,8 @@@ class Dialo
  		int m_DialogID;
  		HWND m_hwnd;
  };
- 
- void CenterDialog(HWND hWndParent, HWND hWnd);
 +#else
 +#include "Dialog-mac.hpp"
 +#endif //__APPLE__
  
  #endif
diff --cc Src/Econet.cpp
index 147f99b,197e466..bf9f4a8
--- a/Src/Econet.cpp
+++ b/Src/Econet.cpp
@@@ -44,16 -44,9 +44,17 @@@ Boston, MA  02110-1301, USA
  #include "DebugTrace.h"
  #include "Main.h"
  #include "Rtc.h"
+ #include "Socket.h"
  #include "StringUtils.h"
  
 +#ifdef __APPLE__
 +void memcpy_localaddr(struct in_addr_econet* localaddr, char* addr, size_t l)
 +{
 +	struct in_addr apples_localaddr;
 +	memcpy(&apples_localaddr, addr, l);
 +	localaddr->S_un.S_addr = apples_localaddr.s_addr;
 +}
 +#endif
  // Emulated 6854 ADLC control registers.
  // control1_b0 is AC
  // this splits register address 0x01 as control2 and control3
@@@ -647,15 -595,11 +643,15 @@@ void EconetReset(
  					struct in_addr localaddr;
  					memcpy(&localaddr, host->h_addr_list[a], sizeof(struct in_addr));
  
 +#else
 +					struct in_addr_econet localaddr;
 +					memcpy_localaddr(&localaddr, host->h_addr_list[a], sizeof(struct in_addr_econet));
 +#endif
  					if (network[i].inet_addr == inet_addr("127.0.0.1") ||
- 					    network[i].inet_addr == localaddr.S_un.S_addr)
+ 					    network[i].inet_addr == IN_ADDR(localaddr))
  					{
  						service.sin_port = htons(network[i].port);
- 						service.sin_addr.s_addr = network[i].inet_addr;
+ 						S_ADDR(service) = network[i].inet_addr;
  
  						if (bind(ListenSocket, (SOCKADDR*)&service, sizeof(service)) == 0)
  						{
@@@ -680,18 -624,13 +676,18 @@@
  					{
  						for (int a = 0; host->h_addr_list[a] != NULL && EconetStationID == 0; ++a)
  						{
 +#ifndef __APPLE__
  							struct in_addr localaddr;
  							memcpy(&localaddr, host->h_addr_list[a], sizeof(struct in_addr));
 +#else
 +							struct in_addr_econet localaddr;
 +							memcpy_localaddr(&localaddr, host->h_addr_list[a], sizeof(struct in_addr_econet));
 +#endif
  
- 							if (aunnet[j].inet_addr == (localaddr.S_un.S_addr & 0x00FFFFFF))
+ 							if (aunnet[j].inet_addr == (IN_ADDR(localaddr) & 0x00FFFFFF))
  							{
  								service.sin_port = htons(DEFAULT_AUN_PORT);
- 								service.sin_addr.s_addr = localaddr.S_un.S_addr;
+ 								S_ADDR(service) = IN_ADDR(localaddr);
  
  								if (bind(ListenSocket, (SOCKADDR*)&service, sizeof(service)) == 0)
  								{
@@@ -1777,17 -1712,9 +1773,13 @@@ bool EconetPoll_real() // return NMI st
  						FD_ZERO(&ReadFds);
  						FD_SET(ListenSocket, &ReadFds);
  
- #ifndef __APPLE__
- 						static const timeval TimeOut = {0, 0};
- #else
- 						static timeval TimeOut = {0, 0};
- #endif
+ 						timeval TimeOut = {0, 0};
  
 +#ifndef __APPLE__
  						int RetVal = select((int)ListenSocket + 1, &ReadFds, NULL, NULL, &TimeOut);
 +#else
 +						ssize_t RetVal = select((int)ListenSocket + 1, &ReadFds, NULL, NULL, &TimeOut);
 +#endif
  
  						if (RetVal > 0)
  						{
@@@ -1816,14 -1739,10 +1808,14 @@@
  									DebugDisplayTraceF(DebugType::Econet, true,
  									                   "EconetPoll: Packet received: %u bytes from %s port %u",
  									                   (int)RetVal,
- 									                   IpAddressStr(RecvAddr.sin_addr.s_addr),
+ 									                   IpAddressStr(S_ADDR(RecvAddr)),
  									                   htons(RecvAddr.sin_port));
  
 +#ifndef __APPLE__
  									std::string str = "EconetPoll: Packet data:" + BytesToString(AUNMode ? EconetRx.raw : BeebRx.buff, RetVal);
 +#else
 +									std::string str = "EconetPoll: Packet data:" + BytesToString(AUNMode ? EconetRx.raw : BeebRx.buff, (int)RetVal);
 +#endif
  
  									DebugDisplayTrace(DebugType::Econet, true, str.c_str());
  								}
diff --cc Src/FileDialog.h
index 46ce903,57e6a55..0a0edf7
--- a/Src/FileDialog.h
+++ b/Src/FileDialog.h
@@@ -27,55 -27,32 +27,36 @@@ Boston, MA  02110-1301, USA
  #ifndef FILEDIALOG_HEADER
  #define FILEDIALOG_HEADER
  
 +#ifndef __APPLE__
  class FileDialog
  {
- public:
- 	FileDialog(HWND hwndOwner, LPTSTR result, DWORD resultLength,
- 	           LPCTSTR initialFolder, LPCTSTR filter);
- 	FileDialog(const FileDialog&) = delete;
- 	FileDialog& operator=(FileDialog&) = delete;
- 
- 	// Prepare dialog
- 	void SetFilterIndex(DWORD index)
- 	{
- 		m_ofn.nFilterIndex = index;
- 	}
- 
- 	void AllowMultiSelect()
- 	{
- 		m_ofn.Flags |= OFN_ALLOWMULTISELECT | OFN_EXPLORER;
- 	}
- 
- 	void SetTitle(LPCTSTR title)
- 	{
- 		m_ofn.lpstrTitle = title;
- 	}
- 
- 	// Show dialog
- 	bool Open()
- 	{
- 		return ShowDialog(true);
- 	}
- 
- 	bool Save()
- 	{
- 		return ShowDialog(false);
- 	}
- 
- 	// Get results
- 	DWORD GetFilterIndex() const
- 	{
- 		return m_ofn.nFilterIndex;
- 	}
- 
- private:
- 	OPENFILENAME m_ofn;
- 
- 	bool ShowDialog(bool open);
+ 	public:
+ 		FileDialog(HWND hwndOwner, LPTSTR Result, DWORD ResultLength,
+ 		           LPCTSTR InitialFolder, LPCTSTR Filter);
+ 		FileDialog(const FileDialog&) = delete;
+ 		FileDialog& operator=(FileDialog&) = delete;
+ 
+ 	public:
+ 		// Prepare dialog
+ 		void SetFilterIndex(DWORD Index);
+ 		void AllowMultiSelect();
+ 		void NoOverwritePrompt();
+ 		void SetTitle(LPCTSTR Title);
+ 
+ 		// Show dialog
+ 		bool Open();
+ 		bool Save();
+ 
+ 		// Get results
+ 		DWORD GetFilterIndex() const;
+ 
+ 	private:
+ 		OPENFILENAME m_ofn;
+ 
+ 		bool ShowDialog(bool Open);
  };
 +#else
 +#include "FileDialog-mac.hpp"
 +#endif //__APPLE__
  
  #endif
diff --cc Src/FileType.cpp
index f7f2235,e5e4cf3..1ef8785
--- a/Src/FileType.cpp
+++ b/Src/FileType.cpp
@@@ -21,9 -21,9 +21,12 @@@ Boston, MA  02110-1301, USA
  #include <string.h>
  
  #include "FileType.h"
+ #include "StringUtils.h"
+ 
+ /****************************************************************************/
 +#ifdef __APPLE__
 +#include "apples.h"
 +#endif
  
  FileType GetFileTypeFromExtension(const char* FileName)
  {
diff --cc Src/FileUtils.cpp
index 69421c8,7f6195b..ef42da1
--- a/Src/FileUtils.cpp
+++ b/Src/FileUtils.cpp
@@@ -23,13 -24,11 +24,14 @@@ Boston, MA  02110-1301, USA
  #include <stdarg.h>
  
  #include "FileUtils.h"
+ #include "StringUtils.h"
  
  /****************************************************************************/
 -
 +#ifndef __APPLE__
  const char DIR_SEPARATOR = '\\';
 +#else
 +const char DIR_SEPARATOR = '/';
 +#endif
  
  /****************************************************************************/
  
diff --cc Src/IP232.cpp
index b4c7e09,6a48831..f650a99
--- a/Src/IP232.cpp
+++ b/Src/IP232.cpp
@@@ -45,11 -45,9 +45,13 @@@ Boston, MA  02110-1301, USA
  #include "Messages.h"
  #include "RingBuffer.h"
  #include "Serial.h"
+ #include "Socket.h"
+ #include "StringUtils.h"
  #include "Thread.h"
 +#ifdef __APPLE__
 +#undef Sleep // sleep should sleep the thread, not the beeb cpu
 +#define Sleep swift_sleepThread
 +#endif
  
  constexpr int IP232_CONNECTION_DELAY = 8192; // Cycles to wait after connection
  
diff --cc Src/Main.cpp
index c71749e,b493a92..5ab3972
--- a/Src/Main.cpp
+++ b/Src/Main.cpp
@@@ -42,7 -43,8 +43,8 @@@ HINSTANCE hInst
  HWND hCurrentDialog = nullptr;
  HACCEL hCurrentAccelTable = nullptr;
  
+ /****************************************************************************/
 -
 +#ifndef __APPLE__
  int CALLBACK WinMain(HINSTANCE hInstance, HINSTANCE /* hPrevInstance */,
                       LPSTR /* lpszCmdLine */, int /* nCmdShow */)
  {
@@@ -77,14 -65,6 +79,11 @@@ int mainInit(
  
  	OpenLog();
  
- 	// Create serial threads
- 	SerialInit();
- 
 +#ifdef __APPLE__
 +	return 0;
 +}
 +#else
 +
  	for (;;)
  	{
  		MSG msg;
@@@ -126,35 -106,15 +125,34 @@@
  				}
  			}
  		}
 +#endif
 +		
 +#ifdef __APPLE__
 +int mainStep()
 +{
 +	 bool done = false;
 +	 if (done)
 +		 return 1;
  
 +#endif
- 		if (!mainWin->IsFrozen() && !mainWin->IsPaused()) {
+ 		if (!mainWin->IsFrozen() && !mainWin->IsPaused())
+ 		{
  			Exec6502Instruction();
  		}
 +	
 +#ifdef __APPLE__
 +	return 0;
 +}
 +#else
  	}
 +#endif
  
 +#ifdef __APPLE__
 +int mainEnd()
 +{
 +#endif
  	CloseLog();
  
- 	SerialClose();
- 
  	delete mainWin;
  
  	return 0;
diff --cc Src/Music5000.cpp
index a71b8f3,768040f..70114ad
--- a/Src/Music5000.cpp
+++ b/Src/Music5000.cpp
@@@ -99,20 -99,12 +99,20 @@@ static int SampleRight
  
  static SoundStreamer *pSoundStreamer = nullptr;
  
 +#ifdef __APPLE__
 +static bool alreadyCreated = false;
 +#endif
 +
  void Music5000Init()
  {
 +#ifdef __APPLE__
 +	if (!alreadyCreated)
 +	{
 +#endif
  	static_assert(sizeof(WAVERAM) == RAM_SIZE, "WAVERAM size");
  
- 	memset(WaveRam, 0, sizeof(WaveRam));
- 	memset(PhaseRam, 0, sizeof(PhaseRam));
+ 	ZeroMemory(WaveRam, sizeof(WaveRam));
+ 	ZeroMemory(PhaseRam, sizeof(PhaseRam));
  	CycleCount = 0;
  	CurCh = 0;
  	ActiveRegSet = REG_SET_NORMAL;
diff --cc Src/SerialPort.cpp
index 0000000,6cc9855..306e755
mode 000000,100644..100644
--- a/Src/SerialPort.cpp
+++ b/Src/SerialPort.cpp
@@@ -1,0 -1,554 +1,603 @@@
+ /****************************************************************
+ BeebEm - BBC Micro and Master 128 Emulator
+ Copyright (C) 2024  Chris Needham
+ 
+ This program is free software; you can redistribute it and/or
+ modify it under the terms of the GNU General Public License
+ as published by the Free Software Foundation; either version 2
+ of the License, or (at your option) any later version.
+ 
+ This program is distributed in the hope that it will be useful,
+ but WITHOUT ANY WARRANTY; without even the implied warranty of
+ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ GNU General Public License for more details.
+ 
+ You should have received a copy of the GNU General Public
+ License along with this program; if not, write to the Free
+ Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ Boston, MA  02110-1301, USA.
+ ****************************************************************/
+ 
+ #include <windows.h>
+ 
+ #include <process.h>
+ #include <stdio.h>
+ 
+ #include "SerialPort.h"
+ #include "DebugTrace.h"
+ 
+ /*--------------------------------------------------------------------------*/
+ 
++#ifndef __APPLE__
+ SerialPort::SerialPort() :
+ 	m_hSerialPort(INVALID_HANDLE_VALUE),
+ 	m_hReadThread(nullptr),
+ 	m_hReadStartUpEvent(nullptr),
+ 	m_hReadShutDownEvent(nullptr),
+ 	m_dwCommEvent(0),
+ 	m_RxBuffer(1024),
+ 	m_StatusBuffer(128)
+ {
+ 	ZeroMemory(&m_OverlappedRead, sizeof(m_OverlappedRead));
+ 	ZeroMemory(&m_OverlappedWrite, sizeof(m_OverlappedWrite));
+ 	ZeroMemory(&m_BufferLock, sizeof(m_BufferLock));
+ }
 -
++#else
++SerialPort::SerialPort()
++{
++    
++}
++#endif
+ /*--------------------------------------------------------------------------*/
+ 
+ SerialPort::~SerialPort()
+ {
+ 	Close();
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ bool SerialPort::Init(const char* PortName)
+ {
 -	char FileName[MAX_PATH];
++#ifndef __APPLE__
++    char FileName[MAX_PATH];
+ 	sprintf(FileName, "\\\\.\\%s", PortName);
+ 
+ 	COMMTIMEOUTS CommTimeOuts{};
+ 	DCB dcb{}; // Serial port device control block
+ 
+ 	m_hSerialPort = CreateFile(FileName,
+ 	                           GENERIC_READ | GENERIC_WRITE,
+ 	                           0, // dwShareMode
+ 	                           nullptr, // lpSecurityAttributes
+ 	                           OPEN_EXISTING,
+ 	                           FILE_FLAG_OVERLAPPED,
+ 	                           nullptr); // hTemplateFile
+ 
+ 	if (m_hSerialPort == INVALID_HANDLE_VALUE)
+ 	{
+ 		goto Fail;
+ 	}
+ 
+ 	if (!SetupComm(m_hSerialPort, 1024, 1024))
+ 	{
+ 		goto Fail;
+ 	}
+ 
+ 	dcb.DCBlength = sizeof(dcb);
+ 
+ 	if (!GetCommState(m_hSerialPort, &dcb))
+ 	{
+ 		goto Fail;
+ 	}
+ 
+ 	dcb.fBinary         = TRUE;
+ 	dcb.BaudRate        = 9600;
+ 	dcb.Parity          = NOPARITY;
+ 	dcb.StopBits        = ONESTOPBIT;
+ 	dcb.ByteSize        = 8;
+ 	dcb.fDtrControl     = DTR_CONTROL_DISABLE;
+ 	dcb.fOutxCtsFlow    = FALSE;
+ 	dcb.fOutxDsrFlow    = FALSE;
+ 	dcb.fOutX           = FALSE;
+ 	dcb.fDsrSensitivity = FALSE;
+ 	dcb.fInX            = FALSE;
+ 	dcb.fRtsControl     = RTS_CONTROL_DISABLE; // Leave it low (do not send) for now
+ 
+ 	if (!SetCommState(m_hSerialPort, &dcb))
+ 	{
+ 		goto Fail;
+ 	}
+ 
+ 	CommTimeOuts.ReadIntervalTimeout         = MAXDWORD;
+ 	CommTimeOuts.ReadTotalTimeoutConstant    = 0;
+ 	CommTimeOuts.ReadTotalTimeoutMultiplier  = 0;
+ 	CommTimeOuts.WriteTotalTimeoutConstant   = 0;
+ 	CommTimeOuts.WriteTotalTimeoutMultiplier = 0;
+ 
+ 	if (!SetCommTimeouts(m_hSerialPort, &CommTimeOuts))
+ 	{
+ 		goto Fail;
+ 	}
+ 
+ 	// Configure the conditions for WaitCommEvent() to signal an event.
+ 	if (!SetCommMask(m_hSerialPort, EV_CTS | EV_RXCHAR | EV_ERR))
+ 	{
+ 		goto Fail;
+ 	}
+ 
+ 	return InitThread();
+ 
+ Fail:
+ 	Close();
 -
++#endif
+ 	return false;
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ // Create the thread to wait on the I/O event object. Wait for the thread
+ // to start up before returning.
+ 
+ bool SerialPort::InitThread()
+ {
++#ifndef __APPLE__
+ 	InitializeCriticalSection(&m_BufferLock);
+ 
+ 	ZeroMemory(&m_OverlappedRead, sizeof(m_OverlappedRead));
+ 	ZeroMemory(&m_OverlappedWrite, sizeof(m_OverlappedWrite));
+ 
+ 	m_hReadStartUpEvent = CreateEvent(nullptr, TRUE, FALSE, nullptr);
+ 
+ 	if (m_hReadStartUpEvent == nullptr)
+ 	{
+ 		return false;
+ 	}
+ 
+ 	m_hReadShutDownEvent = CreateEvent(nullptr, TRUE, FALSE, nullptr);
+ 
+ 	if (m_hReadShutDownEvent == nullptr)
+ 	{
+ 		return false;
+ 	}
+ 
+ 	m_OverlappedRead.hEvent = CreateEvent(nullptr, TRUE, FALSE, nullptr);
+ 
+ 	if (m_OverlappedRead.hEvent == nullptr)
+ 	{
+ 		return false;
+ 	}
+ 
+ 	// Create the thread.
+ 
+ 	unsigned int ThreadID = 0;
+ 
+ 	m_hReadThread = (HANDLE)_beginthreadex(
+ 		nullptr,        // security
+ 		0,              // stack_size
+ 		ReadThreadFunc, // start_address
+ 		this,           // arglist
+ 		0,              // initflag
+ 		&ThreadID       // thrdaddr
+ 	);
+ 
+ 	if (m_hReadThread == nullptr)
+ 	{
+ 		return false;
+ 	}
+ 
+ 	DWORD dwResult = WaitForSingleObject(m_hReadStartUpEvent, INFINITE);
+ 
+ 	if (dwResult != WAIT_OBJECT_0)
+ 	{
+ 		return false;
+ 	}
+ 
+ 	// Wait for a comm event.
+ 
+ 	m_dwCommEvent = 0;
+ 
+ 	if (!WaitCommEvent(m_hSerialPort, &m_dwCommEvent, &m_OverlappedRead))
+ 	{
+ 		if (GetLastError() != ERROR_IO_PENDING)
+ 		{
+ 			DebugTrace("Failed to initiate port event wait\n");
+ 			return false;
+ 		}
+ 	}
+ 
+ 	m_RxBuffer.Reset();
+ 	m_StatusBuffer.Reset();
 -
++#endif
+ 	return true;
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ void SerialPort::Close()
+ {
++#ifndef __APPLE__
+ 	if (m_hReadThread != nullptr)
+ 	{
+ 		SetEvent(m_hReadShutDownEvent);
+ 
+ 		WaitForSingleObject(m_hReadThread, INFINITE);
+ 
+ 		CloseHandle(m_hReadThread);
+ 		m_hReadThread = nullptr;
+ 	}
+ 
+ 	if (m_hSerialPort != INVALID_HANDLE_VALUE)
+ 	{
+ 		CloseHandle(m_hSerialPort);
+ 		m_hSerialPort = INVALID_HANDLE_VALUE;
+ 	}
+ 
+ 	if (m_hReadStartUpEvent != nullptr)
+ 	{
+ 		CloseHandle(m_hReadStartUpEvent);
+ 		m_hReadStartUpEvent = nullptr;
+ 	}
+ 
+ 	if (m_hReadShutDownEvent != nullptr)
+ 	{
+ 		CloseHandle(m_hReadShutDownEvent);
+ 		m_hReadShutDownEvent = nullptr;
+ 	}
+ 
+ 	if (m_OverlappedRead.hEvent != nullptr)
+ 	{
+ 		CloseHandle(m_OverlappedRead.hEvent);
+ 		m_OverlappedRead.hEvent = nullptr;
+ 	}
+ 
+ 	DeleteCriticalSection(&m_BufferLock);
+ 
+ 	m_RxBuffer.Reset();
+ 	m_StatusBuffer.Reset();
++#endif
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ bool SerialPort::SetBaudRate(int BaudRate)
+ {
++#ifndef __APPLE__
++
+ 	DebugTrace("SerialPort::SetBaudRate\n");
+ 
+ 	if (m_hSerialPort == INVALID_HANDLE_VALUE)
+ 	{
+ 		return false;
+ 	}
+ 
+ 	DCB dcb{}; // Serial port device control block
+ 	dcb.DCBlength = sizeof(dcb);
+ 
+ 	if (!GetCommState(m_hSerialPort, &dcb))
+ 	{
+ 		return false;
+ 	}
+ 
+ 	dcb.BaudRate  = BaudRate;
+ 	dcb.DCBlength = sizeof(dcb);
+ 
+ 	if (!SetCommState(m_hSerialPort, &dcb))
+ 	{
+ 		return false;
+ 	}
 -
++#endif
+ 	return true;
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ bool SerialPort::Configure(unsigned char DataBits,
+                            unsigned char StopBits,
+                            unsigned char Parity)
+ {
++#ifndef __APPLE__
+ 	DebugTrace("SerialPort::Configure DataBits=%d StopBits=%d Parity=%d\n", DataBits, StopBits, Parity);
+ 
+ 	if (m_hSerialPort == INVALID_HANDLE_VALUE)
+ 	{
+ 		return false;
+ 	}
+ 
+ 	DCB dcb{}; // Serial port device control block
+ 	dcb.DCBlength = sizeof(dcb);
+ 
+ 	if (!GetCommState(m_hSerialPort, &dcb))
+ 	{
+ 		return false;
+ 	}
+ 
+ 	dcb.ByteSize  = DataBits;
+ 	dcb.StopBits  = (StopBits == 1) ? ONESTOPBIT : TWOSTOPBITS;
+ 	dcb.Parity    = Parity;
+ 	dcb.DCBlength = sizeof(dcb);
+ 
+ 	if (!SetCommState(m_hSerialPort, &dcb))
+ 	{
+ 		return false;
+ 	}
 -
++#endif
+ 	return true;
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ bool SerialPort::SetRTS(bool RTS)
+ {
++#ifndef __APPLE__
+ 	DebugTrace("SerialPort::SetRTS\n");
+ 
+ 	if (m_hSerialPort == INVALID_HANDLE_VALUE)
+ 	{
+ 		return false;
+ 	}
+ 
+ 	if (!EscapeCommFunction(m_hSerialPort, RTS ? CLRRTS : SETRTS))
+ 	{
+ 		return false;
+ 	}
 -
++#endif
+ 	return true;
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ bool SerialPort::WriteChar(unsigned char Data)
+ {
++#ifndef __APPLE__
++
+ 	DWORD BytesSent = 0;
+ 
+ 	bool Success = !!WriteFile(m_hSerialPort,
+ 	                           &Data,
+ 	                           1,
+ 	                           &BytesSent,
+ 	                           &m_OverlappedWrite);
+ 
+ 	if (!Success)
+ 	{
+ 		DWORD Error = GetLastError();
+ 
+ 		if (Error == ERROR_IO_PENDING)
+ 		{
+ 			DWORD WaitResult = WaitForSingleObject(m_OverlappedWrite.hEvent, INFINITE);
+ 
+ 			Success = WaitResult == WAIT_OBJECT_0;
+ 		}
+ 		else
+ 		{
+ 			DebugTrace("WriteFile failed, code %lu", (ULONG)Error);
+ 		}
+ 	}
 -
+ 	return Success;
++#else
++    return FALSE;
++#endif
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ bool SerialPort::HasRxData() const
+ {
++#ifndef __APPLE__
++
+ 	return m_RxBuffer.HasData();
++#else
++    return FALSE;
++#endif
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ unsigned char SerialPort::GetRxData()
+ {
++#ifndef __APPLE__
++
+ 	EnterCriticalSection(&m_BufferLock);
+ 
+ 	unsigned char Data = m_RxBuffer.GetData();
+ 
+ 	LeaveCriticalSection(&m_BufferLock);
+ 
+ 	return Data;
++#else
++    return 0;
++#endif
++    
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ bool SerialPort::HasStatus() const
+ {
++#ifndef __APPLE__
+ 	return m_StatusBuffer.HasData();
++#else
++    return FALSE;
++#endif
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ unsigned char SerialPort::GetStatus()
+ {
++#ifndef __APPLE__
+ 	EnterCriticalSection(&m_BufferLock);
+ 
+ 	unsigned char Data = m_StatusBuffer.GetData();
+ 
+ 	LeaveCriticalSection(&m_BufferLock);
+ 
+ 	return Data;
++#else
++    return 0;
++#endif
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ unsigned int __stdcall SerialPort::ReadThreadFunc(void* pParameter)
+ {
++#ifndef __APPLE__
++
+ 	SerialPort* pSerialPort = static_cast<SerialPort*>(pParameter);
+ 
+ 	if (pSerialPort != nullptr)
+ 	{
+ 		pSerialPort->ReadThreadFunc();
+ 	}
 -
++#endif
+ 	return 0;
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ void SerialPort::ReadThreadFunc()
+ {
++#ifndef __APPLE__
+ 	// Notify the parent thread that this thread has started running.
+ 	SetEvent(m_hReadStartUpEvent);
+ 
+ 	DebugTrace("ReadThreadFunc started\n");
+ 
+ 	bool bQuit = false;
+ 
+ 	while (!bQuit)
+ 	{
+ 		HANDLE hEvents[] = { m_OverlappedRead.hEvent, m_hReadShutDownEvent };
+ 
+ 		// Wait for one of the event objects to become signalled.
+ 		DWORD Result = WaitForMultipleObjects(_countof(hEvents), hEvents, FALSE, INFINITE);
+ 
+ 		switch (Result)
+ 		{
+ 			case WAIT_OBJECT_0 + 0:
+ 				// Clear comms port line errors, if any.
+ 				if (m_dwCommEvent & EV_ERR)
+ 				{
+ 					DWORD Error = 0;
+ 
+ 					if (ClearCommError(m_hSerialPort, &Error, nullptr))
+ 					{
+ 						DebugTrace("Comms error %lu (framing, overrun, parity)\n", Error);
+ 					}
+ 				}
+ 
+ 				// Process received characters, if any.
+ 				if (m_dwCommEvent & EV_RXCHAR)
+ 				{
+ 					const int BUFFER_LENGTH = 256;
+ 					unsigned char Buffer[BUFFER_LENGTH];
+ 
+ 					int Pos = 0;
+ 
+ 					for (;;)
+ 					{
+ 						unsigned char Data;
+ 						DWORD BytesRead = 0;
+ 
+ 						OVERLAPPED Overlapped{};
+ 
+ 						BOOL Success = ReadFile(m_hSerialPort, // hFile
+ 						                        &Data,         // lpBuffer
+ 						                        1,             // nNumberOfBytesToRead
+ 						                        &BytesRead,    // lpNumberOfBytesRead
+ 						                        &Overlapped);  // lpOverlapped
+ 
+ 						if (Success && BytesRead == 1)
+ 						{
+ 							Buffer[Pos] = Data;
+ 
+ 							if (++Pos == BUFFER_LENGTH)
+ 							{
+ 								PutRxData(Buffer, BUFFER_LENGTH);
+ 								Pos = 0;
+ 							}
+ 						}
+ 						else
+ 						{
+ 							break;
+ 						}
+ 					}
+ 
+ 					if (Pos > 0)
+ 					{
+ 						PutRxData(Buffer, Pos);
+ 					}
+ 				}
+ 
+ 				if (m_dwCommEvent & EV_CTS)
+ 				{
+ 					DWORD ModemStatus = 0;
+ 
+ 					if (GetCommModemStatus(m_hSerialPort, &ModemStatus))
+ 					{
+ 						PutCommStatus((unsigned char)ModemStatus);
+ 					}
+ 				}
+ 
+ 				// Prepare for the next comms event.
+ 				ResetEvent(m_OverlappedRead.hEvent);
+ 				WaitCommEvent(m_hSerialPort, &m_dwCommEvent, &m_OverlappedRead);
+ 				break;
+ 
+ 			case WAIT_OBJECT_0 + 1:
+ 				// The thread has been signalled to terminate.
+ 				DebugTrace("Overlapped I/O read thread shutdown event signalled\n");
+ 
+ 				bQuit = true;
+ 				break;
+ 
+ 			default:
+ 				// Unexpected return code - terminate the thread.
+ 				Result = GetLastError();
+ 				DebugTrace("Overlapped I/O thread WaitForMultipleObjects failed, code %lu\n", (ULONG)Result);
+ 
+ 				bQuit = true;
+ 				break;
+ 		}
+ 	}
+ 
+ 	DebugTrace("ReadThreadFunc stopped\n");
++#endif
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ void SerialPort::PutRxData(const unsigned char* pData, int Length)
+ {
++#ifndef __APPLE__
++
+ 	EnterCriticalSection(&m_BufferLock);
+ 
+ 	for (int i = 0; i < Length; i++)
+ 	{
+ 		m_RxBuffer.PutData(pData[i]);
+ 	}
+ 
+ 	LeaveCriticalSection(&m_BufferLock);
++#endif
++    
+ }
+ 
+ /*--------------------------------------------------------------------------*/
+ 
+ void SerialPort::PutCommStatus(unsigned char Status)
+ {
++#ifndef __APPLE__
++
+ 	EnterCriticalSection(&m_BufferLock);
+ 
+ 	m_StatusBuffer.PutData(Status);
+ 
+ 	LeaveCriticalSection(&m_BufferLock);
++#endif
++    
+ }
+ 
+ /*--------------------------------------------------------------------------*/
diff --cc Src/SerialPort.h
index 0000000,a703a38..0089db4
mode 000000,100644..100644
--- a/Src/SerialPort.h
+++ b/Src/SerialPort.h
@@@ -1,0 -1,72 +1,75 @@@
+ /****************************************************************
+ BeebEm - BBC Micro and Master 128 Emulator
+ Copyright (C) 2024  Chris Needham
+ 
+ This program is free software; you can redistribute it and/or
+ modify it under the terms of the GNU General Public License
+ as published by the Free Software Foundation; either version 2
+ of the License, or (at your option) any later version.
+ 
+ This program is distributed in the hope that it will be useful,
+ but WITHOUT ANY WARRANTY; without even the implied warranty of
+ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ GNU General Public License for more details.
+ 
+ You should have received a copy of the GNU General Public
+ License along with this program; if not, write to the Free
+ Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ Boston, MA  02110-1301, USA.
+ ****************************************************************/
+ 
+ #ifndef SERIAL_PORT_HEADER
+ #define SERIAL_PORT_HEADER
+ 
+ #include "RingBuffer.h"
+ 
++
+ class SerialPort
+ {
+ 	public:
+ 		SerialPort();
+ 		SerialPort(const SerialPort&) = delete;
+ 		SerialPort& operator=(const SerialPort&) = delete;
+ 		~SerialPort();
+ 
+ 	public:
+ 		bool Init(const char* PortName);
+ 		void Close();
+ 
+ 		bool SetBaudRate(int BaudRate);
+ 		bool Configure(unsigned char DataBits, unsigned char StopBits, unsigned char Parity);
+ 		bool SetRTS(bool RTS);
+ 
+ 		bool WriteChar(unsigned char Data);
+ 
+ 		bool HasRxData() const;
+ 		unsigned char GetRxData();
+ 
+ 		bool HasStatus() const;
+ 		unsigned char GetStatus();
+ 
+ 	private:
+ 		bool InitThread();
+ 
+ 		static unsigned int __stdcall ReadThreadFunc(void* pParameter);
+ 		void ReadThreadFunc();
+ 
+ 		void PutRxData(const unsigned char* pData, int Length);
+ 		void PutCommStatus(unsigned char Status);
+ 
+ 	private:
++#ifndef __APPLE__
+ 		HANDLE m_hSerialPort;
+ 		HANDLE m_hReadThread;
+ 		HANDLE m_hReadStartUpEvent;
+ 		HANDLE m_hReadShutDownEvent;
+ 		DWORD m_dwCommEvent;
+ 		OVERLAPPED m_OverlappedRead;
+ 		OVERLAPPED m_OverlappedWrite;
+ 		RingBuffer m_RxBuffer;
+ 		RingBuffer m_StatusBuffer;
+ 		CRITICAL_SECTION m_BufferLock;
++#endif
+ };
+ 
+ #endif
diff --cc Src/Socket.cpp
index 0000000,73a3e49..b1618a0
mode 000000,100644..100644
--- a/Src/Socket.cpp
+++ b/Src/Socket.cpp
@@@ -1,0 -1,104 +1,105 @@@
+ /****************************************************************
+ BeebEm - BBC Micro and Master 128 Emulator
+ Copyright (C) 2024  Chris Needham
+ 
+ This program is free software; you can redistribute it and/or
+ modify it under the terms of the GNU General Public License
+ as published by the Free Software Foundation; either version 2
+ of the License, or (at your option) any later version.
+ 
+ This program is distributed in the hope that it will be useful,
+ but WITHOUT ANY WARRANTY; without even the implied warranty of
+ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ GNU General Public License for more details.
+ 
+ You should have received a copy of the GNU General Public
+ License along with this program; if not, write to the Free
+ Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ Boston, MA  02110-1301, USA.
+ ****************************************************************/
+ 
+ #include <windows.h>
+ 
+ #include "Socket.h"
+ 
+ #ifndef WIN32
+ #include <errno.h>
+ #include <unistd.h>
++#include <fcntl.h>
+ #endif
+ 
+ /****************************************************************************/
+ 
+ int CloseSocket(SOCKET Socket)
+ {
+ 	#ifdef WIN32
+ 
+ 	return closesocket(Socket);
+ 
+ 	#else
+ 
+ 	return close(Socket);
+ 
+ 	#endif
+ }
+ 
+ /****************************************************************************/
+ 
+ int GetLastSocketError()
+ {
+ 	#ifdef WIN32
+ 
+ 	return WSAGetLastError();
+ 
+ 	#else
+ 
+ 	return errno;
+ 
+ 	#endif
+ }
+ 
+ /****************************************************************************/
+ 
+ bool SetSocketBlocking(SOCKET Socket, bool Blocking)
+ {
+ 	#ifdef WIN32
+ 
+ 	unsigned long Mode = Blocking ? 0 : 1;
+ 	return ioctlsocket(Socket, FIONBIO, &Mode) == 0;
 -
++    
+ 	#else
+ 
+ 	int Flags = fcntl(Socket, F_GETFL, 0);
+ 	if (Flags == -1) return false;
+ 
+ 	if (Blocking)
+ 	{
+ 		Flags &= ~O_NONBLOCK;
+ 	}
+ 	else
+ 	{
+ 		Flags |= O_NONBLOCK;
+ 	}
+ 
+ 	return fcntl(Socket, F_SETFL, Flags) == 0;
+ 
+ 	#endif
+ }
+ 
+ /****************************************************************************/
+ 
+ bool WouldBlock(int Error)
+ {
+ 
+ 	#ifdef WIN32
+ 
+ 	return Error == WSAEWOULDBLOCK;
+ 
+ 	#else
+ 
+ 	return Error == EWOULDBLOCK; // TODO: EAGAIN?
+ 
+ 	#endif
+ }
+ 
+ /****************************************************************************/
diff --cc Src/Sound.cpp
index db10b61,0bbde2e..c8c669e
--- a/Src/Sound.cpp
+++ b/Src/Sound.cpp
@@@ -31,12 -31,9 +31,13 @@@ Boston, MA  02110-1301, USA
  
  #include "Sound.h"
  #include "6502core.h"
 +#ifndef __APPLE__
  #include "AviWriter.h"
 +#else
 +#include "AVIWriter.h"
 +#endif
  #include "BeebWin.h"
+ #include "FileUtils.h"
  #include "Main.h"
  #include "SoundStreamer.h"
  #include "Speech.h"
diff --cc Src/SoundStreamer.cpp
index f95d2d4,840c803..385b1fa
--- a/Src/SoundStreamer.cpp
+++ b/Src/SoundStreamer.cpp
@@@ -21,48 -21,54 +21,62 @@@ Software Foundation, Inc., 51 Franklin 
  Boston, MA  02110-1301, USA.
  ****************************************************************/
  
+ #include <algorithm>
+ 
  #include "SoundStreamer.h"
 +#ifndef __APPLE__
  #include "DirectSoundStreamer.h"
 +#endif
  #include "Main.h"
  #include "Sound.h"
 +#ifndef __APPLE__
  #include "XAudio2Streamer.h"
 +#endif
 +#ifdef __APPLE__
 +#include "AppleSoundStreamer.hpp"
 +#endif
  
- std::list<SoundStreamer*> SoundStreamer::m_streamers;
+ std::vector<SoundStreamer*> SoundStreamer::m_streamers;
+ 
+ /****************************************************************************/
  
  SoundStreamer::SoundStreamer()
  {
  	m_streamers.push_back(this);
  }
  
+ /****************************************************************************/
+ 
  SoundStreamer::~SoundStreamer()
  {
- 	m_streamers.remove(this);
+ 	m_streamers.erase(std::find(m_streamers.begin(), m_streamers.end(), this));
  }
  
+ /****************************************************************************/
+ 
  void SoundStreamer::PlayAll()
  {
- 	std::list<SoundStreamer*>::iterator li;
- 	for (li = m_streamers.begin(); li != m_streamers.end(); li++)
- 		(*li)->Play();
+ 	for (auto i = m_streamers.begin(); i != m_streamers.end(); ++i)
+ 	{
+ 		(*i)->Play();
+ 	}
  }
  
+ /****************************************************************************/
+ 
  void SoundStreamer::PauseAll()
  {
- 	std::list<SoundStreamer*>::iterator li;
- 	for (li = m_streamers.begin(); li != m_streamers.end(); li++)
- 		(*li)->Pause();
+ 	for (auto i = m_streamers.begin(); i != m_streamers.end(); ++i)
+ 	{
+ 		(*i)->Pause();
+ 	}
  }
  
+ /****************************************************************************/
+ 
  SoundStreamer *CreateSoundStreamer(int samplerate, int bits_per_sample, int channels)
  {
 +#ifndef __APPLE__
  	if (SelectedSoundStreamer == SoundStreamerType::XAudio2)
  	{
  		SoundStreamer *pSoundStreamer = new XAudio2Streamer();
@@@ -95,26 -101,6 +109,28 @@@
  
  		return nullptr;
  	}
 +#else
 +	SoundStreamer *pSoundStreamer = new AppleSoundStreamer();
 +	if (pSoundStreamer->Init(samplerate, bits_per_sample, channels))
 +	{
 +		// create streams in the sound systems - now init (start) the sound system
 +		swift_SoundInit();
 +
 +		return pSoundStreamer;
 +	}
 +	else
 +	{
 +	   delete pSoundStreamer;
 +	   pSoundStreamer= nullptr;
 +		mainWin->Report(MessageType::Error, "Attempt to start sound system failed");
 +
 +		return nullptr;
 +	}
 +	
 +
 +#endif
 +
 +	return pSoundStreamer;
  }
+ 
+ /****************************************************************************/
diff --cc Src/SprowCoPro.cpp
index ae7ac8e,aa3e6e7..18a3563
--- a/Src/SprowCoPro.cpp
+++ b/Src/SprowCoPro.cpp
@@@ -424,14 -438,10 +438,14 @@@ PutWord (ARMul_State * state, ARMword a
  \***************************************************************************/
  
  unsigned
- ARMul_MemoryInit (ARMul_State * state, ARMword initmemsize)
+ ARMul_MemoryInit (ARMul_State * state, unsigned long initmemsize)
  {
      if (initmemsize)
 -        state->MemSize = initmemsize;
 +#ifndef __APPLE__
 +		state->MemSize = initmemsize;
 +#else
 +        state->MemSize = (ARMword)initmemsize;
 +#endif
  
      unsigned char *memory = (unsigned char *)malloc(initmemsize);
  
diff --cc Src/UserVia.cpp
index 42d8049,40d74c9..b4cd9a0
--- a/Src/UserVia.cpp
+++ b/Src/UserVia.cpp
@@@ -611,11 -613,7 +613,11 @@@ bool PrinterEnable(const char *FileName
  {
  	ClosePrinterOutputFile();
  
 +#ifndef __APPLE__
- 	if (FileName != nullptr)
+ 	if (FileName == nullptr)
 +#else
 +	if (FileName == nullptr || FileName[0] == 0)
- #endif
++#endif	
  	{
  		PrinterEnabled = true;
  		SetTrigger(PRINTER_TRIGGER, PrinterTrigger);
diff --cc Src/Video.cpp
index a4563cf,736a3ac..6eeaf4d
--- a/Src/Video.cpp
+++ b/Src/Video.cpp
@@@ -1794,7 -1749,7 +1753,7 @@@ void VideoGetText(char *text, int line
  			if (c == '_')
  				c = '#';
  			else if (c == '#')
--				c = 0xa3; // ''
++				c = 0xa3; // ''
  			else if (c == '`')
  				c = '_';
  
diff --cc Src/WindowUtils.cpp
index 0000000,e314f62..0a81197
mode 000000,100644..100644
--- a/Src/WindowUtils.cpp
+++ b/Src/WindowUtils.cpp
@@@ -1,0 -1,113 +1,126 @@@
+ /****************************************************************
+ BeebEm - BBC Micro and Master 128 Emulator
+ Copyright (C) 2024  Chris Needham
+ 
+ This program is free software; you can redistribute it and/or
+ modify it under the terms of the GNU General Public License
+ as published by the Free Software Foundation; either version 2
+ of the License, or (at your option) any later version.
+ 
+ This program is distributed in the hope that it will be useful,
+ but WITHOUT ANY WARRANTY; without even the implied warranty of
+ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ GNU General Public License for more details.
+ 
+ You should have received a copy of the GNU General Public
+ License along with this program; if not, write to the Free
+ Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ Boston, MA  02110-1301, USA.
+ ****************************************************************/
+ 
+ #include <windows.h>
+ 
+ #include "WindowUtils.h"
+ 
+ /****************************************************************************/
+ 
++#ifndef __APPLE__
+ typedef HRESULT(STDAPICALLTYPE* DWM_SET_WINDOW_ATTRIBUTE)(HWND, DWORD, LPCVOID, DWORD);
+ 
+ static HMODULE hDwmApi = nullptr;
+ static DWM_SET_WINDOW_ATTRIBUTE DwmSetWindowAttribute = nullptr;
++#endif
+ 
+ /****************************************************************************/
+ 
+ void InitWindowUtils()
+ {
++#ifndef __APPLE__
+ 	hDwmApi = LoadLibrary("dwmapi.dll");
+ 
+ 	if (hDwmApi != nullptr)
+ 	{
+ 		DwmSetWindowAttribute = reinterpret_cast<DWM_SET_WINDOW_ATTRIBUTE>(
+ 			GetProcAddress(hDwmApi, "DwmSetWindowAttribute")
+ 		);
+ 	}
++#endif
+ }
+ 
+ /****************************************************************************/
+ 
+ void ExitWindowUtils()
+ {
++#ifndef __APPLE__
+ 	if (hDwmApi != nullptr)
+ 	{
+ 		FreeLibrary(hDwmApi);
+ 
+ 		hDwmApi = nullptr;
+ 		DwmSetWindowAttribute = nullptr;
+ 	}
++#endif
++    
+ }
+ 
+ /****************************************************************************/
+ 
+ void CentreWindow(HWND hWndParent, HWND hWnd)
+ {
++#ifndef __APPLE__
+ 	if (hWndParent == nullptr || hWnd == nullptr)
+ 	{
+ 		return;
+ 	}
+ 
+ 	RECT rcParent;
+ 	GetWindowRect(hWndParent, &rcParent);
+ 
+ 	RECT rcWindow;
+ 	GetWindowRect(hWnd, &rcWindow);
+ 
+ 	RECT rc;
+ 	CopyRect(&rc, &rcParent);
+ 
+ 	// Offset the owner and dialog box rectangles so that right and bottom
+ 	// values represent the width and height, and then offset the owner again
+ 	// to discard space taken up by the dialog box.
+ 
+ 	OffsetRect(&rcWindow, -rcWindow.left, -rcWindow.top);
+ 	OffsetRect(&rc, -rc.left, -rc.top);
+ 	OffsetRect(&rc, -rcWindow.right, -rcWindow.bottom);
+ 
+ 	// The new position is the sum of half the remaining space and the owner's
+ 	// original position.
+ 
+ 	SetWindowPos(hWnd,
+ 	             HWND_TOP,
+ 	             rcParent.left + (rc.right / 2),
+ 	             rcParent.top + (rc.bottom / 2),
+ 	             0, 0, // Ignores size arguments.
+ 	             SWP_NOSIZE);
++#endif
+ }
+ 
+ /****************************************************************************/
+ 
+ void DisableRoundedCorners(HWND hWnd)
+ {
++#ifndef __APPLE__
++
+ 	if (DwmSetWindowAttribute != nullptr)
+ 	{
+ 		const DWORD DWMWCP_DONOTROUND = 1;
+ 		const DWORD DWMWA_WINDOW_CORNER_PREFERENCE = 33;
+ 		const DWORD CornerPreference = DWMWCP_DONOTROUND;
+ 
+ 		DwmSetWindowAttribute(hWnd,
+ 		                      DWMWA_WINDOW_CORNER_PREFERENCE,
+ 		                      &CornerPreference,
+ 		                      sizeof(CornerPreference));
+ 	}
++#endif
++    
+ }
+ 
+ /****************************************************************************/
diff --cc XCode/Project/BeebEm.xcodeproj/project.pbxproj
index 28b6cf2,0000000..7cc319a
mode 100644,000000..100644
--- a/XCode/Project/BeebEm.xcodeproj/project.pbxproj
+++ b/XCode/Project/BeebEm.xcodeproj/project.pbxproj
@@@ -1,1425 -1,0 +1,1447 @@@
 +// !$*UTF8*$!
 +{
 +	archiveVersion = 1;
 +	classes = {
 +	};
 +	objectVersion = 55;
 +	objects = {
 +
 +/* Begin PBXBuildFile section */
 +		DC0997AA2BBAA6E300A109A5 /* beebemrcids.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09979D2BBAA51300A109A5 /* beebemrcids.cpp */; };
 +		DC0D30E32BC12C8E00AFEF01 /* Main.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996F72BBA0C9C00A109A5 /* Main.cpp */; };
 +		DC1DBA202BB8CF8600AAB22F /* BeebEm-TapeControl.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EB32BB5BB7700523116 /* BeebEm-TapeControl.swift */; };
 +		DC1DBA212BB8CF8B00AAB22F /* TapeControlViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC1DBA162BB8CF0500AAB22F /* TapeControlViewController.swift */; };
 +		DC1DBA222BB998B000AAB22F /* KeyboardMappingViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC1DBA132BB8CF0400AAB22F /* KeyboardMappingViewController.swift */; };
 +		DC1DBA232BB9A2BB00AAB22F /* RomConfigViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC1DBA152BB8CF0500AAB22F /* RomConfigViewController.swift */; };
 +		DC1DBA252BB9A4C900AAB22F /* BreakoutBoxViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC1DBA142BB8CF0500AAB22F /* BreakoutBoxViewController.swift */; };
 +		DC215BE62C13B4DD003E50A3 /* BeebWinDx-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCACDAC22BC669B600CEF154 /* BeebWinDx-mac.cpp */; };
 +		DC215BEA2C13C359003E50A3 /* AVIWriter.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996F62BBA0C9C00A109A5 /* AVIWriter.cpp */; };
 +		DC2C9D032BF9788700F2E613 /* RomConfigFile.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC2C9D002BF9788700F2E613 /* RomConfigFile.cpp */; };
 +		DC2C9D042BF9788700F2E613 /* Rtc.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC2C9D022BF9788700F2E613 /* Rtc.cpp */; };
 +		DC2C9D072BF978AF00F2E613 /* UserPortRTC.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC2C9D052BF978AE00F2E613 /* UserPortRTC.cpp */; };
 +		DC33555F2BDF84C00014DC3A /* RomConfigDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC33555D2BDF84C00014DC3A /* RomConfigDialog-mac.cpp */; };
 +		DC3355602BDF8D720014DC3A /* BeebEm-RomConfig.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EB72BB5BB9A00523116 /* BeebEm-RomConfig.swift */; };
 +		DC3FB54C2BE8E02300CF36A0 /* KeyMap-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC3FB5492BE8DEDB00CF36A0 /* KeyMap-mac.cpp */; };
 +		DC4E6BBB2C31386F006443D3 /* DebugTrace.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996ED2BBA0C9B00A109A5 /* DebugTrace.cpp */; };
 +		DC527AD12BC71C21000D7CCF /* BeebEm-Bridging-Video.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCACDAC52BC66F5600CEF154 /* BeebEm-Bridging-Video.cpp */; };
 +		DC527AD22BC71CBC000D7CCF /* BeebEm-Bridging-Main.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCACDAC82BC67D2500CEF154 /* BeebEm-Bridging-Main.cpp */; };
 +		DC527BC82BC75107000D7CCF /* Teletext.fnt in Resources */ = {isa = PBXBuildFile; fileRef = DC527BC42BC75107000D7CCF /* Teletext.fnt */; };
 +		DC527BC92BC75107000D7CCF /* RelayOn.snd in Resources */ = {isa = PBXBuildFile; fileRef = DC527BC52BC75107000D7CCF /* RelayOn.snd */; };
 +		DC527BCA2BC75107000D7CCF /* README.md in Resources */ = {isa = PBXBuildFile; fileRef = DC527BC62BC75107000D7CCF /* README.md */; };
 +		DC527BCB2BC75107000D7CCF /* RelayOff.snd in Resources */ = {isa = PBXBuildFile; fileRef = DC527BC72BC75107000D7CCF /* RelayOff.snd */; };
 +		DC527BD12BC75114000D7CCF /* DriveMotor.snd in Resources */ = {isa = PBXBuildFile; fileRef = DC527BCC2BC75114000D7CCF /* DriveMotor.snd */; };
 +		DC527BD22BC75114000D7CCF /* HeadStep.snd in Resources */ = {isa = PBXBuildFile; fileRef = DC527BCD2BC75114000D7CCF /* HeadStep.snd */; };
 +		DC527BD32BC75114000D7CCF /* HeadSeek.snd in Resources */ = {isa = PBXBuildFile; fileRef = DC527BCE2BC75114000D7CCF /* HeadSeek.snd */; };
 +		DC527BD42BC75114000D7CCF /* HeadUnload.snd in Resources */ = {isa = PBXBuildFile; fileRef = DC527BCF2BC75114000D7CCF /* HeadUnload.snd */; };
 +		DC527BD52BC75114000D7CCF /* HeadLoad.snd in Resources */ = {isa = PBXBuildFile; fileRef = DC527BD02BC75114000D7CCF /* HeadLoad.snd */; };
 +		DC527BD72BC75122000D7CCF /* COPYRIGHT.txt in Resources */ = {isa = PBXBuildFile; fileRef = DC527BD62BC75122000D7CCF /* COPYRIGHT.txt */; };
 +		DC527C1E2BC75165000D7CCF /* CHANGES.md in Resources */ = {isa = PBXBuildFile; fileRef = DC527C1D2BC75165000D7CCF /* CHANGES.md */; };
 +		DC527C202BC75175000D7CCF /* README-SPROW.txt in Resources */ = {isa = PBXBuildFile; fileRef = DC527C1F2BC75175000D7CCF /* README-SPROW.txt */; };
 +		DC527D122BC75316000D7CCF /* UserData in Resources */ = {isa = PBXBuildFile; fileRef = DC527D112BC75316000D7CCF /* UserData */; };
 +		DC527D142BC7532E000D7CCF /* Help in Resources */ = {isa = PBXBuildFile; fileRef = DC527D132BC7532E000D7CCF /* Help */; };
 +		DC527D172BC9110E000D7CCF /* BeebEm-Bridging-Keyboard.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC527D152BC9110E000D7CCF /* BeebEm-Bridging-Keyboard.cpp */; };
 +		DC689D0D2C2D3E68009BA41F /* BeebEm-Bridging-SerialPort.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC689D0C2C2D3E68009BA41F /* BeebEm-Bridging-SerialPort.cpp */; };
 +		DC69C9F52BF2BDB600610067 /* KeyboardLinksViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC69C9F42BF2BDB600610067 /* KeyboardLinksViewController.swift */; };
 +		DC69C9F72BF2BDC700610067 /* BeebEm-KeyboardLinks.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC69C9F62BF2BDC700610067 /* BeebEm-KeyboardLinks.swift */; };
 +		DC69C9FA2BF2BDE100610067 /* KeyboardLinksDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC69C9F82BF2BDE100610067 /* KeyboardLinksDialog-mac.cpp */; };
 +		DC69C9FD2BF2C87A00610067 /* BeebEm-Bridging-KeyboardLinks.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC69C9FB2BF2C87A00610067 /* BeebEm-Bridging-KeyboardLinks.cpp */; };
 +		DC74E1CE2C29D88C006826EE /* FileType.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC74E1CB2C29D88C006826EE /* FileType.cpp */; };
 +		DC74E1CF2C29D88C006826EE /* Registry.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC74E1CD2C29D88C006826EE /* Registry.cpp */; };
 +		DC7E1E622BCE53E000494CBE /* BeebEm-Bridging-IO.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC7E1E602BCE53E000494CBE /* BeebEm-Bridging-IO.cpp */; };
 +		DC7E1E652BCE58D400494CBE /* FileDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC7E1E632BCE58D400494CBE /* FileDialog-mac.cpp */; };
 +		DC7E1E682BCF229600494CBE /* ExportFileDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC7E1E662BCF229600494CBE /* ExportFileDialog-mac.cpp */; };
 +		DC8450052BE2D7F1002015D9 /* UserKeyboardDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC8450032BE2D7F1002015D9 /* UserKeyboardDialog-mac.cpp */; };
 +		DC8450062BE2DA04002015D9 /* BeebEm-KeyboardMapping.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EB52BB5BB9100523116 /* BeebEm-KeyboardMapping.swift */; };
 +		DC8450092BE3FAF4002015D9 /* UserPortBreakoutBox-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC8450072BE3FAF4002015D9 /* UserPortBreakoutBox-mac.cpp */; };
 +		DC84500B2BE45931002015D9 /* BeebEm-BreakoutBox.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC84500A2BE45931002015D9 /* BeebEm-BreakoutBox.swift */; };
 +		DC84500E2BE4616C002015D9 /* TapeControlDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC84500C2BE4616C002015D9 /* TapeControlDialog-mac.cpp */; };
 +		DC904DA02BCF3C240069DCDF /* BeebEm-ExportFiles.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EB92BB5BC6200523116 /* BeebEm-ExportFiles.swift */; };
 +		DC904DA22BCF3CD60069DCDF /* ExportDiscViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC904DA12BCF3CD60069DCDF /* ExportDiscViewController.swift */; };
 +		DC907E9D2BB4DBCE00523116 /* Assets.xcassets in Resources */ = {isa = PBXBuildFile; fileRef = DC907E9C2BB4DBCE00523116 /* Assets.xcassets */; };
 +		DC907EA02BB4DBCE00523116 /* Preview Assets.xcassets in Resources */ = {isa = PBXBuildFile; fileRef = DC907E9F2BB4DBCE00523116 /* Preview Assets.xcassets */; };
 +		DC907EAD2BB5B7F300523116 /* Main.storyboard in Resources */ = {isa = PBXBuildFile; fileRef = DC907EAB2BB5B7F300523116 /* Main.storyboard */; };
 +		DC907EB02BB5BA4000523116 /* AppDelegate.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EAF2BB5BA4000523116 /* AppDelegate.swift */; };
 +		DC907EB22BB5BAD300523116 /* BeebEm-Panels.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EB12BB5BAD300523116 /* BeebEm-Panels.swift */; };
 +		DC907EC12BB5C1F100523116 /* BeebApplication.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EC02BB5C1F100523116 /* BeebApplication.swift */; };
 +		DC907EC32BB5C23C00523116 /* BeebViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EC22BB5C23C00523116 /* BeebViewController.swift */; };
 +		DC907EC62BB6D48600523116 /* Renderer.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EC52BB6D48600523116 /* Renderer.swift */; };
 +		DC907EC82BB6D55100523116 /* Bitmap.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EC72BB6D55100523116 /* Bitmap.swift */; };
 +		DC907ECA2BB6D76F00523116 /* Colour.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907EC92BB6D76F00523116 /* Colour.swift */; };
 +		DC907ECC2BB70CE000523116 /* NSImage+Bitmap.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907ECB2BB70CE000523116 /* NSImage+Bitmap.swift */; };
 +		DC907ECE2BB70E7B00523116 /* BeebSKView.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC907ECD2BB70E7B00523116 /* BeebSKView.swift */; };
 +		DC90FFD12BEB5B820007EB37 /* Model.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC90FFD02BEB5B820007EB37 /* Model.cpp */; };
 +		DC9427AA2BF037900012C4E4 /* SelectKeyViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC9427A92BF037900012C4E4 /* SelectKeyViewController.swift */; };
 +		DC9427AC2BF038090012C4E4 /* BeebEm-SerialPort.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC9427AB2BF038090012C4E4 /* BeebEm-SerialPort.swift */; };
 +		DC9427AE2BF0386C0012C4E4 /* BeebEm-Teletext.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC9427AD2BF0386C0012C4E4 /* BeebEm-Teletext.swift */; };
 +		DC9427B02BF038B90012C4E4 /* TeletextViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC9427AF2BF038B90012C4E4 /* TeletextViewController.swift */; };
 +		DC9427B22BF038F10012C4E4 /* SerialPortViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DC9427B12BF038F10012C4E4 /* SerialPortViewController.swift */; };
 +		DC9427B52BF0FBAA0012C4E4 /* TeletextDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC9427B32BF0FBAA0012C4E4 /* TeletextDialog-mac.cpp */; };
 +		DC9427B82BF0FBE90012C4E4 /* SerialPortDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC9427B62BF0FBE90012C4E4 /* SerialPortDialog-mac.cpp */; };
 +		DC9B41302BC20C0500C3D9D8 /* IP232.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996E92BBA0C9B00A109A5 /* IP232.cpp */; };
 +		DC9B41312BC2108600C3D9D8 /* Serial.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09970D2BBA0C9C00A109A5 /* Serial.cpp */; };
 +		DC9B41322BC2145D00C3D9D8 /* Thread.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996EB2BBA0C9B00A109A5 /* Thread.cpp */; };
 +		DC9B41332BC2151900C3D9D8 /* Video.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997032BBA0C9C00A109A5 /* Video.cpp */; };
 +		DC9B41342BC215BD00C3D9D8 /* Econet.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09971E2BBA0C9C00A109A5 /* Econet.cpp */; };
 +		DC9B41352BC2190500C3D9D8 /* BeebWin.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996E22BBA0C9B00A109A5 /* BeebWin.cpp */; };
 +		DC9B41372BC22AE700C3D9D8 /* BeebWinIo.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09971D2BBA0C9C00A109A5 /* BeebWinIo.cpp */; };
 +		DC9B413A2BC22FE200C3D9D8 /* BeebWinPrefs.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09970B2BBA0C9C00A109A5 /* BeebWinPrefs.cpp */; };
++		DC9C67E52D8808000026DE4D /* SerialPort.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC9C67E32D8808000026DE4D /* SerialPort.cpp */; };
++		DC9C67E62D8808000026DE4D /* Socket.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC9C67E42D8808000026DE4D /* Socket.cpp */; };
++		DC9C67EC2D880C140026DE4D /* WindowUtils.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC9C67EB2D880C140026DE4D /* WindowUtils.cpp */; };
 +		DCACDAC12BC5DD2E00CEF154 /* apples.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCACDAC02BC5DD2E00CEF154 /* apples.cpp */; };
 +		DCB3B2592BBB865E00F507F4 /* opus.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997BC2BBAA91E00A109A5 /* opus.cpp */; };
 +		DCB4EBC72BD5BCD7002AEA8A /* BeebEm-Bridging-Roms.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCB4EBC52BD5BCD7002AEA8A /* BeebEm-Bridging-Roms.cpp */; };
 +		DCB4EBCA2BD5BD02002AEA8A /* BeebEm-Bridging-BreakoutBox.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCB4EBC82BD5BD02002AEA8A /* BeebEm-Bridging-BreakoutBox.cpp */; };
 +		DCB4EBCD2BD5BD22002AEA8A /* BeebEm-Bridging-UserKeyboard.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCB4EBCB2BD5BD22002AEA8A /* BeebEm-Bridging-UserKeyboard.cpp */; };
 +		DCB4EBD02BD5BD4E002AEA8A /* BeebEm-Bridging-TapeControl.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCB4EBCE2BD5BD4E002AEA8A /* BeebEm-Bridging-TapeControl.cpp */; };
 +		DCB4EBD32BD5BDC4002AEA8A /* BeebEm-Bridging-ExportFIles.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCB4EBD12BD5BDC4002AEA8A /* BeebEm-Bridging-ExportFIles.cpp */; };
 +		DCB4EBD62BDB26F1002AEA8A /* FolderSelectDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCB4EBD42BDB26F1002AEA8A /* FolderSelectDialog-mac.cpp */; };
 +		DCB4EBD92BDB890F002AEA8A /* RenameFileDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCB4EBD72BDB890F002AEA8A /* RenameFileDialog-mac.cpp */; };
 +		DCB4EBDC2BDB89E5002AEA8A /* Dialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCB4EBDA2BDB89E5002AEA8A /* Dialog-mac.cpp */; };
 +		DCBACC552C1591D1005F2079 /* BeebEm.rc in Resources */ = {isa = PBXBuildFile; fileRef = DCBACC532C1591D1005F2079 /* BeebEm.rc */; };
 +		DCC91DB92C1AE5D500B751D5 /* BeebWin-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCC91DB82C1AE5D500B751D5 /* BeebWin-mac.cpp */; };
 +		DCCE05BE2C11DD6300CAAD24 /* AppleSoundStreamer.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCCE05BC2C11DD6300CAAD24 /* AppleSoundStreamer.cpp */; };
 +		DCD283F22BE6E17100ABD9F8 /* SelectKeyDialog-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCD283F02BE6E17100ABD9F8 /* SelectKeyDialog-mac.cpp */; };
 +		DCD283FA2BE8427900ABD9F8 /* BeebWinSpeech-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCD283F92BE8427900ABD9F8 /* BeebWinSpeech-mac.cpp */; };
 +		DCD283FD2BE8C8DA00ABD9F8 /* Debug-mac.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCD283FB2BE8C8DA00ABD9F8 /* Debug-mac.cpp */; };
 +		DCD283FF2BE8D17400ABD9F8 /* BeebEm-Debug.swift in Sources */ = {isa = PBXBuildFile; fileRef = DCD283FE2BE8D17400ABD9F8 /* BeebEm-Debug.swift */; };
 +		DCD284022BE8D22C00ABD9F8 /* DebuggerViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = DCD284012BE8D22C00ABD9F8 /* DebuggerViewController.swift */; };
 +		DCD284052BE8D2D400ABD9F8 /* BeebEm-Debugger.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DCD284032BE8D2D400ABD9F8 /* BeebEm-Debugger.cpp */; };
 +		DCDC73062BBE043A00D83402 /* Acorn.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997AF2BBAA91E00A109A5 /* Acorn.cpp */; };
 +		DCDC73072BBE043D00D83402 /* Watford.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997B72BBAA91E00A109A5 /* Watford.cpp */; };
 +		DCDC73092BBE108600D83402 /* Bcd.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996FE2BBA0C9C00A109A5 /* Bcd.cpp */; };
 +		DCDC730B2BBE118B00D83402 /* Preferences.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09970E2BBA0C9C00A109A5 /* Preferences.cpp */; };
 +		DCDC730E2BBE13BF00D83402 /* DiscInfo.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996F32BBA0C9C00A109A5 /* DiscInfo.cpp */; };
 +		DCDC730F2BBE13EE00D83402 /* FileUtils.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996E62BBA0C9B00A109A5 /* FileUtils.cpp */; };
 +		DCDC73102BBE188400D83402 /* Uef.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996F02BBA0C9B00A109A5 /* Uef.cpp */; };
 +		DCDC73132BBE192200D83402 /* libz.tbd in Frameworks */ = {isa = PBXBuildFile; fileRef = DCDC73122BBE192200D83402 /* libz.tbd */; };
 +		DCDC73142BBE198A00D83402 /* TapeMap.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997182BBA0C9C00A109A5 /* TapeMap.cpp */; };
 +		DCDC73152BBE1A9500D83402 /* StringUtils.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997222BBA0C9C00A109A5 /* StringUtils.cpp */; };
 +		DCDC73162BBE1AC600D83402 /* RingBuffer.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996F12BBA0C9B00A109A5 /* RingBuffer.cpp */; };
 +		DCDC731E2BBE215F00D83402 /* IC32Latch.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996E42BBA0C9B00A109A5 /* IC32Latch.cpp */; };
 +		DCDC73282BBF574100D83402 /* 6502core.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996E72BBA0C9B00A109A5 /* 6502core.cpp */; };
 +		DCDC73292BBF58DC00D83402 /* Arm.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09971B2BBA0C9C00A109A5 /* Arm.cpp */; };
 +		DCDC732A2BBF5AF400D83402 /* ArmDisassembler.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996FD2BBA0C9C00A109A5 /* ArmDisassembler.cpp */; };
 +		DCDC732B2BBF5B7F00D83402 /* armemu.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09972B2BBA0CBB00A109A5 /* armemu.cpp */; };
 +		DCDC732C2BBF5E0600D83402 /* armsupp.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997302BBA0CBB00A109A5 /* armsupp.cpp */; };
 +		DCDC732D2BBF5E1500D83402 /* thumbemu.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997282BBA0CBB00A109A5 /* thumbemu.cpp */; };
 +		DCDC732E2BBF5E1B00D83402 /* arminit.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997312BBA0CBB00A109A5 /* arminit.cpp */; };
 +		DCDC732F2BBF5EF600D83402 /* AtoDConv.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997212BBA0C9C00A109A5 /* AtoDConv.cpp */; };
 +		DCDC73302BBF5F2200D83402 /* BeebMem.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997012BBA0C9C00A109A5 /* BeebMem.cpp */; };
 +		DCDC73312BBF615E00D83402 /* Csw.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996E32BBA0C9B00A109A5 /* Csw.cpp */; };
 +		DCDC73332BBFE79800D83402 /* Disc1770.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09970A2BBA0C9C00A109A5 /* Disc1770.cpp */; };
 +		DCDC73342BBFE87C00D83402 /* Disc8271.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09970F2BBA0C9C00A109A5 /* Disc8271.cpp */; };
 +		DCDC73352BC0A73600D83402 /* DiscEdit.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997142BBA0C9C00A109A5 /* DiscEdit.cpp */; };
 +		DCDC73372BC0A93800D83402 /* Ext1770.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09970C2BBA0C9C00A109A5 /* Ext1770.cpp */; };
 +		DCDC73382BC0A9F800D83402 /* Ide.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997112BBA0C9C00A109A5 /* Ide.cpp */; };
 +		DCDC733C2BC0ACE200D83402 /* Log.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996DF2BBA0C9B00A109A5 /* Log.cpp */; };
 +		DCDC733D2BC0AD1600D83402 /* Master512CoPro.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996F82BBA0C9C00A109A5 /* Master512CoPro.cpp */; };
 +		DCDC733E2BC0AED800D83402 /* Music5000.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997152BBA0C9C00A109A5 /* Music5000.cpp */; };
 +		DCDC733F2BC0AFBC00D83402 /* PALRom.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996F52BBA0C9C00A109A5 /* PALRom.cpp */; };
 +		DCDC73402BC0AFF100D83402 /* Sasi.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996EC2BBA0C9B00A109A5 /* Sasi.cpp */; };
 +		DCDC73412BC0B0E600D83402 /* Scsi.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996EA2BBA0C9B00A109A5 /* Scsi.cpp */; };
 +		DCDC73422BC0B12700D83402 /* Sound.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996FA2BBA0C9C00A109A5 /* Sound.cpp */; };
 +		DCDC73442BC0B43400D83402 /* SoundStreamer.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997122BBA0C9C00A109A5 /* SoundStreamer.cpp */; };
 +		DCDC73452BC0B4A700D83402 /* SprowCoPro.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997052BBA0C9C00A109A5 /* SprowCoPro.cpp */; };
 +		DCDC73462BC0B5B500D83402 /* SysVia.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997062BBA0C9C00A109A5 /* SysVia.cpp */; };
 +		DCDC73472BC0B5C200D83402 /* Teletext.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996FB2BBA0C9C00A109A5 /* Teletext.cpp */; };
 +		DCDC73482BC0B6CC00D83402 /* TouchScreen.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996FF2BBA0C9C00A109A5 /* TouchScreen.cpp */; };
 +		DCDC734A2BC0B75800D83402 /* Tube.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997192BBA0C9C00A109A5 /* Tube.cpp */; };
 +		DCDC734B2BC0B78E00D83402 /* UefState.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996E12BBA0C9B00A109A5 /* UefState.cpp */; };
 +		DCDC734D2BC0B80C00D83402 /* UserVia.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996EE2BBA0C9B00A109A5 /* UserVia.cpp */; };
 +		DCDC734E2BC0B85F00D83402 /* Via.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC09971A2BBA0C9C00A109A5 /* Via.cpp */; };
 +		DCDC734F2BC0B8C500D83402 /* Z80.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997082BBA0C9C00A109A5 /* Z80.cpp */; };
 +		DCDC73502BC0B8D400D83402 /* Z80dis.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0997042BBA0C9C00A109A5 /* Z80dis.cpp */; };
 +		DCDC73512BC0B99700D83402 /* Z80Support.cpp in Sources */ = {isa = PBXBuildFile; fileRef = DC0996EF2BBA0C9B00A109A5 /* Z80Support.cpp */; };
 +		DCE5AD282C3D15AF0080AD01 /* Credits.rtf in Resources */ = {isa = PBXBuildFile; fileRef = DCE5AD272C3D15AF0080AD01 /* Credits.rtf */; };
 +		DCE94C152BD3109500A5C12A /* BeebEm-Menu.swift in Sources */ = {isa = PBXBuildFile; fileRef = DCE94C142BD3109500A5C12A /* BeebEm-Menu.swift */; };
 +		DCE94C172BD310C600A5C12A /* BeebEm-Sound.swift in Sources */ = {isa = PBXBuildFile; fileRef = DCE94C162BD310C600A5C12A /* BeebEm-Sound.swift */; };
 +		DCE94C192BD3117200A5C12A /* BeebEm-Files.swift in Sources */ = {isa = PBXBuildFile; fileRef = DCE94C182BD3117200A5C12A /* BeebEm-Files.swift */; };
 +		DCE94C1B2BD311D800A5C12A /* BeebEm-Bundle.swift in Sources */ = {isa = PBXBuildFile; fileRef = DCE94C1A2BD311D800A5C12A /* BeebEm-Bundle.swift */; };
 +		DCE94C1D2BD312B100A5C12A /* BeebEm-Beeb.swift in Sources */ = {isa = PBXBuildFile; fileRef = DCE94C1C2BD312B100A5C12A /* BeebEm-Beeb.swift */; };
 +/* End PBXBuildFile section */
 +
 +/* Begin PBXFileReference section */
 +		DC0996DD2BBA0C9B00A109A5 /* UserPortBreakoutBox.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = UserPortBreakoutBox.cpp; path = ../../../Src/UserPortBreakoutBox.cpp; sourceTree = "<group>"; };
 +		DC0996DE2BBA0C9B00A109A5 /* UserKeyboardDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = UserKeyboardDialog.cpp; path = ../../../Src/UserKeyboardDialog.cpp; sourceTree = "<group>"; };
 +		DC0996DF2BBA0C9B00A109A5 /* Log.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Log.cpp; path = ../../../Src/Log.cpp; sourceTree = "<group>"; };
 +		DC0996E02BBA0C9B00A109A5 /* SerialPortDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = SerialPortDialog.cpp; path = ../../../Src/SerialPortDialog.cpp; sourceTree = "<group>"; };
 +		DC0996E12BBA0C9B00A109A5 /* UefState.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = UefState.cpp; path = ../../../Src/UefState.cpp; sourceTree = "<group>"; };
 +		DC0996E22BBA0C9B00A109A5 /* BeebWin.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = BeebWin.cpp; path = ../../../Src/BeebWin.cpp; sourceTree = "<group>"; };
 +		DC0996E32BBA0C9B00A109A5 /* Csw.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Csw.cpp; path = ../../../Src/Csw.cpp; sourceTree = "<group>"; };
 +		DC0996E42BBA0C9B00A109A5 /* IC32Latch.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = IC32Latch.cpp; path = ../../../Src/IC32Latch.cpp; sourceTree = "<group>"; };
 +		DC0996E52BBA0C9B00A109A5 /* RomConfigDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = RomConfigDialog.cpp; path = ../../../Src/RomConfigDialog.cpp; sourceTree = "<group>"; };
 +		DC0996E62BBA0C9B00A109A5 /* FileUtils.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = FileUtils.cpp; path = ../../../Src/FileUtils.cpp; sourceTree = "<group>"; };
 +		DC0996E72BBA0C9B00A109A5 /* 6502core.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = 6502core.cpp; path = ../../../Src/6502core.cpp; sourceTree = "<group>"; };
 +		DC0996E82BBA0C9B00A109A5 /* Debug.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Debug.cpp; path = ../../../Src/Debug.cpp; sourceTree = "<group>"; };
 +		DC0996E92BBA0C9B00A109A5 /* IP232.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = IP232.cpp; path = ../../../Src/IP232.cpp; sourceTree = "<group>"; };
 +		DC0996EA2BBA0C9B00A109A5 /* Scsi.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Scsi.cpp; path = ../../../Src/Scsi.cpp; sourceTree = "<group>"; };
 +		DC0996EB2BBA0C9B00A109A5 /* Thread.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Thread.cpp; path = ../../../Src/Thread.cpp; sourceTree = "<group>"; };
 +		DC0996EC2BBA0C9B00A109A5 /* Sasi.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Sasi.cpp; path = ../../../Src/Sasi.cpp; sourceTree = "<group>"; };
 +		DC0996ED2BBA0C9B00A109A5 /* DebugTrace.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = DebugTrace.cpp; path = ../../../Src/DebugTrace.cpp; sourceTree = "<group>"; };
 +		DC0996EE2BBA0C9B00A109A5 /* UserVia.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = UserVia.cpp; path = ../../../Src/UserVia.cpp; sourceTree = "<group>"; };
 +		DC0996EF2BBA0C9B00A109A5 /* Z80Support.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Z80Support.cpp; path = ../../../Src/Z80Support.cpp; sourceTree = "<group>"; };
 +		DC0996F02BBA0C9B00A109A5 /* Uef.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Uef.cpp; path = ../../../Src/Uef.cpp; sourceTree = "<group>"; };
 +		DC0996F12BBA0C9B00A109A5 /* RingBuffer.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = RingBuffer.cpp; path = ../../../Src/RingBuffer.cpp; sourceTree = "<group>"; };
 +		DC0996F22BBA0C9C00A109A5 /* BeebWinDx.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = BeebWinDx.cpp; path = ../../../Src/BeebWinDx.cpp; sourceTree = "<group>"; };
 +		DC0996F32BBA0C9C00A109A5 /* DiscInfo.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = DiscInfo.cpp; path = ../../../Src/DiscInfo.cpp; sourceTree = "<group>"; };
 +		DC0996F42BBA0C9C00A109A5 /* BeebWinSpeech.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = BeebWinSpeech.cpp; path = ../../../Src/BeebWinSpeech.cpp; sourceTree = "<group>"; };
 +		DC0996F52BBA0C9C00A109A5 /* PALRom.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = PALRom.cpp; path = ../../../Src/PALRom.cpp; sourceTree = "<group>"; };
 +		DC0996F62BBA0C9C00A109A5 /* AVIWriter.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = AVIWriter.cpp; path = ../../../Src/AVIWriter.cpp; sourceTree = "<group>"; };
 +		DC0996F72BBA0C9C00A109A5 /* Main.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Main.cpp; path = ../../../Src/Main.cpp; sourceTree = "<group>"; };
 +		DC0996F82BBA0C9C00A109A5 /* Master512CoPro.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Master512CoPro.cpp; path = ../../../Src/Master512CoPro.cpp; sourceTree = "<group>"; };
 +		DC0996F92BBA0C9C00A109A5 /* FileDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = FileDialog.cpp; path = ../../../Src/FileDialog.cpp; sourceTree = "<group>"; };
 +		DC0996FA2BBA0C9C00A109A5 /* Sound.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Sound.cpp; path = ../../../Src/Sound.cpp; sourceTree = "<group>"; };
 +		DC0996FB2BBA0C9C00A109A5 /* Teletext.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Teletext.cpp; path = ../../../Src/Teletext.cpp; sourceTree = "<group>"; };
 +		DC0996FC2BBA0C9C00A109A5 /* KeyboardLinksDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = KeyboardLinksDialog.cpp; path = ../../../Src/KeyboardLinksDialog.cpp; sourceTree = "<group>"; };
 +		DC0996FD2BBA0C9C00A109A5 /* ArmDisassembler.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = ArmDisassembler.cpp; path = ../../../Src/ArmDisassembler.cpp; sourceTree = "<group>"; };
 +		DC0996FE2BBA0C9C00A109A5 /* Bcd.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Bcd.cpp; path = ../../../Src/Bcd.cpp; sourceTree = "<group>"; };
 +		DC0996FF2BBA0C9C00A109A5 /* TouchScreen.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = TouchScreen.cpp; path = ../../../Src/TouchScreen.cpp; sourceTree = "<group>"; };
 +		DC0997002BBA0C9C00A109A5 /* FolderSelectDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = FolderSelectDialog.cpp; path = ../../../Src/FolderSelectDialog.cpp; sourceTree = "<group>"; };
 +		DC0997012BBA0C9C00A109A5 /* BeebMem.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = BeebMem.cpp; path = ../../../Src/BeebMem.cpp; sourceTree = "<group>"; };
 +		DC0997022BBA0C9C00A109A5 /* AboutDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = AboutDialog.cpp; path = ../../../Src/AboutDialog.cpp; sourceTree = "<group>"; };
 +		DC0997032BBA0C9C00A109A5 /* Video.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Video.cpp; path = ../../../Src/Video.cpp; sourceTree = "<group>"; };
 +		DC0997042BBA0C9C00A109A5 /* Z80dis.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Z80dis.cpp; path = ../../../Src/Z80dis.cpp; sourceTree = "<group>"; };
 +		DC0997052BBA0C9C00A109A5 /* SprowCoPro.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = SprowCoPro.cpp; path = ../../../Src/SprowCoPro.cpp; sourceTree = "<group>"; };
 +		DC0997062BBA0C9C00A109A5 /* SysVia.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = SysVia.cpp; path = ../../../Src/SysVia.cpp; sourceTree = "<group>"; };
 +		DC0997072BBA0C9C00A109A5 /* ListView.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = ListView.cpp; path = ../../../Src/ListView.cpp; sourceTree = "<group>"; };
 +		DC0997082BBA0C9C00A109A5 /* Z80.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Z80.cpp; path = ../../../Src/Z80.cpp; sourceTree = "<group>"; };
 +		DC0997092BBA0C9C00A109A5 /* RenameFileDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = RenameFileDialog.cpp; path = ../../../Src/RenameFileDialog.cpp; sourceTree = "<group>"; };
 +		DC09970A2BBA0C9C00A109A5 /* Disc1770.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Disc1770.cpp; path = ../../../Src/Disc1770.cpp; sourceTree = "<group>"; };
 +		DC09970B2BBA0C9C00A109A5 /* BeebWinPrefs.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = BeebWinPrefs.cpp; path = ../../../Src/BeebWinPrefs.cpp; sourceTree = "<group>"; };
 +		DC09970C2BBA0C9C00A109A5 /* Ext1770.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Ext1770.cpp; path = ../../../Src/Ext1770.cpp; sourceTree = "<group>"; };
 +		DC09970D2BBA0C9C00A109A5 /* Serial.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Serial.cpp; path = ../../../Src/Serial.cpp; sourceTree = "<group>"; };
 +		DC09970E2BBA0C9C00A109A5 /* Preferences.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Preferences.cpp; path = ../../../Src/Preferences.cpp; sourceTree = "<group>"; };
 +		DC09970F2BBA0C9C00A109A5 /* Disc8271.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Disc8271.cpp; path = ../../../Src/Disc8271.cpp; sourceTree = "<group>"; };
 +		DC0997102BBA0C9C00A109A5 /* ExportFileDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = ExportFileDialog.cpp; path = ../../../Src/ExportFileDialog.cpp; sourceTree = "<group>"; };
 +		DC0997112BBA0C9C00A109A5 /* Ide.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Ide.cpp; path = ../../../Src/Ide.cpp; sourceTree = "<group>"; };
 +		DC0997122BBA0C9C00A109A5 /* SoundStreamer.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = SoundStreamer.cpp; path = ../../../Src/SoundStreamer.cpp; sourceTree = "<group>"; };
 +		DC0997132BBA0C9C00A109A5 /* KeyMap.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = KeyMap.cpp; path = ../../../Src/KeyMap.cpp; sourceTree = "<group>"; };
 +		DC0997142BBA0C9C00A109A5 /* DiscEdit.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = DiscEdit.cpp; path = ../../../Src/DiscEdit.cpp; sourceTree = "<group>"; };
 +		DC0997152BBA0C9C00A109A5 /* Music5000.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Music5000.cpp; path = ../../../Src/Music5000.cpp; sourceTree = "<group>"; };
 +		DC0997162BBA0C9C00A109A5 /* DirectSoundStreamer.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = DirectSoundStreamer.cpp; path = ../../../Src/DirectSoundStreamer.cpp; sourceTree = "<group>"; };
 +		DC0997172BBA0C9C00A109A5 /* TapeControlDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = TapeControlDialog.cpp; path = ../../../Src/TapeControlDialog.cpp; sourceTree = "<group>"; };
 +		DC0997182BBA0C9C00A109A5 /* TapeMap.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = TapeMap.cpp; path = ../../../Src/TapeMap.cpp; sourceTree = "<group>"; };
 +		DC0997192BBA0C9C00A109A5 /* Tube.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Tube.cpp; path = ../../../Src/Tube.cpp; sourceTree = "<group>"; };
 +		DC09971A2BBA0C9C00A109A5 /* Via.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Via.cpp; path = ../../../Src/Via.cpp; sourceTree = "<group>"; };
 +		DC09971B2BBA0C9C00A109A5 /* Arm.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Arm.cpp; path = ../../../Src/Arm.cpp; sourceTree = "<group>"; };
 +		DC09971C2BBA0C9C00A109A5 /* Dialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Dialog.cpp; path = ../../../Src/Dialog.cpp; sourceTree = "<group>"; };
 +		DC09971D2BBA0C9C00A109A5 /* BeebWinIo.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = BeebWinIo.cpp; path = ../../../Src/BeebWinIo.cpp; sourceTree = "<group>"; };
 +		DC09971E2BBA0C9C00A109A5 /* Econet.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Econet.cpp; path = ../../../Src/Econet.cpp; sourceTree = "<group>"; };
 +		DC09971F2BBA0C9C00A109A5 /* XAudio2Streamer.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = XAudio2Streamer.cpp; path = ../../../Src/XAudio2Streamer.cpp; sourceTree = "<group>"; };
 +		DC0997202BBA0C9C00A109A5 /* SelectKeyDialog.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = SelectKeyDialog.cpp; path = ../../../Src/SelectKeyDialog.cpp; sourceTree = "<group>"; };
 +		DC0997212BBA0C9C00A109A5 /* AtoDConv.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = AtoDConv.cpp; path = ../../../Src/AtoDConv.cpp; sourceTree = "<group>"; };
 +		DC0997222BBA0C9C00A109A5 /* StringUtils.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = StringUtils.cpp; path = ../../../Src/StringUtils.cpp; sourceTree = "<group>"; };
 +		DC0997232BBA0C9C00A109A5 /* Speech.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; name = Speech.cpp; path = ../../../Src/Speech.cpp; sourceTree = "<group>"; };
 +		DC0997282BBA0CBB00A109A5 /* thumbemu.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = thumbemu.cpp; sourceTree = "<group>"; };
 +		DC09972B2BBA0CBB00A109A5 /* armemu.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = armemu.cpp; sourceTree = "<group>"; };
 +		DC09972C2BBA0CBB00A109A5 /* armdis.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = armdis.cpp; sourceTree = "<group>"; };
 +		DC0997302BBA0CBB00A109A5 /* armsupp.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = armsupp.cpp; sourceTree = "<group>"; };
 +		DC0997312BBA0CBB00A109A5 /* arminit.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = arminit.cpp; sourceTree = "<group>"; };
 +		DC0997352BBA0CD400A109A5 /* armos.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = armos.h; sourceTree = "<group>"; };
 +		DC0997362BBA0CD400A109A5 /* iwmmxt.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = iwmmxt.h; sourceTree = "<group>"; };
 +		DC0997382BBA0CD400A109A5 /* armdis.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = armdis.h; sourceTree = "<group>"; };
 +		DC0997392BBA0CD400A109A5 /* ansidecl.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = ansidecl.h; sourceTree = "<group>"; };
 +		DC09973C2BBA0CD400A109A5 /* armopts.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = armopts.h; sourceTree = "<group>"; };
 +		DC09973D2BBA0CD400A109A5 /* dbg_rdi.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = dbg_rdi.h; sourceTree = "<group>"; };
 +		DC09973E2BBA0CD400A109A5 /* armdefs.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = armdefs.h; sourceTree = "<group>"; };
 +		DC0997412BBA0CD400A109A5 /* armemu.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = armemu.h; sourceTree = "<group>"; };
 +		DC0997482BBA0E2500A109A5 /* StringUtils.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = StringUtils.h; path = ../../../Src/StringUtils.h; sourceTree = "<group>"; };
 +		DC0997492BBA0E2500A109A5 /* DiscInfo.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = DiscInfo.h; path = ../../../Src/DiscInfo.h; sourceTree = "<group>"; };
 +		DC09974A2BBA0E2500A109A5 /* ML675001.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = ML675001.h; path = ../../../Src/ML675001.h; sourceTree = "<group>"; };
 +		DC09974B2BBA0E2500A109A5 /* KeyboardLinksDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = KeyboardLinksDialog.h; path = ../../../Src/KeyboardLinksDialog.h; sourceTree = "<group>"; };
 +		DC09974C2BBA0E2500A109A5 /* TapeMap.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = TapeMap.h; path = ../../../Src/TapeMap.h; sourceTree = "<group>"; };
 +		DC09974D2BBA0E2500A109A5 /* IP232.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = IP232.h; path = ../../../Src/IP232.h; sourceTree = "<group>"; };
 +		DC09974E2BBA0E2500A109A5 /* TapeControlDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = TapeControlDialog.h; path = ../../../Src/TapeControlDialog.h; sourceTree = "<group>"; };
 +		DC09974F2BBA0E2500A109A5 /* PALRom.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = PALRom.h; path = ../../../Src/PALRom.h; sourceTree = "<group>"; };
 +		DC0997502BBA0E2500A109A5 /* TouchScreen.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = TouchScreen.h; path = ../../../Src/TouchScreen.h; sourceTree = "<group>"; };
 +		DC0997512BBA0E2500A109A5 /* ArmDisassembler.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = ArmDisassembler.h; path = ../../../Src/ArmDisassembler.h; sourceTree = "<group>"; };
 +		DC0997522BBA0E2500A109A5 /* Csw.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Csw.h; path = ../../../Src/Csw.h; sourceTree = "<group>"; };
 +		DC0997532BBA0E2500A109A5 /* FileDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = FileDialog.h; path = ../../../Src/FileDialog.h; sourceTree = "<group>"; };
 +		DC0997542BBA0E2500A109A5 /* FileUtils.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = FileUtils.h; path = ../../../Src/FileUtils.h; sourceTree = "<group>"; };
 +		DC0997552BBA0E2500A109A5 /* BeebMem.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = BeebMem.h; path = ../../../Src/BeebMem.h; sourceTree = "<group>"; };
 +		DC0997562BBA0E2500A109A5 /* Bcd.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Bcd.h; path = ../../../Src/Bcd.h; sourceTree = "<group>"; };
 +		DC0997572BBA0E2500A109A5 /* Sasi.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Sasi.h; path = ../../../Src/Sasi.h; sourceTree = "<group>"; };
 +		DC0997582BBA0E2500A109A5 /* 6502core.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = 6502core.h; path = ../../../Src/6502core.h; sourceTree = "<group>"; };
 +		DC0997592BBA0E2500A109A5 /* SelectKeyDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = SelectKeyDialog.h; path = ../../../Src/SelectKeyDialog.h; sourceTree = "<group>"; };
 +		DC09975A2BBA0E2500A109A5 /* Video.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Video.h; path = ../../../Src/Video.h; sourceTree = "<group>"; };
 +		DC09975B2BBA0E2500A109A5 /* FolderSelectDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = FolderSelectDialog.h; path = ../../../Src/FolderSelectDialog.h; sourceTree = "<group>"; };
 +		DC09975C2BBA0E2500A109A5 /* ARMulator.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = ARMulator.h; path = ../../../Src/ARMulator.h; sourceTree = "<group>"; };
 +		DC09975D2BBA0E2600A109A5 /* AboutDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = AboutDialog.h; path = ../../../Src/AboutDialog.h; sourceTree = "<group>"; };
 +		DC09975E2BBA0E2600A109A5 /* Serial.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Serial.h; path = ../../../Src/Serial.h; sourceTree = "<group>"; };
 +		DC09975F2BBA0E2600A109A5 /* Econet.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Econet.h; path = ../../../Src/Econet.h; sourceTree = "<group>"; };
 +		DC0997602BBA0E2600A109A5 /* Model.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Model.h; path = ../../../Src/Model.h; sourceTree = "<group>"; };
 +		DC0997612BBA0E2600A109A5 /* SoundStreamer.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = SoundStreamer.h; path = ../../../Src/SoundStreamer.h; sourceTree = "<group>"; };
 +		DC0997622BBA0E2600A109A5 /* Speech.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Speech.h; path = ../../../Src/Speech.h; sourceTree = "<group>"; };
 +		DC0997632BBA0E2600A109A5 /* DirectSoundStreamer.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = DirectSoundStreamer.h; path = ../../../Src/DirectSoundStreamer.h; sourceTree = "<group>"; };
 +		DC0997642BBA0E2600A109A5 /* Via.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Via.h; path = ../../../Src/Via.h; sourceTree = "<group>"; };
 +		DC0997652BBA0E2600A109A5 /* Music5000.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Music5000.h; path = ../../../Src/Music5000.h; sourceTree = "<group>"; };
 +		DC0997662BBA0E2600A109A5 /* Ide.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Ide.h; path = ../../../Src/Ide.h; sourceTree = "<group>"; };
 +		DC0997672BBA0E2600A109A5 /* Master512CoPro.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Master512CoPro.h; path = ../../../Src/Master512CoPro.h; sourceTree = "<group>"; };
 +		DC0997682BBA0E2600A109A5 /* SysVia.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = SysVia.h; path = ../../../Src/SysVia.h; sourceTree = "<group>"; };
 +		DC0997692BBA0E2600A109A5 /* Disc8271.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Disc8271.h; path = ../../../Src/Disc8271.h; sourceTree = "<group>"; };
 +		DC09976A2BBA0E2600A109A5 /* Main.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Main.h; path = ../../../Src/Main.h; sourceTree = "<group>"; };
 +		DC09976B2BBA0E2600A109A5 /* KeyMap.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = KeyMap.h; path = ../../../Src/KeyMap.h; sourceTree = "<group>"; };
 +		DC09976C2BBA0E2600A109A5 /* Thread.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Thread.h; path = ../../../Src/Thread.h; sourceTree = "<group>"; };
 +		DC09976D2BBA0E2600A109A5 /* AtoDConv.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = AtoDConv.h; path = ../../../Src/AtoDConv.h; sourceTree = "<group>"; };
 +		DC09976E2BBA0E2600A109A5 /* DebugTrace.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = DebugTrace.h; path = ../../../Src/DebugTrace.h; sourceTree = "<group>"; };
 +		DC09976F2BBA0E2600A109A5 /* ListView.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = ListView.h; path = ../../../Src/ListView.h; sourceTree = "<group>"; };
 +		DC0997702BBA0E2600A109A5 /* RomConfigDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = RomConfigDialog.h; path = ../../../Src/RomConfigDialog.h; sourceTree = "<group>"; };
 +		DC0997712BBA0E2600A109A5 /* Tube.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Tube.h; path = ../../../Src/Tube.h; sourceTree = "<group>"; };
 +		DC0997722BBA0E2600A109A5 /* BeebWin.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = BeebWin.h; path = ../../../Src/BeebWin.h; sourceTree = "<group>"; };
 +		DC0997732BBA0E2600A109A5 /* Ext1770.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Ext1770.h; path = ../../../Src/Ext1770.h; sourceTree = "<group>"; };
 +		DC0997742BBA0E2600A109A5 /* Port.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Port.h; path = ../../../Src/Port.h; sourceTree = "<group>"; };
 +		DC0997752BBA0E2600A109A5 /* ExportFileDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = ExportFileDialog.h; path = ../../../Src/ExportFileDialog.h; sourceTree = "<group>"; };
 +		DC0997762BBA0E2600A109A5 /* AVIWriter.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = AVIWriter.h; path = ../../../Src/AVIWriter.h; sourceTree = "<group>"; };
 +		DC0997772BBA0E2600A109A5 /* DiscEdit.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = DiscEdit.h; path = ../../../Src/DiscEdit.h; sourceTree = "<group>"; };
 +		DC0997782BBA0E2600A109A5 /* Z80mem.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Z80mem.h; path = ../../../Src/Z80mem.h; sourceTree = "<group>"; };
 +		DC0997792BBA0E2600A109A5 /* SerialPortDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = SerialPortDialog.h; path = ../../../Src/SerialPortDialog.h; sourceTree = "<group>"; };
 +		DC09977A2BBA0E2600A109A5 /* Arm.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Arm.h; path = ../../../Src/Arm.h; sourceTree = "<group>"; };
 +		DC09977B2BBA0E2600A109A5 /* RenameFileDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = RenameFileDialog.h; path = ../../../Src/RenameFileDialog.h; sourceTree = "<group>"; };
 +		DC09977C2BBA0E2600A109A5 /* DiscType.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = DiscType.h; path = ../../../Src/DiscType.h; sourceTree = "<group>"; };
 +		DC09977D2BBA0E2600A109A5 /* Scsi.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Scsi.h; path = ../../../Src/Scsi.h; sourceTree = "<group>"; };
 +		DC09977E2BBA0E2600A109A5 /* Debug.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Debug.h; path = ../../../Src/Debug.h; sourceTree = "<group>"; };
 +		DC09977F2BBA0E2600A109A5 /* Log.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Log.h; path = ../../../Src/Log.h; sourceTree = "<group>"; };
 +		DC0997802BBA0E2600A109A5 /* Disc1770.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Disc1770.h; path = ../../../Src/Disc1770.h; sourceTree = "<group>"; };
 +		DC0997812BBA0E2600A109A5 /* IC32Latch.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = IC32Latch.h; path = ../../../Src/IC32Latch.h; sourceTree = "<group>"; };
 +		DC0997822BBA0E2600A109A5 /* Resource.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Resource.h; path = ../../../Src/Resource.h; sourceTree = "<group>"; };
 +		DC0997832BBA0E2600A109A5 /* Sound.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Sound.h; path = ../../../Src/Sound.h; sourceTree = "<group>"; };
 +		DC0997842BBA0E2600A109A5 /* Teletext.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Teletext.h; path = ../../../Src/Teletext.h; sourceTree = "<group>"; };
 +		DC0997852BBA0E2600A109A5 /* Uef.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Uef.h; path = ../../../Src/Uef.h; sourceTree = "<group>"; };
 +		DC0997862BBA0E2600A109A5 /* Preferences.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Preferences.h; path = ../../../Src/Preferences.h; sourceTree = "<group>"; };
 +		DC0997872BBA0E2600A109A5 /* UserKeyboardDialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = UserKeyboardDialog.h; path = ../../../Src/UserKeyboardDialog.h; sourceTree = "<group>"; };
 +		DC0997882BBA0E2700A109A5 /* TarmacGlobals.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = TarmacGlobals.h; path = ../../../Src/TarmacGlobals.h; sourceTree = "<group>"; };
 +		DC0997892BBA0E2700A109A5 /* XAudio2Streamer.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = XAudio2Streamer.h; path = ../../../Src/XAudio2Streamer.h; sourceTree = "<group>"; };
 +		DC09978A2BBA0E2700A109A5 /* RingBuffer.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = RingBuffer.h; path = ../../../Src/RingBuffer.h; sourceTree = "<group>"; };
 +		DC09978B2BBA0E2700A109A5 /* SprowCoPro.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = SprowCoPro.h; path = ../../../Src/SprowCoPro.h; sourceTree = "<group>"; };
 +		DC09978C2BBA0E2700A109A5 /* Dialog.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Dialog.h; path = ../../../Src/Dialog.h; sourceTree = "<group>"; };
 +		DC09978D2BBA0E2700A109A5 /* UefState.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = UefState.h; path = ../../../Src/UefState.h; sourceTree = "<group>"; };
 +		DC09978E2BBA0E2700A109A5 /* UserPortBreakoutBox.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = UserPortBreakoutBox.h; path = ../../../Src/UserPortBreakoutBox.h; sourceTree = "<group>"; };
 +		DC09978F2BBA0E2700A109A5 /* Messages.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Messages.h; path = ../../../Src/Messages.h; sourceTree = "<group>"; };
 +		DC0997902BBA0E2700A109A5 /* UserVia.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = UserVia.h; path = ../../../Src/UserVia.h; sourceTree = "<group>"; };
 +		DC0997912BBA0E2700A109A5 /* Version.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Version.h; path = ../../../Src/Version.h; sourceTree = "<group>"; };
 +		DC0997922BBA0E2700A109A5 /* Z80.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Z80.h; path = ../../../Src/Z80.h; sourceTree = "<group>"; };
 +		DC0997992BBAA51200A109A5 /* beebemrcids.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = beebemrcids.h; sourceTree = "<group>"; };
 +		DC09979D2BBAA51300A109A5 /* beebemrcids.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; path = beebemrcids.cpp; sourceTree = "<group>"; };
 +		DC0997A52BBAA5D500A109A5 /* windows.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = windows.h; path = Src/windows_stubs/windows.h; sourceTree = SOURCE_ROOT; };
 +		DC0997A72BBAA68600A109A5 /* d3d9.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = d3d9.h; sourceTree = "<group>"; };
 +		DC0997A82BBAA6A300A109A5 /* ddraw.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = ddraw.h; sourceTree = "<group>"; };
 +		DC0997A92BBAA6C200A109A5 /* sapi.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = sapi.h; sourceTree = "<group>"; };
 +		DC0997AB2BBAA8D100A109A5 /* armmem.c */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.c; path = armmem.c; sourceTree = "<group>"; };
 +		DC0997AF2BBAA91E00A109A5 /* Acorn.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; path = Acorn.cpp; sourceTree = "<group>"; };
 +		DC0997B12BBAA91E00A109A5 /* Acorn.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = Acorn.h; sourceTree = "<group>"; };
 +		DC0997B62BBAA91E00A109A5 /* Watford.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = Watford.h; sourceTree = "<group>"; };
 +		DC0997B72BBAA91E00A109A5 /* Watford.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; path = Watford.cpp; sourceTree = "<group>"; };
 +		DC0997BA2BBAA91E00A109A5 /* opus.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; path = opus.h; sourceTree = "<group>"; };
 +		DC0997BC2BBAA91E00A109A5 /* opus.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; path = opus.cpp; sourceTree = "<group>"; };
 +		DC1DBA132BB8CF0400AAB22F /* KeyboardMappingViewController.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = KeyboardMappingViewController.swift; sourceTree = "<group>"; };
 +		DC1DBA142BB8CF0500AAB22F /* BreakoutBoxViewController.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = BreakoutBoxViewController.swift; sourceTree = "<group>"; };
 +		DC1DBA152BB8CF0500AAB22F /* RomConfigViewController.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = RomConfigViewController.swift; sourceTree = "<group>"; };
 +		DC1DBA162BB8CF0500AAB22F /* TapeControlViewController.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = TapeControlViewController.swift; sourceTree = "<group>"; };
 +		DC215BE72C13C27E003E50A3 /* Registry.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Registry.h; path = ../../../Src/Registry.h; sourceTree = "<group>"; };
 +		DC2C9CFE2BF9444F00F2E613 /* process.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = process.h; sourceTree = "<group>"; };
 +		DC2C9CFF2BF9788700F2E613 /* Rtc.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = Rtc.h; path = ../../../Src/Rtc.h; sourceTree = "<group>"; };
 +		DC2C9D002BF9788700F2E613 /* RomConfigFile.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = RomConfigFile.cpp; path = ../../../Src/RomConfigFile.cpp; sourceTree = "<group>"; };
 +		DC2C9D012BF9788700F2E613 /* RomConfigFile.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = RomConfigFile.h; path = ../../../Src/RomConfigFile.h; sourceTree = "<group>"; };
 +		DC2C9D022BF9788700F2E613 /* Rtc.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = Rtc.cpp; path = ../../../Src/Rtc.cpp; sourceTree = "<group>"; };
 +		DC2C9D052BF978AE00F2E613 /* UserPortRTC.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = UserPortRTC.cpp; path = ../../../Src/UserPortRTC.cpp; sourceTree = "<group>"; };
 +		DC2C9D062BF978AF00F2E613 /* UserPortRTC.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = UserPortRTC.h; path = ../../../Src/UserPortRTC.h; sourceTree = "<group>"; };
 +		DC33555D2BDF84C00014DC3A /* RomConfigDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "RomConfigDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DC33555E2BDF84C00014DC3A /* RomConfigDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "RomConfigDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DC3FB5492BE8DEDB00CF36A0 /* KeyMap-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "KeyMap-mac.cpp"; sourceTree = "<group>"; };
 +		DC3FB54A2BE8DEDB00CF36A0 /* KeyMap-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "KeyMap-mac.hpp"; sourceTree = "<group>"; };
 +		DC423BFE2BFC7F99009736E1 /* vfw.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = vfw.h; sourceTree = "<group>"; };
 +		DC527BC42BC75107000D7CCF /* Teletext.fnt */ = {isa = PBXFileReference; lastKnownFileType = file; name = Teletext.fnt; path = ../../Teletext.fnt; sourceTree = "<group>"; };
 +		DC527BC52BC75107000D7CCF /* RelayOn.snd */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; name = RelayOn.snd; path = ../../RelayOn.snd; sourceTree = "<group>"; };
 +		DC527BC62BC75107000D7CCF /* README.md */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = net.daringfireball.markdown; name = README.md; path = ../../README.md; sourceTree = "<group>"; };
 +		DC527BC72BC75107000D7CCF /* RelayOff.snd */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; name = RelayOff.snd; path = ../../RelayOff.snd; sourceTree = "<group>"; };
 +		DC527BCC2BC75114000D7CCF /* DriveMotor.snd */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; name = DriveMotor.snd; path = ../../DriveMotor.snd; sourceTree = "<group>"; };
 +		DC527BCD2BC75114000D7CCF /* HeadStep.snd */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; name = HeadStep.snd; path = ../../HeadStep.snd; sourceTree = "<group>"; };
 +		DC527BCE2BC75114000D7CCF /* HeadSeek.snd */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; name = HeadSeek.snd; path = ../../HeadSeek.snd; sourceTree = "<group>"; };
 +		DC527BCF2BC75114000D7CCF /* HeadUnload.snd */ = {isa = PBXFileReference; lastKnownFileType = file; name = HeadUnload.snd; path = ../../HeadUnload.snd; sourceTree = "<group>"; };
 +		DC527BD02BC75114000D7CCF /* HeadLoad.snd */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; name = HeadLoad.snd; path = ../../HeadLoad.snd; sourceTree = "<group>"; };
 +		DC527BD62BC75122000D7CCF /* COPYRIGHT.txt */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; name = COPYRIGHT.txt; path = ../../COPYRIGHT.txt; sourceTree = "<group>"; };
 +		DC527C1D2BC75165000D7CCF /* CHANGES.md */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = net.daringfireball.markdown; name = CHANGES.md; path = ../../CHANGES.md; sourceTree = "<group>"; };
 +		DC527C1F2BC75175000D7CCF /* README-SPROW.txt */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; name = "README-SPROW.txt"; path = "../../README-SPROW.txt"; sourceTree = "<group>"; };
 +		DC527D112BC75316000D7CCF /* UserData */ = {isa = PBXFileReference; lastKnownFileType = folder; name = UserData; path = ../../UserData; sourceTree = "<group>"; };
 +		DC527D132BC7532E000D7CCF /* Help */ = {isa = PBXFileReference; lastKnownFileType = folder; name = Help; path = ../../Help; sourceTree = "<group>"; };
 +		DC527D152BC9110E000D7CCF /* BeebEm-Bridging-Keyboard.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-Keyboard.cpp"; sourceTree = "<group>"; };
 +		DC689D0C2C2D3E68009BA41F /* BeebEm-Bridging-SerialPort.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-SerialPort.cpp"; sourceTree = "<group>"; };
 +		DC69C9F42BF2BDB600610067 /* KeyboardLinksViewController.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = KeyboardLinksViewController.swift; sourceTree = "<group>"; };
 +		DC69C9F62BF2BDC700610067 /* BeebEm-KeyboardLinks.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-KeyboardLinks.swift"; sourceTree = "<group>"; };
 +		DC69C9F82BF2BDE100610067 /* KeyboardLinksDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "KeyboardLinksDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DC69C9F92BF2BDE100610067 /* KeyboardLinksDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "KeyboardLinksDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DC69C9FB2BF2C87A00610067 /* BeebEm-Bridging-KeyboardLinks.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-KeyboardLinks.cpp"; sourceTree = "<group>"; };
 +		DC74E1CB2C29D88C006826EE /* FileType.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = FileType.cpp; path = ../../../Src/FileType.cpp; sourceTree = "<group>"; };
 +		DC74E1CC2C29D88C006826EE /* FileType.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = FileType.h; path = ../../../Src/FileType.h; sourceTree = "<group>"; };
 +		DC74E1CD2C29D88C006826EE /* Registry.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = Registry.cpp; path = ../../../Src/Registry.cpp; sourceTree = "<group>"; };
 +		DC7E1E602BCE53E000494CBE /* BeebEm-Bridging-IO.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-IO.cpp"; sourceTree = "<group>"; };
 +		DC7E1E632BCE58D400494CBE /* FileDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "FileDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DC7E1E642BCE58D400494CBE /* FileDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "FileDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DC7E1E662BCF229600494CBE /* ExportFileDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "ExportFileDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DC7E1E672BCF229600494CBE /* ExportFileDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "ExportFileDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DC8450032BE2D7F1002015D9 /* UserKeyboardDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "UserKeyboardDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DC8450042BE2D7F1002015D9 /* UserKeyboardDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "UserKeyboardDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DC8450072BE3FAF4002015D9 /* UserPortBreakoutBox-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "UserPortBreakoutBox-mac.cpp"; sourceTree = "<group>"; };
 +		DC8450082BE3FAF4002015D9 /* UserPortBreakoutBox-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "UserPortBreakoutBox-mac.hpp"; sourceTree = "<group>"; };
 +		DC84500A2BE45931002015D9 /* BeebEm-BreakoutBox.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-BreakoutBox.swift"; sourceTree = "<group>"; };
 +		DC84500C2BE4616C002015D9 /* TapeControlDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "TapeControlDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DC84500D2BE4616C002015D9 /* TapeControlDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "TapeControlDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DC904DA12BCF3CD60069DCDF /* ExportDiscViewController.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = ExportDiscViewController.swift; sourceTree = "<group>"; };
 +		DC907E952BB4DBCD00523116 /* BeebEm.app */ = {isa = PBXFileReference; explicitFileType = wrapper.application; includeInIndex = 0; path = BeebEm.app; sourceTree = BUILT_PRODUCTS_DIR; };
 +		DC907E9C2BB4DBCE00523116 /* Assets.xcassets */ = {isa = PBXFileReference; lastKnownFileType = folder.assetcatalog; path = Assets.xcassets; sourceTree = "<group>"; };
 +		DC907E9F2BB4DBCE00523116 /* Preview Assets.xcassets */ = {isa = PBXFileReference; lastKnownFileType = folder.assetcatalog; path = "Preview Assets.xcassets"; sourceTree = "<group>"; };
 +		DC907EA12BB4DBCE00523116 /* BeebEm.entitlements */ = {isa = PBXFileReference; lastKnownFileType = text.plist.entitlements; path = BeebEm.entitlements; sourceTree = "<group>"; };
 +		DC907EAC2BB5B7F300523116 /* Base */ = {isa = PBXFileReference; lastKnownFileType = file.storyboard; name = Base; path = Base.lproj/Main.storyboard; sourceTree = "<group>"; };
 +		DC907EAF2BB5BA4000523116 /* AppDelegate.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = AppDelegate.swift; sourceTree = "<group>"; };
 +		DC907EB12BB5BAD300523116 /* BeebEm-Panels.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = "BeebEm-Panels.swift"; sourceTree = "<group>"; };
 +		DC907EB32BB5BB7700523116 /* BeebEm-TapeControl.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-TapeControl.swift"; sourceTree = "<group>"; };
 +		DC907EB52BB5BB9100523116 /* BeebEm-KeyboardMapping.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-KeyboardMapping.swift"; sourceTree = "<group>"; };
 +		DC907EB72BB5BB9A00523116 /* BeebEm-RomConfig.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-RomConfig.swift"; sourceTree = "<group>"; };
 +		DC907EB92BB5BC6200523116 /* BeebEm-ExportFiles.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-ExportFiles.swift"; sourceTree = "<group>"; };
 +		DC907EBF2BB5C02D00523116 /* Info.plist */ = {isa = PBXFileReference; lastKnownFileType = text.plist; path = Info.plist; sourceTree = "<group>"; };
 +		DC907EC02BB5C1F100523116 /* BeebApplication.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = BeebApplication.swift; sourceTree = "<group>"; };
 +		DC907EC22BB5C23C00523116 /* BeebViewController.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = BeebViewController.swift; sourceTree = "<group>"; };
 +		DC907EC52BB6D48600523116 /* Renderer.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = Renderer.swift; sourceTree = "<group>"; };
 +		DC907EC72BB6D55100523116 /* Bitmap.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = Bitmap.swift; sourceTree = "<group>"; };
 +		DC907EC92BB6D76F00523116 /* Colour.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = Colour.swift; sourceTree = "<group>"; };
 +		DC907ECB2BB70CE000523116 /* NSImage+Bitmap.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = "NSImage+Bitmap.swift"; sourceTree = "<group>"; };
 +		DC907ECD2BB70E7B00523116 /* BeebSKView.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; path = BeebSKView.swift; sourceTree = "<group>"; };
 +		DC907ECF2BB7101900523116 /* BeebEm-Bridging-Header.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = "BeebEm-Bridging-Header.h"; sourceTree = "<group>"; };
 +		DC907ED32BB7191300523116 /* mergenotes.txt */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; path = mergenotes.txt; sourceTree = "<group>"; };
 +		DC90FFCD2BEB5B4D0007EB37 /* TeletextDialog.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = TeletextDialog.cpp; path = ../../../Src/TeletextDialog.cpp; sourceTree = "<group>"; };
 +		DC90FFCE2BEB5B4D0007EB37 /* TeletextDialog.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = TeletextDialog.h; path = ../../../Src/TeletextDialog.h; sourceTree = "<group>"; };
 +		DC90FFD02BEB5B820007EB37 /* Model.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = Model.cpp; path = ../../../Src/Model.cpp; sourceTree = "<group>"; };
 +		DC9427A92BF037900012C4E4 /* SelectKeyViewController.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = SelectKeyViewController.swift; sourceTree = "<group>"; };
 +		DC9427AB2BF038090012C4E4 /* BeebEm-SerialPort.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-SerialPort.swift"; sourceTree = "<group>"; };
 +		DC9427AD2BF0386C0012C4E4 /* BeebEm-Teletext.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-Teletext.swift"; sourceTree = "<group>"; };
 +		DC9427AF2BF038B90012C4E4 /* TeletextViewController.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = TeletextViewController.swift; sourceTree = "<group>"; };
 +		DC9427B12BF038F10012C4E4 /* SerialPortViewController.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = SerialPortViewController.swift; sourceTree = "<group>"; };
 +		DC9427B32BF0FBAA0012C4E4 /* TeletextDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "TeletextDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DC9427B42BF0FBAA0012C4E4 /* TeletextDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "TeletextDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DC9427B62BF0FBE90012C4E4 /* SerialPortDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "SerialPortDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DC9427B72BF0FBE90012C4E4 /* SerialPortDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "SerialPortDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DC9697DB2C08632F00B8913F /* todo.md */ = {isa = PBXFileReference; lastKnownFileType = net.daringfireball.markdown; path = todo.md; sourceTree = "<group>"; };
++		DC9C67E02D8807C30026DE4D /* SoundStreamerType.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = SoundStreamerType.h; path = ../../../Src/SoundStreamerType.h; sourceTree = "<group>"; };
++		DC9C67E12D8807C30026DE4D /* Socket.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = Socket.h; path = ../../../Src/Socket.h; sourceTree = "<group>"; };
++		DC9C67E22D8807C30026DE4D /* SerialPort.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; name = SerialPort.h; path = ../../../Src/SerialPort.h; sourceTree = "<group>"; };
++		DC9C67E32D8808000026DE4D /* SerialPort.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = SerialPort.cpp; path = ../../../Src/SerialPort.cpp; sourceTree = "<group>"; };
++		DC9C67E42D8808000026DE4D /* Socket.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = Socket.cpp; path = ../../../Src/Socket.cpp; sourceTree = "<group>"; };
++		DC9C67E72D8808230026DE4D /* MonitorType.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = MonitorType.h; path = ../../../Src/MonitorType.h; sourceTree = "<group>"; };
++		DC9C67E82D880BED0026DE4D /* WindowUtils.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = WindowUtils.h; path = ../../../Src/WindowUtils.h; sourceTree = "<group>"; };
++		DC9C67EB2D880C140026DE4D /* WindowUtils.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = WindowUtils.cpp; path = ../../../Src/WindowUtils.cpp; sourceTree = "<group>"; };
 +		DCACDAC02BC5DD2E00CEF154 /* apples.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = apples.cpp; sourceTree = "<group>"; };
 +		DCACDAC22BC669B600CEF154 /* BeebWinDx-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebWinDx-mac.cpp"; sourceTree = "<group>"; };
 +		DCACDAC52BC66F5600CEF154 /* BeebEm-Bridging-Video.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-Video.cpp"; sourceTree = "<group>"; };
 +		DCACDAC82BC67D2500CEF154 /* BeebEm-Bridging-Main.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-Main.cpp"; sourceTree = "<group>"; };
 +		DCB3B2512BBAB97A00F507F4 /* apples.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = apples.h; sourceTree = "<group>"; };
 +		DCB441642BE63A2000FA2F38 /* appleKeyCodes.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = appleKeyCodes.h; sourceTree = "<group>"; };
 +		DCB4EBC52BD5BCD7002AEA8A /* BeebEm-Bridging-Roms.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-Roms.cpp"; sourceTree = "<group>"; };
 +		DCB4EBC82BD5BD02002AEA8A /* BeebEm-Bridging-BreakoutBox.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-BreakoutBox.cpp"; sourceTree = "<group>"; };
 +		DCB4EBCB2BD5BD22002AEA8A /* BeebEm-Bridging-UserKeyboard.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-UserKeyboard.cpp"; sourceTree = "<group>"; };
 +		DCB4EBCE2BD5BD4E002AEA8A /* BeebEm-Bridging-TapeControl.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-TapeControl.cpp"; sourceTree = "<group>"; };
 +		DCB4EBD12BD5BDC4002AEA8A /* BeebEm-Bridging-ExportFIles.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Bridging-ExportFIles.cpp"; sourceTree = "<group>"; };
 +		DCB4EBD42BDB26F1002AEA8A /* FolderSelectDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "FolderSelectDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DCB4EBD52BDB26F1002AEA8A /* FolderSelectDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "FolderSelectDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DCB4EBD72BDB890F002AEA8A /* RenameFileDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "RenameFileDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DCB4EBD82BDB890F002AEA8A /* RenameFileDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "RenameFileDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DCB4EBDA2BDB89E5002AEA8A /* Dialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "Dialog-mac.cpp"; sourceTree = "<group>"; };
 +		DCB4EBDB2BDB89E5002AEA8A /* Dialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "Dialog-mac.hpp"; sourceTree = "<group>"; };
 +		DCBACC532C1591D1005F2079 /* BeebEm.rc */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text; name = BeebEm.rc; path = ../../../Src/BeebEm.rc; sourceTree = "<group>"; };
 +		DCBACC542C1591D1005F2079 /* BeebWinPrefs.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = BeebWinPrefs.h; path = ../../../Src/BeebWinPrefs.h; sourceTree = "<group>"; };
 +		DCC91DB82C1AE5D500B751D5 /* BeebWin-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebWin-mac.cpp"; sourceTree = "<group>"; };
 +		DCCE05BC2C11DD6300CAAD24 /* AppleSoundStreamer.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = AppleSoundStreamer.cpp; sourceTree = "<group>"; };
 +		DCCE05BD2C11DD6300CAAD24 /* AppleSoundStreamer.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = AppleSoundStreamer.hpp; sourceTree = "<group>"; };
 +		DCD283F02BE6E17100ABD9F8 /* SelectKeyDialog-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "SelectKeyDialog-mac.cpp"; sourceTree = "<group>"; };
 +		DCD283F12BE6E17100ABD9F8 /* SelectKeyDialog-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "SelectKeyDialog-mac.hpp"; sourceTree = "<group>"; };
 +		DCD283F32BE6E63300ABD9F8 /* windowsx.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = windowsx.h; sourceTree = "<group>"; };
 +		DCD283F42BE6E64E00ABD9F8 /* initguid.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = initguid.h; sourceTree = "<group>"; };
 +		DCD283F52BE6E66C00ABD9F8 /* shlobj.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = shlobj.h; sourceTree = "<group>"; };
 +		DCD283F62BE6E67A00ABD9F8 /* shlwapi.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = shlwapi.h; sourceTree = "<group>"; };
 +		DCD283F72BE6E6A600ABD9F8 /* gdiplus.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = gdiplus.h; sourceTree = "<group>"; };
 +		DCD283F82BE8415000ABD9F8 /* sphelper.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = sphelper.h; sourceTree = "<group>"; };
 +		DCD283F92BE8427900ABD9F8 /* BeebWinSpeech-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebWinSpeech-mac.cpp"; sourceTree = "<group>"; };
 +		DCD283FB2BE8C8DA00ABD9F8 /* Debug-mac.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "Debug-mac.cpp"; sourceTree = "<group>"; };
 +		DCD283FC2BE8C8DA00ABD9F8 /* Debug-mac.hpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.h; path = "Debug-mac.hpp"; sourceTree = "<group>"; };
 +		DCD283FE2BE8D17400ABD9F8 /* BeebEm-Debug.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-Debug.swift"; sourceTree = "<group>"; };
 +		DCD284012BE8D22C00ABD9F8 /* DebuggerViewController.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = DebuggerViewController.swift; sourceTree = "<group>"; };
 +		DCD284032BE8D2D400ABD9F8 /* BeebEm-Debugger.cpp */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.cpp.cpp; path = "BeebEm-Debugger.cpp"; sourceTree = "<group>"; };
 +		DCDC73122BBE192200D83402 /* libz.tbd */ = {isa = PBXFileReference; lastKnownFileType = "sourcecode.text-based-dylib-definition"; name = libz.tbd; path = usr/lib/libz.tbd; sourceTree = SDKROOT; };
 +		DCDC73182BBE1B9F00D83402 /* commctrl.h */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.c.h; path = commctrl.h; sourceTree = "<group>"; };
 +		DCE5AD272C3D15AF0080AD01 /* Credits.rtf */ = {isa = PBXFileReference; lastKnownFileType = text.rtf; name = Credits.rtf; path = BeebEm/Credits.rtf; sourceTree = "<group>"; };
 +		DCE94C142BD3109500A5C12A /* BeebEm-Menu.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-Menu.swift"; sourceTree = "<group>"; };
 +		DCE94C162BD310C600A5C12A /* BeebEm-Sound.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-Sound.swift"; sourceTree = "<group>"; };
 +		DCE94C182BD3117200A5C12A /* BeebEm-Files.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-Files.swift"; sourceTree = "<group>"; };
 +		DCE94C1A2BD311D800A5C12A /* BeebEm-Bundle.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-Bundle.swift"; sourceTree = "<group>"; };
 +		DCE94C1C2BD312B100A5C12A /* BeebEm-Beeb.swift */ = {isa = PBXFileReference; lastKnownFileType = sourcecode.swift; path = "BeebEm-Beeb.swift"; sourceTree = "<group>"; };
 +/* End PBXFileReference section */
 +
 +/* Begin PBXFrameworksBuildPhase section */
 +		DC907E922BB4DBCD00523116 /* Frameworks */ = {
 +			isa = PBXFrameworksBuildPhase;
 +			buildActionMask = 2147483647;
 +			files = (
 +				DCDC73132BBE192200D83402 /* libz.tbd in Frameworks */,
 +			);
 +			runOnlyForDeploymentPostprocessing = 0;
 +		};
 +/* End PBXFrameworksBuildPhase section */
 +
 +/* Begin PBXGroup section */
 +		DC0996DB2BBA0C5000A109A5 /* windows_code */ = {
 +			isa = PBXGroup;
 +			children = (
++				DC9C67EB2D880C140026DE4D /* WindowUtils.cpp */,
++				DC9C67E32D8808000026DE4D /* SerialPort.cpp */,
++				DC9C67E42D8808000026DE4D /* Socket.cpp */,
 +				DC74E1CB2C29D88C006826EE /* FileType.cpp */,
 +				DC74E1CD2C29D88C006826EE /* Registry.cpp */,
 +				DC2C9D052BF978AE00F2E613 /* UserPortRTC.cpp */,
 +				DC2C9D002BF9788700F2E613 /* RomConfigFile.cpp */,
 +				DC2C9D022BF9788700F2E613 /* Rtc.cpp */,
 +				DC90FFD02BEB5B820007EB37 /* Model.cpp */,
 +				DC90FFCD2BEB5B4D0007EB37 /* TeletextDialog.cpp */,
 +				DC0996E72BBA0C9B00A109A5 /* 6502core.cpp */,
 +				DC0997022BBA0C9C00A109A5 /* AboutDialog.cpp */,
 +				DC09971B2BBA0C9C00A109A5 /* Arm.cpp */,
 +				DC0996FD2BBA0C9C00A109A5 /* ArmDisassembler.cpp */,
 +				DC0997242BBA0CBB00A109A5 /* ARMulator */,
 +				DC0997212BBA0C9C00A109A5 /* AtoDConv.cpp */,
 +				DC0996F62BBA0C9C00A109A5 /* AVIWriter.cpp */,
 +				DC0996FE2BBA0C9C00A109A5 /* Bcd.cpp */,
 +				DC0997012BBA0C9C00A109A5 /* BeebMem.cpp */,
 +				DC0996E22BBA0C9B00A109A5 /* BeebWin.cpp */,
 +				DC0996F22BBA0C9C00A109A5 /* BeebWinDx.cpp */,
 +				DC09971D2BBA0C9C00A109A5 /* BeebWinIo.cpp */,
 +				DC09970B2BBA0C9C00A109A5 /* BeebWinPrefs.cpp */,
 +				DC0996F42BBA0C9C00A109A5 /* BeebWinSpeech.cpp */,
 +				DC0996E32BBA0C9B00A109A5 /* Csw.cpp */,
 +				DC0996E82BBA0C9B00A109A5 /* Debug.cpp */,
 +				DC0996ED2BBA0C9B00A109A5 /* DebugTrace.cpp */,
 +				DC09971C2BBA0C9C00A109A5 /* Dialog.cpp */,
 +				DC0997162BBA0C9C00A109A5 /* DirectSoundStreamer.cpp */,
 +				DC09970A2BBA0C9C00A109A5 /* Disc1770.cpp */,
 +				DC09970F2BBA0C9C00A109A5 /* Disc8271.cpp */,
 +				DC0997142BBA0C9C00A109A5 /* DiscEdit.cpp */,
 +				DC0996F32BBA0C9C00A109A5 /* DiscInfo.cpp */,
 +				DC09971E2BBA0C9C00A109A5 /* Econet.cpp */,
 +				DC0997102BBA0C9C00A109A5 /* ExportFileDialog.cpp */,
 +				DC09970C2BBA0C9C00A109A5 /* Ext1770.cpp */,
 +				DC0996F92BBA0C9C00A109A5 /* FileDialog.cpp */,
 +				DC0996E62BBA0C9B00A109A5 /* FileUtils.cpp */,
 +				DC0997002BBA0C9C00A109A5 /* FolderSelectDialog.cpp */,
 +				DC0997AD2BBAA91E00A109A5 /* Hardware */,
 +				DC0996E42BBA0C9B00A109A5 /* IC32Latch.cpp */,
 +				DC0997112BBA0C9C00A109A5 /* Ide.cpp */,
 +				DC0996FC2BBA0C9C00A109A5 /* KeyboardLinksDialog.cpp */,
 +				DC0997132BBA0C9C00A109A5 /* KeyMap.cpp */,
 +				DC0996E92BBA0C9B00A109A5 /* IP232.cpp */,
 +				DC0997072BBA0C9C00A109A5 /* ListView.cpp */,
 +				DC0996DF2BBA0C9B00A109A5 /* Log.cpp */,
 +				DC0996F72BBA0C9C00A109A5 /* Main.cpp */,
 +				DC0996F82BBA0C9C00A109A5 /* Master512CoPro.cpp */,
 +				DC0997152BBA0C9C00A109A5 /* Music5000.cpp */,
 +				DC0996F52BBA0C9C00A109A5 /* PALRom.cpp */,
 +				DC09970E2BBA0C9C00A109A5 /* Preferences.cpp */,
 +				DC0997092BBA0C9C00A109A5 /* RenameFileDialog.cpp */,
 +				DC0996F12BBA0C9B00A109A5 /* RingBuffer.cpp */,
 +				DC0996E52BBA0C9B00A109A5 /* RomConfigDialog.cpp */,
 +				DC0996EC2BBA0C9B00A109A5 /* Sasi.cpp */,
 +				DC0996EA2BBA0C9B00A109A5 /* Scsi.cpp */,
 +				DC0997202BBA0C9C00A109A5 /* SelectKeyDialog.cpp */,
 +				DC09970D2BBA0C9C00A109A5 /* Serial.cpp */,
 +				DC0996E02BBA0C9B00A109A5 /* SerialPortDialog.cpp */,
 +				DC0996FA2BBA0C9C00A109A5 /* Sound.cpp */,
 +				DC0997122BBA0C9C00A109A5 /* SoundStreamer.cpp */,
 +				DC0997232BBA0C9C00A109A5 /* Speech.cpp */,
 +				DC0997052BBA0C9C00A109A5 /* SprowCoPro.cpp */,
 +				DC0997222BBA0C9C00A109A5 /* StringUtils.cpp */,
 +				DC0997062BBA0C9C00A109A5 /* SysVia.cpp */,
 +				DC0997182BBA0C9C00A109A5 /* TapeMap.cpp */,
 +				DC0997172BBA0C9C00A109A5 /* TapeControlDialog.cpp */,
 +				DC0996FB2BBA0C9C00A109A5 /* Teletext.cpp */,
 +				DC0996EB2BBA0C9B00A109A5 /* Thread.cpp */,
 +				DC0996FF2BBA0C9C00A109A5 /* TouchScreen.cpp */,
 +				DC0997192BBA0C9C00A109A5 /* Tube.cpp */,
 +				DC0996F02BBA0C9B00A109A5 /* Uef.cpp */,
 +				DC0996E12BBA0C9B00A109A5 /* UefState.cpp */,
 +				DC0996DE2BBA0C9B00A109A5 /* UserKeyboardDialog.cpp */,
 +				DC0996DD2BBA0C9B00A109A5 /* UserPortBreakoutBox.cpp */,
 +				DC0996EE2BBA0C9B00A109A5 /* UserVia.cpp */,
 +				DC09971A2BBA0C9C00A109A5 /* Via.cpp */,
 +				DC0997032BBA0C9C00A109A5 /* Video.cpp */,
 +				DC09971F2BBA0C9C00A109A5 /* XAudio2Streamer.cpp */,
 +				DC0997082BBA0C9C00A109A5 /* Z80.cpp */,
 +				DC0997042BBA0C9C00A109A5 /* Z80dis.cpp */,
 +				DC0996EF2BBA0C9B00A109A5 /* Z80Support.cpp */,
 +			);
 +			name = windows_code;
 +			sourceTree = "<group>";
 +		};
 +		DC0996DC2BBA0C6400A109A5 /* windows_headers */ = {
 +			isa = PBXGroup;
 +			children = (
++				DC9C67E82D880BED0026DE4D /* WindowUtils.h */,
++				DC9C67E72D8808230026DE4D /* MonitorType.h */,
++				DC9C67E22D8807C30026DE4D /* SerialPort.h */,
++				DC9C67E12D8807C30026DE4D /* Socket.h */,
++				DC9C67E02D8807C30026DE4D /* SoundStreamerType.h */,
 +				DC74E1CC2C29D88C006826EE /* FileType.h */,
 +				DCBACC542C1591D1005F2079 /* BeebWinPrefs.h */,
 +				DC215BE72C13C27E003E50A3 /* Registry.h */,
 +				DC2C9D062BF978AF00F2E613 /* UserPortRTC.h */,
 +				DC2C9D012BF9788700F2E613 /* RomConfigFile.h */,
 +				DC2C9CFF2BF9788700F2E613 /* Rtc.h */,
 +				DC90FFCE2BEB5B4D0007EB37 /* TeletextDialog.h */,
 +				DC0997582BBA0E2500A109A5 /* 6502core.h */,
 +				DC09975D2BBA0E2600A109A5 /* AboutDialog.h */,
 +				DC09977A2BBA0E2600A109A5 /* Arm.h */,
 +				DC0997512BBA0E2500A109A5 /* ArmDisassembler.h */,
 +				DC09975C2BBA0E2500A109A5 /* ARMulator.h */,
 +				DC0997332BBA0CD400A109A5 /* ARMulator */,
 +				DC09976D2BBA0E2600A109A5 /* AtoDConv.h */,
 +				DC0997762BBA0E2600A109A5 /* AVIWriter.h */,
 +				DC0997562BBA0E2500A109A5 /* Bcd.h */,
 +				DC0997552BBA0E2500A109A5 /* BeebMem.h */,
 +				DC0997722BBA0E2600A109A5 /* BeebWin.h */,
 +				DC0997522BBA0E2500A109A5 /* Csw.h */,
 +				DC09977E2BBA0E2600A109A5 /* Debug.h */,
 +				DC09976E2BBA0E2600A109A5 /* DebugTrace.h */,
 +				DC09978C2BBA0E2700A109A5 /* Dialog.h */,
 +				DC0997632BBA0E2600A109A5 /* DirectSoundStreamer.h */,
 +				DC0997802BBA0E2600A109A5 /* Disc1770.h */,
 +				DC0997692BBA0E2600A109A5 /* Disc8271.h */,
 +				DC0997772BBA0E2600A109A5 /* DiscEdit.h */,
 +				DC0997492BBA0E2500A109A5 /* DiscInfo.h */,
 +				DC09977C2BBA0E2600A109A5 /* DiscType.h */,
 +				DC09975F2BBA0E2600A109A5 /* Econet.h */,
 +				DC0997752BBA0E2600A109A5 /* ExportFileDialog.h */,
 +				DC0997732BBA0E2600A109A5 /* Ext1770.h */,
 +				DC0997532BBA0E2500A109A5 /* FileDialog.h */,
 +				DC0997542BBA0E2500A109A5 /* FileUtils.h */,
 +				DC09975B2BBA0E2500A109A5 /* FolderSelectDialog.h */,
 +				DC0997812BBA0E2600A109A5 /* IC32Latch.h */,
 +				DC09974B2BBA0E2500A109A5 /* KeyboardLinksDialog.h */,
 +				DC09976F2BBA0E2600A109A5 /* ListView.h */,
 +				DC0997672BBA0E2600A109A5 /* Master512CoPro.h */,
 +				DC0997662BBA0E2600A109A5 /* Ide.h */,
 +				DC09974D2BBA0E2500A109A5 /* IP232.h */,
 +				DC09976B2BBA0E2600A109A5 /* KeyMap.h */,
 +				DC09977F2BBA0E2600A109A5 /* Log.h */,
 +				DC09976A2BBA0E2600A109A5 /* Main.h */,
 +				DC09978F2BBA0E2700A109A5 /* Messages.h */,
 +				DC09974A2BBA0E2500A109A5 /* ML675001.h */,
 +				DC0997602BBA0E2600A109A5 /* Model.h */,
 +				DC0997652BBA0E2600A109A5 /* Music5000.h */,
 +				DC09974F2BBA0E2500A109A5 /* PALRom.h */,
 +				DC0997742BBA0E2600A109A5 /* Port.h */,
 +				DC0997862BBA0E2600A109A5 /* Preferences.h */,
 +				DC09977B2BBA0E2600A109A5 /* RenameFileDialog.h */,
 +				DC0997822BBA0E2600A109A5 /* Resource.h */,
 +				DC09978A2BBA0E2700A109A5 /* RingBuffer.h */,
 +				DC0997702BBA0E2600A109A5 /* RomConfigDialog.h */,
 +				DC0997572BBA0E2500A109A5 /* Sasi.h */,
 +				DC09977D2BBA0E2600A109A5 /* Scsi.h */,
 +				DC0997592BBA0E2500A109A5 /* SelectKeyDialog.h */,
 +				DC09975E2BBA0E2600A109A5 /* Serial.h */,
 +				DC0997792BBA0E2600A109A5 /* SerialPortDialog.h */,
 +				DC0997832BBA0E2600A109A5 /* Sound.h */,
 +				DC0997612BBA0E2600A109A5 /* SoundStreamer.h */,
 +				DC0997622BBA0E2600A109A5 /* Speech.h */,
 +				DC09978B2BBA0E2700A109A5 /* SprowCoPro.h */,
 +				DC0997482BBA0E2500A109A5 /* StringUtils.h */,
 +				DC0997682BBA0E2600A109A5 /* SysVia.h */,
 +				DC09974E2BBA0E2500A109A5 /* TapeControlDialog.h */,
 +				DC09974C2BBA0E2500A109A5 /* TapeMap.h */,
 +				DC0997882BBA0E2700A109A5 /* TarmacGlobals.h */,
 +				DC0997842BBA0E2600A109A5 /* Teletext.h */,
 +				DC09976C2BBA0E2600A109A5 /* Thread.h */,
 +				DC0997502BBA0E2500A109A5 /* TouchScreen.h */,
 +				DC0997712BBA0E2600A109A5 /* Tube.h */,
 +				DC0997852BBA0E2600A109A5 /* Uef.h */,
 +				DC09978D2BBA0E2700A109A5 /* UefState.h */,
 +				DC0997872BBA0E2600A109A5 /* UserKeyboardDialog.h */,
 +				DC09978E2BBA0E2700A109A5 /* UserPortBreakoutBox.h */,
 +				DC0997902BBA0E2700A109A5 /* UserVia.h */,
 +				DC0997912BBA0E2700A109A5 /* Version.h */,
 +				DC0997642BBA0E2600A109A5 /* Via.h */,
 +				DC09975A2BBA0E2500A109A5 /* Video.h */,
 +				DC0997892BBA0E2700A109A5 /* XAudio2Streamer.h */,
 +				DC0997922BBA0E2700A109A5 /* Z80.h */,
 +				DC0997782BBA0E2600A109A5 /* Z80mem.h */,
 +			);
 +			name = windows_headers;
 +			sourceTree = "<group>";
 +		};
 +		DC0997242BBA0CBB00A109A5 /* ARMulator */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC09972C2BBA0CBB00A109A5 /* armdis.cpp */,
 +				DC0997AB2BBAA8D100A109A5 /* armmem.c */,
 +				DC09972B2BBA0CBB00A109A5 /* armemu.cpp */,
 +				DC0997312BBA0CBB00A109A5 /* arminit.cpp */,
 +				DC0997302BBA0CBB00A109A5 /* armsupp.cpp */,
 +				DC0997282BBA0CBB00A109A5 /* thumbemu.cpp */,
 +			);
 +			name = ARMulator;
 +			path = ../../../Src/ARMulator;
 +			sourceTree = "<group>";
 +		};
 +		DC0997332BBA0CD400A109A5 /* ARMulator */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC0997392BBA0CD400A109A5 /* ansidecl.h */,
 +				DC09973E2BBA0CD400A109A5 /* armdefs.h */,
 +				DC0997382BBA0CD400A109A5 /* armdis.h */,
 +				DC0997412BBA0CD400A109A5 /* armemu.h */,
 +				DC09973C2BBA0CD400A109A5 /* armopts.h */,
 +				DC0997352BBA0CD400A109A5 /* armos.h */,
 +				DC09973D2BBA0CD400A109A5 /* dbg_rdi.h */,
 +				DC0997362BBA0CD400A109A5 /* iwmmxt.h */,
 +			);
 +			name = ARMulator;
 +			path = ../../../Src/ARMulator;
 +			sourceTree = "<group>";
 +		};
 +		DC0997A62BBAA65E00A109A5 /* windows_stubs */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC0997A72BBAA68600A109A5 /* d3d9.h */,
 +				DC0997A82BBAA6A300A109A5 /* ddraw.h */,
 +				DC0997A52BBAA5D500A109A5 /* windows.h */,
 +				DC0997A92BBAA6C200A109A5 /* sapi.h */,
 +				DCDC73182BBE1B9F00D83402 /* commctrl.h */,
 +				DCD283F32BE6E63300ABD9F8 /* windowsx.h */,
 +				DCD283F42BE6E64E00ABD9F8 /* initguid.h */,
 +				DCD283F52BE6E66C00ABD9F8 /* shlobj.h */,
 +				DCD283F62BE6E67A00ABD9F8 /* shlwapi.h */,
 +				DCD283F72BE6E6A600ABD9F8 /* gdiplus.h */,
 +				DCD283F82BE8415000ABD9F8 /* sphelper.h */,
 +				DC2C9CFE2BF9444F00F2E613 /* process.h */,
 +				DC423BFE2BFC7F99009736E1 /* vfw.h */,
 +			);
 +			path = windows_stubs;
 +			sourceTree = "<group>";
 +		};
 +		DC0997AD2BBAA91E00A109A5 /* Hardware */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC0997AE2BBAA91E00A109A5 /* Acorn1770 */,
 +				DC0997B32BBAA91E00A109A5 /* Watford */,
 +				DC0997B82BBAA91E00A109A5 /* OpusDDOS */,
 +			);
 +			name = Hardware;
 +			path = ../../../Src/Hardware;
 +			sourceTree = "<group>";
 +		};
 +		DC0997AE2BBAA91E00A109A5 /* Acorn1770 */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC0997B12BBAA91E00A109A5 /* Acorn.h */,
 +				DC0997AF2BBAA91E00A109A5 /* Acorn.cpp */,
 +			);
 +			path = Acorn1770;
 +			sourceTree = "<group>";
 +		};
 +		DC0997B32BBAA91E00A109A5 /* Watford */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC0997B62BBAA91E00A109A5 /* Watford.h */,
 +				DC0997B72BBAA91E00A109A5 /* Watford.cpp */,
 +			);
 +			path = Watford;
 +			sourceTree = "<group>";
 +		};
 +		DC0997B82BBAA91E00A109A5 /* OpusDDOS */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC0997BA2BBAA91E00A109A5 /* opus.h */,
 +				DC0997BC2BBAA91E00A109A5 /* opus.cpp */,
 +			);
 +			path = OpusDDOS;
 +			sourceTree = "<group>";
 +		};
 +		DC1DBA1E2BB8CF2500AAB22F /* BeebBridge */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DCE94C1C2BD312B100A5C12A /* BeebEm-Beeb.swift */,
 +				DCE94C1A2BD311D800A5C12A /* BeebEm-Bundle.swift */,
 +				DCE94C182BD3117200A5C12A /* BeebEm-Files.swift */,
 +				DC907EB52BB5BB9100523116 /* BeebEm-KeyboardMapping.swift */,
 +				DC84500A2BE45931002015D9 /* BeebEm-BreakoutBox.swift */,
 +				DC907EB92BB5BC6200523116 /* BeebEm-ExportFiles.swift */,
 +				DCE94C142BD3109500A5C12A /* BeebEm-Menu.swift */,
 +				DC907EB12BB5BAD300523116 /* BeebEm-Panels.swift */,
 +				DC907EB72BB5BB9A00523116 /* BeebEm-RomConfig.swift */,
 +				DCE94C162BD310C600A5C12A /* BeebEm-Sound.swift */,
 +				DC907EB32BB5BB7700523116 /* BeebEm-TapeControl.swift */,
 +				DCD283FE2BE8D17400ABD9F8 /* BeebEm-Debug.swift */,
 +				DC9427AB2BF038090012C4E4 /* BeebEm-SerialPort.swift */,
 +				DC9427AD2BF0386C0012C4E4 /* BeebEm-Teletext.swift */,
 +				DC69C9F62BF2BDC700610067 /* BeebEm-KeyboardLinks.swift */,
 +			);
 +			path = BeebBridge;
 +			sourceTree = "<group>";
 +		};
 +		DC1DBA1F2BB8CF2B00AAB22F /* MacBridge */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC907ECF2BB7101900523116 /* BeebEm-Bridging-Header.h */,
 +				DCACDAC52BC66F5600CEF154 /* BeebEm-Bridging-Video.cpp */,
 +				DCACDAC82BC67D2500CEF154 /* BeebEm-Bridging-Main.cpp */,
 +				DC527D152BC9110E000D7CCF /* BeebEm-Bridging-Keyboard.cpp */,
 +				DC7E1E602BCE53E000494CBE /* BeebEm-Bridging-IO.cpp */,
 +				DCB4EBC52BD5BCD7002AEA8A /* BeebEm-Bridging-Roms.cpp */,
 +				DCB4EBC82BD5BD02002AEA8A /* BeebEm-Bridging-BreakoutBox.cpp */,
 +				DCB4EBCB2BD5BD22002AEA8A /* BeebEm-Bridging-UserKeyboard.cpp */,
 +				DCB4EBCE2BD5BD4E002AEA8A /* BeebEm-Bridging-TapeControl.cpp */,
 +				DCB4EBD12BD5BDC4002AEA8A /* BeebEm-Bridging-ExportFIles.cpp */,
 +				DCD284032BE8D2D400ABD9F8 /* BeebEm-Debugger.cpp */,
 +				DC69C9FB2BF2C87A00610067 /* BeebEm-Bridging-KeyboardLinks.cpp */,
 +				DC689D0C2C2D3E68009BA41F /* BeebEm-Bridging-SerialPort.cpp */,
 +			);
 +			path = MacBridge;
 +			sourceTree = "<group>";
 +		};
 +		DC3FB5482BE8DB4600CF36A0 /* MacDialogs */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC7E1E632BCE58D400494CBE /* FileDialog-mac.cpp */,
 +				DC7E1E642BCE58D400494CBE /* FileDialog-mac.hpp */,
 +				DCB4EBDA2BDB89E5002AEA8A /* Dialog-mac.cpp */,
 +				DCB4EBDB2BDB89E5002AEA8A /* Dialog-mac.hpp */,
 +				DC7E1E662BCF229600494CBE /* ExportFileDialog-mac.cpp */,
 +				DC7E1E672BCF229600494CBE /* ExportFileDialog-mac.hpp */,
 +				DCB4EBD72BDB890F002AEA8A /* RenameFileDialog-mac.cpp */,
 +				DCB4EBD82BDB890F002AEA8A /* RenameFileDialog-mac.hpp */,
 +				DCB4EBD42BDB26F1002AEA8A /* FolderSelectDialog-mac.cpp */,
 +				DCB4EBD52BDB26F1002AEA8A /* FolderSelectDialog-mac.hpp */,
 +				DC33555D2BDF84C00014DC3A /* RomConfigDialog-mac.cpp */,
 +				DC33555E2BDF84C00014DC3A /* RomConfigDialog-mac.hpp */,
 +				DC8450032BE2D7F1002015D9 /* UserKeyboardDialog-mac.cpp */,
 +				DC8450042BE2D7F1002015D9 /* UserKeyboardDialog-mac.hpp */,
 +				DC8450072BE3FAF4002015D9 /* UserPortBreakoutBox-mac.cpp */,
 +				DC8450082BE3FAF4002015D9 /* UserPortBreakoutBox-mac.hpp */,
 +				DC84500C2BE4616C002015D9 /* TapeControlDialog-mac.cpp */,
 +				DC84500D2BE4616C002015D9 /* TapeControlDialog-mac.hpp */,
 +				DCD283F02BE6E17100ABD9F8 /* SelectKeyDialog-mac.cpp */,
 +				DCD283F12BE6E17100ABD9F8 /* SelectKeyDialog-mac.hpp */,
 +				DCD283FB2BE8C8DA00ABD9F8 /* Debug-mac.cpp */,
 +				DCD283FC2BE8C8DA00ABD9F8 /* Debug-mac.hpp */,
 +				DC9427B32BF0FBAA0012C4E4 /* TeletextDialog-mac.cpp */,
 +				DC9427B42BF0FBAA0012C4E4 /* TeletextDialog-mac.hpp */,
 +				DC9427B62BF0FBE90012C4E4 /* SerialPortDialog-mac.cpp */,
 +				DC9427B72BF0FBE90012C4E4 /* SerialPortDialog-mac.hpp */,
 +				DC69C9F82BF2BDE100610067 /* KeyboardLinksDialog-mac.cpp */,
 +				DC69C9F92BF2BDE100610067 /* KeyboardLinksDialog-mac.hpp */,
 +			);
 +			path = MacDialogs;
 +			sourceTree = "<group>";
 +		};
 +		DC527AD32BC7505C000D7CCF /* Bundle */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC527D132BC7532E000D7CCF /* Help */,
 +				DC527D112BC75316000D7CCF /* UserData */,
 +				DC527C1D2BC75165000D7CCF /* CHANGES.md */,
 +				DC527BD62BC75122000D7CCF /* COPYRIGHT.txt */,
 +				DC527BCC2BC75114000D7CCF /* DriveMotor.snd */,
 +				DC527BD02BC75114000D7CCF /* HeadLoad.snd */,
 +				DC527BCE2BC75114000D7CCF /* HeadSeek.snd */,
 +				DC527BCD2BC75114000D7CCF /* HeadStep.snd */,
 +				DC527BCF2BC75114000D7CCF /* HeadUnload.snd */,
 +				DC527C1F2BC75175000D7CCF /* README-SPROW.txt */,
 +				DC527BC62BC75107000D7CCF /* README.md */,
 +				DC527BC72BC75107000D7CCF /* RelayOff.snd */,
 +				DC527BC52BC75107000D7CCF /* RelayOn.snd */,
 +				DC527BC42BC75107000D7CCF /* Teletext.fnt */,
 +				DCE5AD272C3D15AF0080AD01 /* Credits.rtf */,
 +			);
 +			name = Bundle;
 +			sourceTree = "<group>";
 +		};
 +		DC907E8C2BB4DBCD00523116 = {
 +			isa = PBXGroup;
 +			children = (
 +				DC9697DB2C08632F00B8913F /* todo.md */,
 +				DC907ED32BB7191300523116 /* mergenotes.txt */,
 +				DC907EBB2BB5BE0B00523116 /* Src */,
 +				DC907EAE2BB5BA2500523116 /* Swift */,
 +				DC907EA82BB5B5F000523116 /* Scenes */,
 +				DC907E972BB4DBCD00523116 /* BeebEm */,
 +				DC907E962BB4DBCD00523116 /* Products */,
 +				DC527AD32BC7505C000D7CCF /* Bundle */,
 +				DCDC73112BBE192200D83402 /* Frameworks */,
 +			);
 +			sourceTree = "<group>";
 +		};
 +		DC907E962BB4DBCD00523116 /* Products */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC907E952BB4DBCD00523116 /* BeebEm.app */,
 +			);
 +			name = Products;
 +			sourceTree = "<group>";
 +		};
 +		DC907E972BB4DBCD00523116 /* BeebEm */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC907EBF2BB5C02D00523116 /* Info.plist */,
 +				DC907E9C2BB4DBCE00523116 /* Assets.xcassets */,
 +				DC907EA12BB4DBCE00523116 /* BeebEm.entitlements */,
 +				DC907E9E2BB4DBCE00523116 /* Preview Content */,
 +			);
 +			path = BeebEm;
 +			sourceTree = "<group>";
 +		};
 +		DC907E9E2BB4DBCE00523116 /* Preview Content */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC907E9F2BB4DBCE00523116 /* Preview Assets.xcassets */,
 +			);
 +			path = "Preview Content";
 +			sourceTree = "<group>";
 +		};
 +		DC907EA82BB5B5F000523116 /* Scenes */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC907EAB2BB5B7F300523116 /* Main.storyboard */,
 +			);
 +			path = Scenes;
 +			sourceTree = "<group>";
 +		};
 +		DC907EAE2BB5BA2500523116 /* Swift */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DCD284002BE8D1CA00ABD9F8 /* BeebControllers */,
 +				DC1DBA1E2BB8CF2500AAB22F /* BeebBridge */,
 +				DC907EAF2BB5BA4000523116 /* AppDelegate.swift */,
 +				DC907EC02BB5C1F100523116 /* BeebApplication.swift */,
 +				DC907EC52BB6D48600523116 /* Renderer.swift */,
 +				DC907EC92BB6D76F00523116 /* Colour.swift */,
 +				DC907EC72BB6D55100523116 /* Bitmap.swift */,
 +				DC907ECB2BB70CE000523116 /* NSImage+Bitmap.swift */,
 +				DC907ECD2BB70E7B00523116 /* BeebSKView.swift */,
 +			);
 +			path = Swift;
 +			sourceTree = "<group>";
 +		};
 +		DC907EBB2BB5BE0B00523116 /* Src */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC0997A62BBAA65E00A109A5 /* windows_stubs */,
 +				DC0996DC2BBA0C6400A109A5 /* windows_headers */,
 +				DC0996DB2BBA0C5000A109A5 /* windows_code */,
 +				DCBACC522C159055005F2079 /* windows_projectresources */,
 +				DC3FB5482BE8DB4600CF36A0 /* MacDialogs */,
 +				DC1DBA1F2BB8CF2B00AAB22F /* MacBridge */,
 +				DCB441642BE63A2000FA2F38 /* appleKeyCodes.h */,
 +				DC0997992BBAA51200A109A5 /* beebemrcids.h */,
 +				DCB3B2512BBAB97A00F507F4 /* apples.h */,
 +				DCACDAC02BC5DD2E00CEF154 /* apples.cpp */,
 +				DC09979D2BBAA51300A109A5 /* beebemrcids.cpp */,
 +				DCC91DB82C1AE5D500B751D5 /* BeebWin-mac.cpp */,
 +				DCACDAC22BC669B600CEF154 /* BeebWinDx-mac.cpp */,
 +				DCD283F92BE8427900ABD9F8 /* BeebWinSpeech-mac.cpp */,
 +				DC3FB5492BE8DEDB00CF36A0 /* KeyMap-mac.cpp */,
 +				DC3FB54A2BE8DEDB00CF36A0 /* KeyMap-mac.hpp */,
 +				DCCE05BC2C11DD6300CAAD24 /* AppleSoundStreamer.cpp */,
 +				DCCE05BD2C11DD6300CAAD24 /* AppleSoundStreamer.hpp */,
 +			);
 +			path = Src;
 +			sourceTree = "<group>";
 +		};
 +		DCBACC522C159055005F2079 /* windows_projectresources */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DCBACC532C1591D1005F2079 /* BeebEm.rc */,
 +			);
 +			name = windows_projectresources;
 +			sourceTree = "<group>";
 +		};
 +		DCD284002BE8D1CA00ABD9F8 /* BeebControllers */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DC907EC22BB5C23C00523116 /* BeebViewController.swift */,
 +				DC1DBA142BB8CF0500AAB22F /* BreakoutBoxViewController.swift */,
 +				DC1DBA132BB8CF0400AAB22F /* KeyboardMappingViewController.swift */,
 +				DC1DBA152BB8CF0500AAB22F /* RomConfigViewController.swift */,
 +				DC1DBA162BB8CF0500AAB22F /* TapeControlViewController.swift */,
 +				DCD284012BE8D22C00ABD9F8 /* DebuggerViewController.swift */,
 +				DC904DA12BCF3CD60069DCDF /* ExportDiscViewController.swift */,
 +				DC9427A92BF037900012C4E4 /* SelectKeyViewController.swift */,
 +				DC9427AF2BF038B90012C4E4 /* TeletextViewController.swift */,
 +				DC9427B12BF038F10012C4E4 /* SerialPortViewController.swift */,
 +				DC69C9F42BF2BDB600610067 /* KeyboardLinksViewController.swift */,
 +			);
 +			path = BeebControllers;
 +			sourceTree = "<group>";
 +		};
 +		DCDC73112BBE192200D83402 /* Frameworks */ = {
 +			isa = PBXGroup;
 +			children = (
 +				DCDC73122BBE192200D83402 /* libz.tbd */,
 +			);
 +			name = Frameworks;
 +			sourceTree = "<group>";
 +		};
 +/* End PBXGroup section */
 +
 +/* Begin PBXNativeTarget section */
 +		DC907E942BB4DBCD00523116 /* BeebEm */ = {
 +			isa = PBXNativeTarget;
 +			buildConfigurationList = DC907EA42BB4DBCE00523116 /* Build configuration list for PBXNativeTarget "BeebEm" */;
 +			buildPhases = (
 +				DC907E912BB4DBCD00523116 /* Sources */,
 +				DC907E922BB4DBCD00523116 /* Frameworks */,
 +				DC907E932BB4DBCD00523116 /* Resources */,
 +			);
 +			buildRules = (
 +			);
 +			dependencies = (
 +			);
 +			name = BeebEm;
 +			productName = BeebEm;
 +			productReference = DC907E952BB4DBCD00523116 /* BeebEm.app */;
 +			productType = "com.apple.product-type.application";
 +		};
 +/* End PBXNativeTarget section */
 +
 +/* Begin PBXProject section */
 +		DC907E8D2BB4DBCD00523116 /* Project object */ = {
 +			isa = PBXProject;
 +			attributes = {
 +				BuildIndependentTargetsInParallel = 1;
 +				LastSwiftUpdateCheck = 1340;
 +				LastUpgradeCheck = 1340;
 +				TargetAttributes = {
 +					DC907E942BB4DBCD00523116 = {
 +						CreatedOnToolsVersion = 13.4.1;
 +						LastSwiftMigration = 1340;
 +					};
 +				};
 +			};
 +			buildConfigurationList = DC907E902BB4DBCD00523116 /* Build configuration list for PBXProject "BeebEm" */;
 +			compatibilityVersion = "Xcode 13.0";
 +			developmentRegion = en;
 +			hasScannedForEncodings = 0;
 +			knownRegions = (
 +				en,
 +				Base,
 +			);
 +			mainGroup = DC907E8C2BB4DBCD00523116;
 +			productRefGroup = DC907E962BB4DBCD00523116 /* Products */;
 +			projectDirPath = "";
 +			projectRoot = "";
 +			targets = (
 +				DC907E942BB4DBCD00523116 /* BeebEm */,
 +			);
 +		};
 +/* End PBXProject section */
 +
 +/* Begin PBXResourcesBuildPhase section */
 +		DC907E932BB4DBCD00523116 /* Resources */ = {
 +			isa = PBXResourcesBuildPhase;
 +			buildActionMask = 2147483647;
 +			files = (
 +				DC527D142BC7532E000D7CCF /* Help in Resources */,
 +				DC527BD72BC75122000D7CCF /* COPYRIGHT.txt in Resources */,
 +				DC527D122BC75316000D7CCF /* UserData in Resources */,
 +				DC527BD32BC75114000D7CCF /* HeadSeek.snd in Resources */,
 +				DC527BCB2BC75107000D7CCF /* RelayOff.snd in Resources */,
 +				DC527C1E2BC75165000D7CCF /* CHANGES.md in Resources */,
 +				DC907EA02BB4DBCE00523116 /* Preview Assets.xcassets in Resources */,
 +				DC527BD22BC75114000D7CCF /* HeadStep.snd in Resources */,
 +				DC527BD42BC75114000D7CCF /* HeadUnload.snd in Resources */,
 +				DCE5AD282C3D15AF0080AD01 /* Credits.rtf in Resources */,
 +				DC527BC82BC75107000D7CCF /* Teletext.fnt in Resources */,
 +				DC527BD12BC75114000D7CCF /* DriveMotor.snd in Resources */,
 +				DC527BC92BC75107000D7CCF /* RelayOn.snd in Resources */,
 +				DC907E9D2BB4DBCE00523116 /* Assets.xcassets in Resources */,
 +				DC527C202BC75175000D7CCF /* README-SPROW.txt in Resources */,
 +				DC527BD52BC75114000D7CCF /* HeadLoad.snd in Resources */,
 +				DC907EAD2BB5B7F300523116 /* Main.storyboard in Resources */,
 +				DCBACC552C1591D1005F2079 /* BeebEm.rc in Resources */,
 +				DC527BCA2BC75107000D7CCF /* README.md in Resources */,
 +			);
 +			runOnlyForDeploymentPostprocessing = 0;
 +		};
 +/* End PBXResourcesBuildPhase section */
 +
 +/* Begin PBXSourcesBuildPhase section */
 +		DC907E912BB4DBCD00523116 /* Sources */ = {
 +			isa = PBXSourcesBuildPhase;
 +			buildActionMask = 2147483647;
 +			files = (
 +				DCDC73312BBF615E00D83402 /* Csw.cpp in Sources */,
 +				DC907EC32BB5C23C00523116 /* BeebViewController.swift in Sources */,
 +				DCDC73282BBF574100D83402 /* 6502core.cpp in Sources */,
 +				DC9427AA2BF037900012C4E4 /* SelectKeyViewController.swift in Sources */,
 +				DC33555F2BDF84C00014DC3A /* RomConfigDialog-mac.cpp in Sources */,
 +				DCDC732A2BBF5AF400D83402 /* ArmDisassembler.cpp in Sources */,
 +				DCB4EBD32BD5BDC4002AEA8A /* BeebEm-Bridging-ExportFIles.cpp in Sources */,
 +				DC7E1E652BCE58D400494CBE /* FileDialog-mac.cpp in Sources */,
 +				DCE94C152BD3109500A5C12A /* BeebEm-Menu.swift in Sources */,
 +				DC0997AA2BBAA6E300A109A5 /* beebemrcids.cpp in Sources */,
 +				DC0D30E32BC12C8E00AFEF01 /* Main.cpp in Sources */,
 +				DCB3B2592BBB865E00F507F4 /* opus.cpp in Sources */,
 +				DC3FB54C2BE8E02300CF36A0 /* KeyMap-mac.cpp in Sources */,
 +				DCE94C172BD310C600A5C12A /* BeebEm-Sound.swift in Sources */,
 +				DCDC733E2BC0AED800D83402 /* Music5000.cpp in Sources */,
 +				DCD284052BE8D2D400ABD9F8 /* BeebEm-Debugger.cpp in Sources */,
 +				DCDC73062BBE043A00D83402 /* Acorn.cpp in Sources */,
 +				DCDC73142BBE198A00D83402 /* TapeMap.cpp in Sources */,
 +				DCDC73352BC0A73600D83402 /* DiscEdit.cpp in Sources */,
 +				DC907ECA2BB6D76F00523116 /* Colour.swift in Sources */,
 +				DCDC732F2BBF5EF600D83402 /* AtoDConv.cpp in Sources */,
 +				DCDC733F2BC0AFBC00D83402 /* PALRom.cpp in Sources */,
 +				DCDC73382BC0A9F800D83402 /* Ide.cpp in Sources */,
 +				DCDC73372BC0A93800D83402 /* Ext1770.cpp in Sources */,
 +				DCDC732E2BBF5E1B00D83402 /* arminit.cpp in Sources */,
 +				DCDC732B2BBF5B7F00D83402 /* armemu.cpp in Sources */,
 +				DCDC73412BC0B0E600D83402 /* Scsi.cpp in Sources */,
 +				DCDC73422BC0B12700D83402 /* Sound.cpp in Sources */,
 +				DC215BE62C13B4DD003E50A3 /* BeebWinDx-mac.cpp in Sources */,
 +				DC7E1E622BCE53E000494CBE /* BeebEm-Bridging-IO.cpp in Sources */,
 +				DC9427B22BF038F10012C4E4 /* SerialPortViewController.swift in Sources */,
 +				DC74E1CE2C29D88C006826EE /* FileType.cpp in Sources */,
 +				DCB4EBD92BDB890F002AEA8A /* RenameFileDialog-mac.cpp in Sources */,
 +				DCDC73452BC0B4A700D83402 /* SprowCoPro.cpp in Sources */,
 +				DC907EC12BB5C1F100523116 /* BeebApplication.swift in Sources */,
 +				DC69C9F72BF2BDC700610067 /* BeebEm-KeyboardLinks.swift in Sources */,
 +				DCACDAC12BC5DD2E00CEF154 /* apples.cpp in Sources */,
 +				DCDC73472BC0B5C200D83402 /* Teletext.cpp in Sources */,
 +				DCB4EBCA2BD5BD02002AEA8A /* BeebEm-Bridging-BreakoutBox.cpp in Sources */,
 +				DCDC733C2BC0ACE200D83402 /* Log.cpp in Sources */,
 +				DCDC734B2BC0B78E00D83402 /* UefState.cpp in Sources */,
 +				DC9427B02BF038B90012C4E4 /* TeletextViewController.swift in Sources */,
 +				DCD283FF2BE8D17400ABD9F8 /* BeebEm-Debug.swift in Sources */,
 +				DCDC73462BC0B5B500D83402 /* SysVia.cpp in Sources */,
 +				DC3355602BDF8D720014DC3A /* BeebEm-RomConfig.swift in Sources */,
 +				DC2C9D072BF978AF00F2E613 /* UserPortRTC.cpp in Sources */,
 +				DCB4EBCD2BD5BD22002AEA8A /* BeebEm-Bridging-UserKeyboard.cpp in Sources */,
 +				DCDC73342BBFE87C00D83402 /* Disc8271.cpp in Sources */,
 +				DC9427B82BF0FBE90012C4E4 /* SerialPortDialog-mac.cpp in Sources */,
 +				DC527AD12BC71C21000D7CCF /* BeebEm-Bridging-Video.cpp in Sources */,
 +				DC8450092BE3FAF4002015D9 /* UserPortBreakoutBox-mac.cpp in Sources */,
 +				DC9B41342BC215BD00C3D9D8 /* Econet.cpp in Sources */,
 +				DC689D0D2C2D3E68009BA41F /* BeebEm-Bridging-SerialPort.cpp in Sources */,
 +				DCDC734D2BC0B80C00D83402 /* UserVia.cpp in Sources */,
 +				DC9B41322BC2145D00C3D9D8 /* Thread.cpp in Sources */,
 +				DC9B41332BC2151900C3D9D8 /* Video.cpp in Sources */,
 +				DC1DBA212BB8CF8B00AAB22F /* TapeControlViewController.swift in Sources */,
 +				DCDC734E2BC0B85F00D83402 /* Via.cpp in Sources */,
 +				DCDC73092BBE108600D83402 /* Bcd.cpp in Sources */,
 +				DCDC73442BC0B43400D83402 /* SoundStreamer.cpp in Sources */,
 +				DC907ECC2BB70CE000523116 /* NSImage+Bitmap.swift in Sources */,
 +				DCB4EBC72BD5BCD7002AEA8A /* BeebEm-Bridging-Roms.cpp in Sources */,
 +				DC9B41352BC2190500C3D9D8 /* BeebWin.cpp in Sources */,
 +				DCDC73152BBE1A9500D83402 /* StringUtils.cpp in Sources */,
 +				DC69C9FD2BF2C87A00610067 /* BeebEm-Bridging-KeyboardLinks.cpp in Sources */,
 +				DCB4EBD62BDB26F1002AEA8A /* FolderSelectDialog-mac.cpp in Sources */,
 +				DCD283F22BE6E17100ABD9F8 /* SelectKeyDialog-mac.cpp in Sources */,
 +				DC69C9FA2BF2BDE100610067 /* KeyboardLinksDialog-mac.cpp in Sources */,
 +				DC904DA22BCF3CD60069DCDF /* ExportDiscViewController.swift in Sources */,
 +				DCDC733D2BC0AD1600D83402 /* Master512CoPro.cpp in Sources */,
 +				DC9427B52BF0FBAA0012C4E4 /* TeletextDialog-mac.cpp in Sources */,
 +				DCE94C1D2BD312B100A5C12A /* BeebEm-Beeb.swift in Sources */,
 +				DC9427AE2BF0386C0012C4E4 /* BeebEm-Teletext.swift in Sources */,
 +				DCDC73482BC0B6CC00D83402 /* TouchScreen.cpp in Sources */,
 +				DC1DBA202BB8CF8600AAB22F /* BeebEm-TapeControl.swift in Sources */,
 +				DCDC73402BC0AFF100D83402 /* Sasi.cpp in Sources */,
 +				DCDC73302BBF5F2200D83402 /* BeebMem.cpp in Sources */,
 +				DCDC73072BBE043D00D83402 /* Watford.cpp in Sources */,
 +				DCDC732C2BBF5E0600D83402 /* armsupp.cpp in Sources */,
 +				DC1DBA252BB9A4C900AAB22F /* BreakoutBoxViewController.swift in Sources */,
 +				DC907EB02BB5BA4000523116 /* AppDelegate.swift in Sources */,
++				DC9C67EC2D880C140026DE4D /* WindowUtils.cpp in Sources */,
 +				DC9B41302BC20C0500C3D9D8 /* IP232.cpp in Sources */,
 +				DCE94C1B2BD311D800A5C12A /* BeebEm-Bundle.swift in Sources */,
 +				DC7E1E682BCF229600494CBE /* ExportFileDialog-mac.cpp in Sources */,
 +				DCDC73162BBE1AC600D83402 /* RingBuffer.cpp in Sources */,
 +				DC2C9D042BF9788700F2E613 /* Rtc.cpp in Sources */,
 +				DC907EC62BB6D48600523116 /* Renderer.swift in Sources */,
 +				DCDC73102BBE188400D83402 /* Uef.cpp in Sources */,
 +				DC90FFD12BEB5B820007EB37 /* Model.cpp in Sources */,
 +				DCE94C192BD3117200A5C12A /* BeebEm-Files.swift in Sources */,
 +				DC907EC82BB6D55100523116 /* Bitmap.swift in Sources */,
 +				DC9B413A2BC22FE200C3D9D8 /* BeebWinPrefs.cpp in Sources */,
 +				DCB4EBD02BD5BD4E002AEA8A /* BeebEm-Bridging-TapeControl.cpp in Sources */,
 +				DCCE05BE2C11DD6300CAAD24 /* AppleSoundStreamer.cpp in Sources */,
++				DC9C67E62D8808000026DE4D /* Socket.cpp in Sources */,
 +				DC1DBA222BB998B000AAB22F /* KeyboardMappingViewController.swift in Sources */,
 +				DC527AD22BC71CBC000D7CCF /* BeebEm-Bridging-Main.cpp in Sources */,
 +				DC215BEA2C13C359003E50A3 /* AVIWriter.cpp in Sources */,
 +				DC84500B2BE45931002015D9 /* BeebEm-BreakoutBox.swift in Sources */,
 +				DC4E6BBB2C31386F006443D3 /* DebugTrace.cpp in Sources */,
 +				DC8450062BE2DA04002015D9 /* BeebEm-KeyboardMapping.swift in Sources */,
 +				DCDC730B2BBE118B00D83402 /* Preferences.cpp in Sources */,
 +				DC2C9D032BF9788700F2E613 /* RomConfigFile.cpp in Sources */,
 +				DCC91DB92C1AE5D500B751D5 /* BeebWin-mac.cpp in Sources */,
 +				DCD283FA2BE8427900ABD9F8 /* BeebWinSpeech-mac.cpp in Sources */,
 +				DC1DBA232BB9A2BB00AAB22F /* RomConfigViewController.swift in Sources */,
 +				DC9427AC2BF038090012C4E4 /* BeebEm-SerialPort.swift in Sources */,
 +				DC74E1CF2C29D88C006826EE /* Registry.cpp in Sources */,
 +				DCDC731E2BBE215F00D83402 /* IC32Latch.cpp in Sources */,
 +				DCDC734F2BC0B8C500D83402 /* Z80.cpp in Sources */,
 +				DCDC734A2BC0B75800D83402 /* Tube.cpp in Sources */,
 +				DC907ECE2BB70E7B00523116 /* BeebSKView.swift in Sources */,
 +				DCDC732D2BBF5E1500D83402 /* thumbemu.cpp in Sources */,
 +				DC69C9F52BF2BDB600610067 /* KeyboardLinksViewController.swift in Sources */,
 +				DCDC73512BC0B99700D83402 /* Z80Support.cpp in Sources */,
 +				DCDC73332BBFE79800D83402 /* Disc1770.cpp in Sources */,
 +				DCDC730E2BBE13BF00D83402 /* DiscInfo.cpp in Sources */,
++				DC9C67E52D8808000026DE4D /* SerialPort.cpp in Sources */,
 +				DC9B41372BC22AE700C3D9D8 /* BeebWinIo.cpp in Sources */,
 +				DC904DA02BCF3C240069DCDF /* BeebEm-ExportFiles.swift in Sources */,
 +				DCD283FD2BE8C8DA00ABD9F8 /* Debug-mac.cpp in Sources */,
 +				DC527D172BC9110E000D7CCF /* BeebEm-Bridging-Keyboard.cpp in Sources */,
 +				DC907EB22BB5BAD300523116 /* BeebEm-Panels.swift in Sources */,
 +				DCDC73502BC0B8D400D83402 /* Z80dis.cpp in Sources */,
 +				DCDC73292BBF58DC00D83402 /* Arm.cpp in Sources */,
 +				DC84500E2BE4616C002015D9 /* TapeControlDialog-mac.cpp in Sources */,
 +				DCB4EBDC2BDB89E5002AEA8A /* Dialog-mac.cpp in Sources */,
 +				DC8450052BE2D7F1002015D9 /* UserKeyboardDialog-mac.cpp in Sources */,
 +				DCDC730F2BBE13EE00D83402 /* FileUtils.cpp in Sources */,
 +				DC9B41312BC2108600C3D9D8 /* Serial.cpp in Sources */,
 +				DCD284022BE8D22C00ABD9F8 /* DebuggerViewController.swift in Sources */,
 +			);
 +			runOnlyForDeploymentPostprocessing = 0;
 +		};
 +/* End PBXSourcesBuildPhase section */
 +
 +/* Begin PBXVariantGroup section */
 +		DC907EAB2BB5B7F300523116 /* Main.storyboard */ = {
 +			isa = PBXVariantGroup;
 +			children = (
 +				DC907EAC2BB5B7F300523116 /* Base */,
 +			);
 +			name = Main.storyboard;
 +			sourceTree = "<group>";
 +		};
 +/* End PBXVariantGroup section */
 +
 +/* Begin XCBuildConfiguration section */
 +		DC907EA22BB4DBCE00523116 /* Debug */ = {
 +			isa = XCBuildConfiguration;
 +			buildSettings = {
 +				ALWAYS_SEARCH_USER_PATHS = NO;
 +				CLANG_ANALYZER_NONNULL = YES;
 +				CLANG_ANALYZER_NUMBER_OBJECT_CONVERSION = YES_AGGRESSIVE;
 +				CLANG_CXX_LANGUAGE_STANDARD = "gnu++17";
 +				CLANG_ENABLE_MODULES = YES;
 +				CLANG_ENABLE_OBJC_ARC = YES;
 +				CLANG_ENABLE_OBJC_WEAK = YES;
 +				CLANG_WARN_BLOCK_CAPTURE_AUTORELEASING = YES;
 +				CLANG_WARN_BOOL_CONVERSION = YES;
 +				CLANG_WARN_COMMA = YES;
 +				CLANG_WARN_CONSTANT_CONVERSION = YES;
 +				CLANG_WARN_DEPRECATED_OBJC_IMPLEMENTATIONS = YES;
 +				CLANG_WARN_DIRECT_OBJC_ISA_USAGE = YES_ERROR;
 +				CLANG_WARN_DOCUMENTATION_COMMENTS = YES;
 +				CLANG_WARN_EMPTY_BODY = YES;
 +				CLANG_WARN_ENUM_CONVERSION = YES;
 +				CLANG_WARN_INFINITE_RECURSION = YES;
 +				CLANG_WARN_INT_CONVERSION = YES;
 +				CLANG_WARN_NON_LITERAL_NULL_CONVERSION = YES;
 +				CLANG_WARN_OBJC_IMPLICIT_RETAIN_SELF = YES;
 +				CLANG_WARN_OBJC_LITERAL_CONVERSION = YES;
 +				CLANG_WARN_OBJC_ROOT_CLASS = YES_ERROR;
 +				CLANG_WARN_QUOTED_INCLUDE_IN_FRAMEWORK_HEADER = YES;
 +				CLANG_WARN_RANGE_LOOP_ANALYSIS = YES;
 +				CLANG_WARN_STRICT_PROTOTYPES = YES;
 +				CLANG_WARN_SUSPICIOUS_MOVE = YES;
 +				CLANG_WARN_UNGUARDED_AVAILABILITY = YES_AGGRESSIVE;
 +				CLANG_WARN_UNREACHABLE_CODE = YES;
 +				CLANG_WARN__DUPLICATE_METHOD_MATCH = YES;
 +				COPY_PHASE_STRIP = NO;
 +				DEBUG_INFORMATION_FORMAT = dwarf;
 +				ENABLE_STRICT_OBJC_MSGSEND = YES;
 +				ENABLE_TESTABILITY = YES;
 +				GCC_C_LANGUAGE_STANDARD = gnu11;
 +				GCC_DYNAMIC_NO_PIC = NO;
 +				GCC_NO_COMMON_BLOCKS = YES;
 +				GCC_OPTIMIZATION_LEVEL = 0;
 +				GCC_PREPROCESSOR_DEFINITIONS = (
 +					"DEBUG=1",
 +					"$(inherited)",
 +					MODET,
 +					BEEBEM,
 +					MODE32,
 +					NDEBUG,
 +				);
 +				GCC_WARN_64_TO_32_BIT_CONVERSION = YES;
 +				GCC_WARN_ABOUT_RETURN_TYPE = YES_ERROR;
 +				GCC_WARN_UNDECLARED_SELECTOR = YES;
 +				GCC_WARN_UNINITIALIZED_AUTOS = YES_AGGRESSIVE;
 +				GCC_WARN_UNUSED_FUNCTION = YES;
 +				GCC_WARN_UNUSED_VARIABLE = YES;
 +				INFOPLIST_KEY_NSHumanReadableCopyright = "";
 +				MACOSX_DEPLOYMENT_TARGET = 12.3;
 +				MTL_ENABLE_DEBUG_INFO = INCLUDE_SOURCE;
 +				MTL_FAST_MATH = YES;
 +				ONLY_ACTIVE_ARCH = YES;
 +				SDKROOT = macosx;
 +				SWIFT_ACTIVE_COMPILATION_CONDITIONS = DEBUG;
 +				SWIFT_OPTIMIZATION_LEVEL = "-Onone";
 +			};
 +			name = Debug;
 +		};
 +		DC907EA32BB4DBCE00523116 /* Release */ = {
 +			isa = XCBuildConfiguration;
 +			buildSettings = {
 +				ALWAYS_SEARCH_USER_PATHS = NO;
 +				CLANG_ANALYZER_NONNULL = YES;
 +				CLANG_ANALYZER_NUMBER_OBJECT_CONVERSION = YES_AGGRESSIVE;
 +				CLANG_CXX_LANGUAGE_STANDARD = "gnu++17";
 +				CLANG_ENABLE_MODULES = YES;
 +				CLANG_ENABLE_OBJC_ARC = YES;
 +				CLANG_ENABLE_OBJC_WEAK = YES;
 +				CLANG_WARN_BLOCK_CAPTURE_AUTORELEASING = YES;
 +				CLANG_WARN_BOOL_CONVERSION = YES;
 +				CLANG_WARN_COMMA = YES;
 +				CLANG_WARN_CONSTANT_CONVERSION = YES;
 +				CLANG_WARN_DEPRECATED_OBJC_IMPLEMENTATIONS = YES;
 +				CLANG_WARN_DIRECT_OBJC_ISA_USAGE = YES_ERROR;
 +				CLANG_WARN_DOCUMENTATION_COMMENTS = YES;
 +				CLANG_WARN_EMPTY_BODY = YES;
 +				CLANG_WARN_ENUM_CONVERSION = YES;
 +				CLANG_WARN_INFINITE_RECURSION = YES;
 +				CLANG_WARN_INT_CONVERSION = YES;
 +				CLANG_WARN_NON_LITERAL_NULL_CONVERSION = YES;
 +				CLANG_WARN_OBJC_IMPLICIT_RETAIN_SELF = YES;
 +				CLANG_WARN_OBJC_LITERAL_CONVERSION = YES;
 +				CLANG_WARN_OBJC_ROOT_CLASS = YES_ERROR;
 +				CLANG_WARN_QUOTED_INCLUDE_IN_FRAMEWORK_HEADER = YES;
 +				CLANG_WARN_RANGE_LOOP_ANALYSIS = YES;
 +				CLANG_WARN_STRICT_PROTOTYPES = YES;
 +				CLANG_WARN_SUSPICIOUS_MOVE = YES;
 +				CLANG_WARN_UNGUARDED_AVAILABILITY = YES_AGGRESSIVE;
 +				CLANG_WARN_UNREACHABLE_CODE = YES;
 +				CLANG_WARN__DUPLICATE_METHOD_MATCH = YES;
 +				COPY_PHASE_STRIP = NO;
 +				DEBUG_INFORMATION_FORMAT = "dwarf-with-dsym";
 +				ENABLE_NS_ASSERTIONS = NO;
 +				ENABLE_STRICT_OBJC_MSGSEND = YES;
 +				GCC_C_LANGUAGE_STANDARD = gnu11;
 +				GCC_NO_COMMON_BLOCKS = YES;
 +				GCC_PREPROCESSOR_DEFINITIONS = (
 +					BEEBEM,
 +					MODET,
 +					MODE32,
 +					NDEBUG,
 +				);
 +				GCC_WARN_64_TO_32_BIT_CONVERSION = YES;
 +				GCC_WARN_ABOUT_RETURN_TYPE = YES_ERROR;
 +				GCC_WARN_UNDECLARED_SELECTOR = YES;
 +				GCC_WARN_UNINITIALIZED_AUTOS = YES_AGGRESSIVE;
 +				GCC_WARN_UNUSED_FUNCTION = YES;
 +				GCC_WARN_UNUSED_VARIABLE = YES;
 +				INFOPLIST_KEY_NSHumanReadableCopyright = "";
 +				MACOSX_DEPLOYMENT_TARGET = 12.3;
 +				MTL_ENABLE_DEBUG_INFO = NO;
 +				MTL_FAST_MATH = YES;
 +				SDKROOT = macosx;
 +				SWIFT_COMPILATION_MODE = wholemodule;
 +				SWIFT_OPTIMIZATION_LEVEL = "-O";
 +			};
 +			name = Release;
 +		};
 +		DC907EA52BB4DBCE00523116 /* Debug */ = {
 +			isa = XCBuildConfiguration;
 +			buildSettings = {
 +				ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon;
 +				ASSETCATALOG_COMPILER_GLOBAL_ACCENT_COLOR_NAME = AccentColor;
 +				CLANG_ENABLE_MODULES = YES;
 +				CODE_SIGN_ENTITLEMENTS = BeebEm/BeebEm.entitlements;
 +				CODE_SIGN_IDENTITY = "-";
 +				CODE_SIGN_STYLE = Automatic;
 +				COMBINE_HIDPI_IMAGES = YES;
 +				CURRENT_PROJECT_VERSION = 4;
 +				DEVELOPMENT_ASSET_PATHS = "\"BeebEm/Preview Content\"";
 +				DEVELOPMENT_TEAM = "";
 +				ENABLE_HARDENED_RUNTIME = YES;
 +				ENABLE_PREVIEWS = YES;
 +				GENERATE_INFOPLIST_FILE = YES;
 +				INFOPLIST_FILE = BeebEm/Info.plist;
 +				INFOPLIST_KEY_LSApplicationCategoryType = "public.app-category.entertainment";
 +				INFOPLIST_KEY_NSHumanReadableCopyright = "1995-2024 BeebEm Contributors";
 +				INFOPLIST_KEY_NSMainStoryboardFile = Main;
 +				INFOPLIST_KEY_NSPrincipalClass = BeebEm.BeebApplication;
 +				LD_RUNPATH_SEARCH_PATHS = (
 +					"$(inherited)",
 +					"@executable_path/../Frameworks",
 +				);
 +				MACOSX_DEPLOYMENT_TARGET = 10.13;
 +				MARKETING_VERSION = "4.19-mac";
 +				PRODUCT_BUNDLE_IDENTIFIER = com.commandercoder.BeebEm;
 +				PRODUCT_NAME = "$(TARGET_NAME)";
 +				SWIFT_EMIT_LOC_STRINGS = YES;
 +				SWIFT_OBJC_BRIDGING_HEADER = "Src/MacBridge/BeebEm-Bridging-Header.h";
 +				SWIFT_OPTIMIZATION_LEVEL = "-Onone";
 +				SWIFT_VERSION = 5.0;
 +				SYSTEM_HEADER_SEARCH_PATHS = Src/windows_stubs;
 +			};
 +			name = Debug;
 +		};
 +		DC907EA62BB4DBCE00523116 /* Release */ = {
 +			isa = XCBuildConfiguration;
 +			buildSettings = {
 +				ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon;
 +				ASSETCATALOG_COMPILER_GLOBAL_ACCENT_COLOR_NAME = AccentColor;
 +				CLANG_ENABLE_MODULES = YES;
 +				CODE_SIGN_ENTITLEMENTS = BeebEm/BeebEm.entitlements;
 +				CODE_SIGN_IDENTITY = "-";
 +				CODE_SIGN_STYLE = Automatic;
 +				COMBINE_HIDPI_IMAGES = YES;
 +				CURRENT_PROJECT_VERSION = 4;
 +				DEVELOPMENT_ASSET_PATHS = "\"BeebEm/Preview Content\"";
 +				DEVELOPMENT_TEAM = "";
 +				ENABLE_HARDENED_RUNTIME = YES;
 +				ENABLE_PREVIEWS = YES;
 +				GENERATE_INFOPLIST_FILE = YES;
 +				INFOPLIST_FILE = BeebEm/Info.plist;
 +				INFOPLIST_KEY_LSApplicationCategoryType = "public.app-category.entertainment";
 +				INFOPLIST_KEY_NSHumanReadableCopyright = "1995-2024 BeebEm Contributors";
 +				INFOPLIST_KEY_NSMainStoryboardFile = Main;
 +				INFOPLIST_KEY_NSPrincipalClass = BeebEm.BeebApplication;
 +				LD_RUNPATH_SEARCH_PATHS = (
 +					"$(inherited)",
 +					"@executable_path/../Frameworks",
 +				);
 +				MACOSX_DEPLOYMENT_TARGET = 10.13;
 +				MARKETING_VERSION = "4.19-mac";
 +				PRODUCT_BUNDLE_IDENTIFIER = com.commandercoder.BeebEm;
 +				PRODUCT_NAME = "$(TARGET_NAME)";
 +				SWIFT_EMIT_LOC_STRINGS = YES;
 +				SWIFT_OBJC_BRIDGING_HEADER = "Src/MacBridge/BeebEm-Bridging-Header.h";
 +				SWIFT_VERSION = 5.0;
 +				SYSTEM_HEADER_SEARCH_PATHS = Src/windows_stubs;
 +			};
 +			name = Release;
 +		};
 +/* End XCBuildConfiguration section */
 +
 +/* Begin XCConfigurationList section */
 +		DC907E902BB4DBCD00523116 /* Build configuration list for PBXProject "BeebEm" */ = {
 +			isa = XCConfigurationList;
 +			buildConfigurations = (
 +				DC907EA22BB4DBCE00523116 /* Debug */,
 +				DC907EA32BB4DBCE00523116 /* Release */,
 +			);
 +			defaultConfigurationIsVisible = 0;
 +			defaultConfigurationName = Release;
 +		};
 +		DC907EA42BB4DBCE00523116 /* Build configuration list for PBXNativeTarget "BeebEm" */ = {
 +			isa = XCConfigurationList;
 +			buildConfigurations = (
 +				DC907EA52BB4DBCE00523116 /* Debug */,
 +				DC907EA62BB4DBCE00523116 /* Release */,
 +			);
 +			defaultConfigurationIsVisible = 0;
 +			defaultConfigurationName = Release;
 +		};
 +/* End XCConfigurationList section */
 +	};
 +	rootObject = DC907E8D2BB4DBCD00523116 /* Project object */;
 +}
diff --cc XCode/Project/Src/MacBridge/BeebEm-Bridging-Keyboard.cpp
index 7be471f,0000000..6f4562d
mode 100644,000000..100644
--- a/XCode/Project/Src/MacBridge/BeebEm-Bridging-Keyboard.cpp
+++ b/XCode/Project/Src/MacBridge/BeebEm-Bridging-Keyboard.cpp
@@@ -1,677 -1,0 +1,635 @@@
 +//
 +//  BeebEm-Bridging-Keyboard.cpp
 +//  BeebEm
 +//
 +//  Created by Commander Coder on 12/04/2024.
 +//
 +
 +#include <windows.h>
 +
 +
 +enum {
 +	aEventJoystick1Axis              = 0x0000,
 +	aEventJoystick1Button            = 0x0001,
 +	aEventJoystick2Axis              = 0x1000,
 +	aEventJoystick2Button            = 0x1001,
 +};
 +
 +
 +#include <Carbon/Carbon.h>
 +#include "BeebWin.h"
 +#include "6502core.h"
 +#include "Disc8271.h"
 +#include "Disc1770.h"
 +#include "Econet.h"
 +#include "Scsi.h"
 +#include "Sasi.h"
 +#include "IDE.h"
 +#include "Sound.h"
 +#include "Music5000.h"
 +#include "Tube.h"
 +#include "Master512CoPro.h"
 +#include "Z80mem.h"
 +#include "Z80.h"
 +#include "SprowCoPro.h"
 +#include "Teletext.h"
 +#include "SysVia.h"
 +extern BeebWin* mainWin;
 +
 +
 +// map from APPLE input: https://eastmanreference.com/complete-list-of-applescript-key-codes
 +// to WINDOWS input: https://learn.microsoft.com/en-us/windows/win32/inputdev/virtual-key-codes
 +
 +// which is then translated to beeb input:
 +/* from b-Em
 + 
 + *       0x00      0x01  0x02  0x03 0x04 0x05 0x06 0x07 0x08 0x09    0x0a   0x0b   0x0c
 + * 0x00  Shift     Ctrl  <------- starup up DIP swicthes ------->
 + * 0x10  Q         3     4     5    f4   8    f7   =-   ~^   Left    KP 6   KP 7
 + * 0x20  f0        W     E     T    7    I    9    0        Down    KP 8   KP 9
 + * 0x30  1         2     D     R    6    U    O    P    [{   Up      KP +   KP -   KP Return
 + * 0x40  CapsLck   A     X     F    Y    J    K    @    :*   Return  KP /   KP Del KP .
 + * 0x50  ShiftLck  S     C     G    H    N    L    ;+   ]}   Delete  KP #   KP *   KP ,
 + * 0x60  Tab       Z     SPC   V    B    M    <,   >.   /?   Copy    KP 0   KP 1   KP 3
 + * 0x70  ESC       f1    f2    f3   f5   f6   f8   f9   \    Right   KP 4   KP 5   KP 2
 + */
 +
 +int kmap[] =
 +{
 +VK_KEY_A, //[0]
 +VK_KEY_S,
 +VK_KEY_D,
 +VK_KEY_F,
 +VK_KEY_H,
 +VK_KEY_G,
 +VK_KEY_Z,
 +VK_KEY_X,
 +VK_KEY_C,
 +VK_KEY_V,
 +VK_OEM_MINUS, //VK_KEY_ (next to 1)
 +VK_KEY_B, //[11]
 +VK_KEY_Q,
 +VK_KEY_W,
 +VK_KEY_E,
 +VK_KEY_R,
 +VK_KEY_Y,
 +VK_KEY_T,
 +VK_KEY_1,
 +VK_KEY_2,
 +VK_KEY_3,
 +VK_KEY_4,
 +VK_KEY_6,
 +VK_KEY_5,
 +VK_OEM_PLUS,
 +VK_KEY_9, //[25]
 +VK_KEY_7,
 +VK_OEM_MINUS,
 +VK_KEY_8,
 +VK_KEY_0,
 +VK_OEM_6, //]
 +VK_KEY_O,
 +VK_KEY_U,
 +VK_OEM_4, //[
 +VK_KEY_I,
 +VK_KEY_P,
 +VK_RETURN,
 +VK_KEY_L,
 +VK_KEY_J, //[38]
 +VK_OEM_3, //'
 +VK_KEY_K,
 +VK_OEM_1, //;
 +VK_OEM_5, //\    .
 +VK_OEM_COMMA,
 +VK_OEM_2, // /
 +VK_KEY_N,
 +VK_KEY_M,
 +VK_OEM_PERIOD, //.
 +VK_TAB,
 +VK_SPACE,
 +VK_OEM_8, // ~` [50]
 +VK_BACK,
 +0,
 +VK_ESCAPE,
 +0,
 +0, // [55] COMMAND
 +0, // [56] /// left shift
 +0, // [57] caps lock
 +0, // [58] left option
 +0, // [59] left control
 +0, // [60] // right shift
 +0, // [61] right option
 +0, // [62] right control
 +0, // [63] fn key
 +0, // [64]
 +0,
 +0,
 +0,
 +0, // [68]
 +0,
 +0,
 +0,
 +0, // [72]
 +0,
 +0,
 +0,
 +0, // [76]
 +0,
 +0,
 +0,
 +0, // [80]
 +0,
 +0,
 +0,
 +0, // [84]
 +0,
 +0,
 +0,
 +0, // [88]
 +0,
 +0,
 +0,
 +0, // [92]
 +0,
 +0,
 +0,
 +VK_F5, // F5 [96]
 +VK_F6, // F6
 +VK_F3, // F3
 +VK_F7, // F7
 +VK_F8, // F8
 +VK_F9, // F9
 +0,
 +VK_END, // f11
 +0,
 +VK_F13, //[BREAK - F13] 105
 +0,
 +0,
 +0,
 +VK_F10, // F10
 +0,
 +VK_F12, //[BREAK - F12]
 +0, // [112]
 +0,
 +0,
 +0,
 +0, // pageup [116]
 +0,
 +VK_F4, // F4
 +VK_END, // <end>
 +VK_F2, // F2 [120]
 +0, //pagedown
 +VK_F1, // F1
 +VK_LEFT, // <left>
 +VK_RIGHT,  // <right> [124]
 +VK_DOWN,  // <down>
 +VK_UP,  // <up>
 +0,
 +VK_SHIFT, // <SHIFT> //[128]
 +0,
 +0,
 +0,
 +0, // [132]
 +0,
 +0,
 +0,
 +0, // [136]
 +0,
 +0,
 +0,
 +0, // [140]
 +0,
 +0,
 +0,
 +0, // [144]
 +0,
 +0,
 +0,
 +0, // [148]
 +0,
 +0,
 +0,
 +0, // [152]
 +0,
 +0,
 +0,
 +0, // [156]
 +0,
 +0,
 +0,
 +0, // [160]
 +0,
 +0,
 +0,
 +0, // [164]
 +0,
 +0,
 +0,
 +0, // [168]
 +0,
 +0,
 +0,
 +0, // [172]
 +0,
 +0,
 +0,
 +0, // [176]
 +0,
 +0,
 +0,
 +0, // [180]
 +0,
 +0,
 +0,
 +0, // [184]
 +0,
 +0,
 +0,
 +0, // [188]
 +0,
 +0,
 +0,
 +0, // [192]
 +0,
 +0,
 +0,
 +0, // [196]
 +0,
 +0,
 +0,
 +0, // [200]
 +VK_CONTROL, // 201 is CTRL
 +VK_CAPITAL, // 202 is ALT
 +0,
 +0, // [204]
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	0,
 +//	6 10 0 6 10 1 // NUMPAD0 [355]
 +//	6 11 0 6 11 1
 +//	7 12 0 7 12 1
 +//	6 12 0 6 12 1
 +//	7 10 0 7 10 1
 +//	7 11 0 7 11 1
 +//	1 10 0 1 10 1 // NUMPAD6
 +//	1 11 0 1 11 1
 +//	2 10 0 2 10 1
 +//	2 11 0 2 11 1
 +//	5 11 0 5 11 1
 +//	3 10 0 3 10 1
 +//	3 11 0 3 11 1 // VK_SUBTRACT
 +//	4 12 0 4 12 1
 +//	4 10 0 4 10 1
 +//	-3 -3 0 -3 -3 1
 +//	-3 -4 0 -3 -4 1 // <SHORTCUT>
 +
 +
 +};
 +
 +int remapKeys(int k)
 +{
 +	if (k > sizeof(kmap))
 +		return k;
 +	
 +	return kmap[k];
 +}
 +
 +
 +/*
 +*/
 +
 +
 +// SWIFT calls this to
 +extern "C" void beeb_handlekeys(long message, long wParam, long lParam)
 +{
 +//	message :eventkind
 +//  wParam :keycode
 +//	lParam :charCode
 +
 +	int row, col;
 +	int key;
 +
 +	switch (message)
 +	{
 +		case kEventRawKeyDown:
 +//          fprintf(stderr, "Key pressed: code = %d, '%c'\n", wParam, lParam);
 +			// Reset shift state if it was set by Run Disc
 +			if (mainWin->m_ShiftBooted)
 +			{
 +				mainWin->m_ShiftBooted = false;
 +				BeebKeyUp(0, 0);
 +			}
 +			
 +			key = remapKeys((int)wParam);
 +			mainWin->TranslateKey(key, false, row, col);
 +			break;
 +		case kEventRawKeyUp:
 +//          fprintf(stderr, "Key released: code = %d, '%c'\n", wParam, lParam);
 +				key = remapKeys((int)wParam);
 +
 +				if (mainWin->TranslateKey(key, true, row, col) < 0)
 +				{
- 					if (row == -2)
- 					{
- 						// Must do a reset!
- 						Init6502core();
- 
- 						if (TubeType == TubeDevice::Acorn65C02)
- 						{
- 							Init65C02core();
- 						}
- 						else if (TubeType == TubeDevice::Master512CoPro)
- 						{
- 							master512CoPro.Reset();
- 						}
- 						else if (TubeType == TubeDevice::AcornZ80 || TubeType == TubeDevice::TorchZ80)
- 						{
- 							R1Status = 0;
- 							ResetTube();
- 							init_z80();
- 						}
- 						else if (TubeType == TubeDevice::AcornArm)
- 						{
- 							R1Status = 0;
- 							ResetTube();
- 							mainWin->DestroyArmCoPro();
- 							mainWin->CreateArmCoPro();
- 						}
- 						else if (TubeType == TubeDevice::SprowArm)
- 						{
- 							R1Status = 0;
- 							ResetTube();
- 							// We don't want to throw the contents of memory away
- 							// just tell the co-pro to reset itself.
- 							sprow->Reset();
- 						}
- 
- 						Disc8271Reset();
- 						Reset1770();
- 						if (EconetEnabled) EconetReset();//Rob
- 						if (SCSIDriveEnabled) SCSIReset();
- 						if (SCSIDriveEnabled) SASIReset();
- 						if (IDEDriveEnabled)  IDEReset();
- 						TeletextInit();
- 						//SoundChipReset();
- 						Music5000Reset();
- 						if (Music5000Enabled)
- 							Music5000Init();
- 					}
- 					else if(row==-3)
- 					{
- 						if (col==-3) SoundTuning+=0.1; // Page Up
- 						if (col==-4) SoundTuning-=0.1; // Page Down
- 					}
++                    
++                    if (row == -2)
++                    {
++                        mainWin->Break();
++                    }
++                    else if (row == -3)
++                    {
++                        if (col == -3) SoundTuning += 0.1; // Page Up
++                        if (col == -4) SoundTuning -= 0.1; // Page Down
++                    }
 +			}
 +			break;
 +		case kEventRawKeyModifiersChanged:
 +//            fprintf(stderr, "Key modifier : code = %016x\n", wParam);
 +			
 +			static long last_wParam = 0;
 +			
 +			long diff_wParam = wParam ^ last_wParam; // XOR - to find what changed
 +			
 +			// bitpatterns
 +			// 0000 0010 0000 0000 0000 0010 - L SHIFT
 +			// 0000 0010 0000 0000 0000 0100 - R SHIFT
 +			// 0000 0100 0000 0000 0000 0001 - CTRL
 +			// 0000 1000 0000 0000 0010 0000 - L ALT
 +			// 0000 1000 0000 0000 0100 0000 - R ALT
 +			// 0000 0001 0000 0000 0000 0000 - CAPS
 +			// 1000 0000 0000 0000 0000 0000 - FN
 +			// 0001 0000 0000 0000 0000 1000 - L CMD
 +			// 0001 0000 0000 0000 0001 0000 - R CMD
 +
 +#define SHIFTMASK 0x20000
 +#define ALTMASK 0x80000
 +#define CTRLMASK 0x40000
 +#define CMDMASK 0x100000
 +#define CAPSMASK 0x10000
 +#define FNMASK 0x800000
 +			
 +			if ((diff_wParam & SHIFTMASK)!=0) // left and right shift key
 +			{
 +				// UP when mask is 0, DOWN if mask is 1
 +				mainWin->TranslateKey(VK_SHIFT, (wParam & SHIFTMASK)==0, row, col);
 +			}
 +			// APPLE CTRL KEY
 +			if ((diff_wParam & CTRLMASK)!=0) // left and right ctrl key
 +			{
 +				// UP when mask is 0, DOWN if mask is 1
 +				mainWin->TranslateKey(VK_CONTROL, (wParam & CTRLMASK)==0, row, col);
 +			}
 +
 +			// APPLE ALT KEY
 +			if ((diff_wParam & ALTMASK)!=0) // left and right caps key
 +			{
 +				// UP when mask is 0, DOWN if mask is 1
 +				mainWin->TranslateKey(VK_CAPITAL, (wParam & ALTMASK)==0, row, col);
 +			}
 +			
 +			last_wParam = wParam;
 +			break;
 +	}
 +}
 +
 +extern "C" void beeb_handlemouse(long message, long wParam, long lParam)
 +{
 +	UINT msg = WM_LBUTTONUP;
 +	switch (message)
 +	{
 +		case kEventMouseUp:
 +//			fprintf(stderr, "mouseup : code = %ld\n", wParam);
 +			switch (wParam)
 +			{
 +				case MK_RBUTTON: msg = WM_RBUTTONUP; break;
 +				case MK_MBUTTON: msg = WM_MBUTTONUP; break;
 +				default: msg = WM_LBUTTONUP; break;
 +			}
 +			mainWin->AppProc(msg, wParam, lParam);
 +			break;
 +		case kEventMouseDown:
 +//			fprintf(stderr, "mousedown : code = %ld\n", wParam);
 +			switch (wParam)
 +			{
 +				case MK_RBUTTON: msg = WM_RBUTTONDOWN; break;
 +				case MK_MBUTTON: msg = WM_MBUTTONDOWN; break;
 +				default: msg = WM_LBUTTONDOWN; break;
 +			}
 +			mainWin->AppProc(msg, wParam, lParam);
 +			break;
 +		case kEventMouseMoved:
 +		case kEventMouseDragged:
 +			int x = mainWin->m_XWinSize*GET_X_LPARAM(lParam)/32768.0f;
 +			int y = mainWin->m_YWinSize*GET_Y_LPARAM(lParam)/32768.0f;
 +			
 +//			fprintf(stderr, "mousemove : %ld, x = %d, y = %d\n", message, x, y);
 +
 +			bool useMovementDelta = true;
 +			if (useMovementDelta)
 +				mainWin->AppProc(WM_INPUT, wParam, MAKELPARAM(x,y));
 +			else
 +				mainWin->AppProc(WM_MOUSEMOVE, wParam, MAKELPARAM(x,y));
 +			break;
 +	}
 +}
 +
 +static long joy1[4]; // 4 axes
 +static long buttons1; // button bitflags
 +
 +extern "C" void beeb_handlejoystick(long message, long wParam, long lParam)
 +{
 +	// axis or buttons message (joystick1, joystick2)
 +	// axes:
 +	//  wParam is the axis number (axis on a PS3 controller)
 +	//  lParam is axis values
 +	// buttons:
 +	//  wParam is the button number
 +	//  lParam is value (0 up, 1 down)
 +	
 +	switch (message)
 +	{
 +		case aEventJoystick1Axis:
 +			// wParam is 0,1,2 or 3 for x and y axes (on joystick)
 +			if (wParam >= 0 && wParam < 4)
 +			{
 +				joy1[wParam] = 32768.0+lParam;
 +			}
 +
 +			//	MM_JOY1MOVE
 +			//	lParam x,y from wXmax to wXmin..
 +			mainWin->AppProc(MM_JOY1MOVE, 0, MAKELPARAM(joy1[0],joy1[1]));
 +			break;
 +		case aEventJoystick1Button:
 +			//	 JOY_BUTTON1 , JOY_BUTTON2
 +			if (wParam == 0) break;
 +			
 +			int bitpos = 0;
 +			if (wParam == 1) bitpos = JOY_BUTTON1;
 +			if (wParam == 2) bitpos = JOY_BUTTON2;
 +			if (wParam == 3) bitpos = JOY_BUTTON3;
 +			if (wParam == 4) bitpos = JOY_BUTTON4;
 +
 +			long oldpattern = buttons1;
 +
 +			if (lParam==0)
 +			{
 +				buttons1 &= ~bitpos;
 +				if (oldpattern != buttons1)
 +					mainWin->AppProc(MM_JOY1BUTTONUP, buttons1, 0);
 +			}
 +			else
 +			{
 +				buttons1 |= bitpos;
 +				if (oldpattern != buttons1)
 +					mainWin->AppProc(MM_JOY1BUTTONDOWN, buttons1, 0);
 +			}
 +			break;
 +			break;
 +	}
 +	
 +}
 +
diff --cc XCode/Project/Src/MacDialogs/FileDialog-mac.hpp
index c43707a,0000000..cefbb7a
mode 100644,000000..100644
--- a/XCode/Project/Src/MacDialogs/FileDialog-mac.hpp
+++ b/XCode/Project/Src/MacDialogs/FileDialog-mac.hpp
@@@ -1,146 -1,0 +1,152 @@@
 +//
 +//  FileDialog-mac.hpp
 +//  BeebEm
 +//
 +//  Created by Commander Coder on 16/04/2024.
 +//
 +
 +#ifndef FileDialog_mac_hpp
 +#define FileDialog_mac_hpp
 +
 +#include <stdio.h>
 +
 +#include <windows.h>
 +
 +#define LPTSTR char *
 +#define LPCTSTR const char *
 +
 +
 +struct OPENFILENAME
 +{
 +	/*
 +	Type OPENFILENAME
 +		lStructSize As Long
 +		hwndOwner As Long
 +		hInstance As Long
 +		lpstrFilter As String
 +		lpstrCustomFilter As String
 +		nMaxCustomFilter As Long
 +		nFilterIndex As Long
 +		lpstrFile As String
 +		nMaxFile As Long
 +		lpstrFileTitle As String
 +		nMaxFileTitle As Long
 +		lpstrInitialDir As String
 +		lpstrTitle As String
 +		flags As Long
 +		nFileOffset As Integer
 +		nFileExtension As Integer
 +		lpstrDefExt As String
 +		lCustData As Long
 +		lpfnHook As Long
 +		lpTemplateName As String
 +	End Type
 +*/
 +	DWORD lStructSize;
 +	DWORD nFilterIndex;
 +	DWORD nMaxFile;
 +	LPCTSTR lpstrFilter;
 +	LPCTSTR lpstrFile;
 +	LPCTSTR lpstrTitle;
 +	LPCTSTR lpstrInitialDir;
 +};
 +
 +class FileDialog
 +{
 +public:
 +	FileDialog(HWND hwndOwner, LPTSTR result, DWORD resultLength,
 +			   LPCTSTR initialFolder, LPCTSTR filter);
 +	FileDialog(const FileDialog&) = delete;
 +	FileDialog& operator=(FileDialog&) = delete;
 +
 +	// Prepare dialog
 +	void SetFilterIndex(DWORD index)
 +	{
 +		m_ofn.nFilterIndex = index;
 +	}
 +
 +	void AllowMultiSelect()
 +	{
 +		multiSelect = true;
 +//		m_ofn.Flags |= OFN_ALLOWMULTISELECT | OFN_EXPLORER;
 +	}
++    
++    void NoOverwritePrompt()
++    {
++//        m_ofn.Flags &= ~OFN_OVERWRITEPROMPT;
++    }
++
 +
 +	void SetTitle(LPCTSTR title)
 +	{
 +		m_ofn.lpstrTitle = title;
 +	}
 +
 +	// Show dialog
 +	bool Open()
 +	{
 +		// show folder select
 +//		if (strlen(m_ofn.lpstrFile) == 0)
 +//		{
 +//			bool err = swift_SelectFolder(m_ofn.lpstrFile, _MAX_PATH, "Choose a Folder");
 +//			return !err;
 +//		}
 +//		else
 +		{
 +			bool err = swift_GetFilesWithPreview(m_ofn.lpstrFile, m_ofn.nMaxFile, m_ofn.lpstrInitialDir, multiSelect, m_ofn.lpstrFilter);
 +			return !err;
 +		}
 +	}
 +	
 +	int SelectFilterFromExt(const char* filename)
 +	{
 +		const char *Ext = strrchr(filename, '.');
 +		if (Ext != nullptr)
 +		{
 +			if (_stricmp(Ext + 1, "ssd") == 0)
 +			{
 +				return 1;
 +			}
 +			else if (_stricmp(Ext + 1, "dsd") == 0)
 +			{
 +				return 2;
 +			}
 +			else if (_stricmp(Ext + 1, "adf") == 0)
 +			{
 +				return 5;
 +			}
 +			else if (_stricmp(Ext + 1, "adl") == 0)
 +			{
 +				return 6;
 +			}
 +		}
 +		return 0;
 +	}
 +
 +	bool Save()
 +	{
 +		bool Result = swift_SaveFile(m_ofn.lpstrFile, 256, m_ofn.lpstrFilter, m_ofn.lpstrInitialDir);
 +
 +		// lpstrFile will have changed value
 +		m_ofn.nFilterIndex = SelectFilterFromExt(m_ofn.lpstrFile);
 +
 +		return Result;
 +	}
 +
 +	// Get results
 +	DWORD GetFilterIndex() const
 +	{
 +		return m_ofn.nFilterIndex;
 +	}
 +
 +private:
 +	OPENFILENAME m_ofn;
 +	
 +	bool ShowDialog(bool open);
 +
 +	bool multiSelect;
 +};
 +
 +
 +
 +#endif /* FileDialog_mac_hpp */
diff --cc XCode/Project/Src/MacDialogs/TapeControlDialog-mac.cpp
index 8504b39,0000000..2a2b0f4
mode 100644,000000..100644
--- a/XCode/Project/Src/MacDialogs/TapeControlDialog-mac.cpp
+++ b/XCode/Project/Src/MacDialogs/TapeControlDialog-mac.cpp
@@@ -1,370 -1,0 +1,321 @@@
 +//
 +//  TapeControlDialog-mac.cpp
 +//  BeebEm
 +//
 +//  Created by Commander Coder on 03/05/2024.
 +//
 +
 +#include "TapeControlDialog-mac.hpp"
 +
 +#include <string>
++
 +#include "TapeControlDialog.h"
 +#include "Main.h"
 +#include "Resource.h"
 +#include "Serial.h"
++//#include "WindowUtils.h"
 +
- #include "beebemrcids.h"
- extern std::vector<TapeMapEntry> beeb_TapeMap;
- HWND hwndtc = (HWND)Dialogs::tapeControl;
 +
 +// Tape control dialog box variables
 +std::vector<TapeMapEntry> TapeMap;
 +bool TapeControlEnabled = false;
 +static HWND hwndTapeControl;
 +static HWND hwndMap;
 +
- static void TapeControlRecord();
++static INT_PTR CALLBACK TapeControlDlgProc(HWND hwndDlg, UINT message, WPARAM wParam, LPARAM lParam);
++
++static void TapeControlNewTape();
++static void TapeControlEjectTape();
 +static void UpdateState(HWND hwndDlg);
 +
- //static INT_PTR CALLBACK TapeControlDlgProc(HWND hwndDlg, UINT message, WPARAM wParam, LPARAM lParam);
++/****************************************************************************/
++
++#include "beebemrcids.h" // convRC2ID
++extern std::vector<TapeMapEntry> beeb_TapeMap;
++static HWND hwndtc = (HWND)Dialogs::tapeControl;
++
++#define MS_CTS_ON 0x0010
 +
 +void TapeControlOpenDialog(HINSTANCE hinst, HWND /* hwndMain */)
 +{
 +	TapeControlEnabled = true;
 +    
 +    if (!hwndTapeControl)
 +    {
 +        hwndTapeControl = (HWND)&hwndtc;
- //        hwndTapeControl = CreateDialog(hinst, MAKEINTRESOURCE(IDD_TAPECONTROL),
- //                                       NULL, TapeControlDlgProc);
- //        hCurrentDialog = hwndTapeControl;
- //        ShowWindow(hwndTapeControl, SW_SHOW);
- //
- //        hwndMap = GetDlgItem(hwndTapeControl, IDC_TAPE_CONTROL_MAP);
- //        SendMessage(hwndMap, WM_SETFONT, (WPARAM)GetStockObject(ANSI_FIXED_FONT),
- //                    (LPARAM)MAKELPARAM(FALSE,0));
 +
++        /* dialogue created and shown */
 +        swift_OpenDialog(Dialogs::tapeControl, NULL);
++
 +        
 +        int Time = SerialGetTapeClock();
 +        TapeControlAddMapLines();
 +        TapeControlUpdateCounter(Time);
 +    }
 +}
 +
 +void TapeControlCloseDialog()
 +{
- //    DestroyWindow(hwndTapeControl);
++    DestroyWindow(hwndTapeControl);
 +	hwndTapeControl = nullptr;
 +	hwndMap = nullptr;
 +	TapeControlEnabled = false;
 +	hCurrentDialog = nullptr;
 +}
 +
 +void TapeControlAddMapLines()
 +{
- //    SendMessage(hwndMap, LB_RESETCONTENT, 0, 0);
- //    for (const TapeMapEntry& line : TapeMap)
- //    {
- //        SendMessage(hwndMap, LB_ADDSTRING, 0, (LPARAM)line.desc.c_str());
- //    }
 +    beeb_TapeMap.clear();
 +    beeb_TapeMap = TapeMap;
++    swift_TCReload(/*TapeMap*/);
 +
-     swift_TCReload();
- 
++    SendMessage(hwndMap, LB_RESETCONTENT, 0, 0);
++    for (const TapeMapEntry& line : TapeMap)
++    {
++        SendMessage(hwndMap, LB_ADDSTRING, 0, (LPARAM)line.desc.c_str());
++    }
++    
 +	UpdateState(hwndTapeControl);
 +}
 +
 +void TapeControlUpdateCounter(int tape_time)
 +{
 +	if (TapeControlEnabled)
 +	{
 +		size_t i = 0;
 +
 +		while (i < TapeMap.size() && TapeMap[i].time <= tape_time)
 +			i++;
 +
 +		if (i > 0)
 +			i--;
 +        
- //        SendMessage(hwndMap, LB_SETCURSEL, (WPARAM)i, 0);
++        SendMessage(hwndMap, LB_SETCURSEL, (WPARAM)i, 0);
++        
 +		swift_TCSelectItem(i);
 +	}
 +
 +}
 +
 +static void EnableDlgItem(HWND hDlg, UINT nIDDlgItem, bool Enable)
 +{
-     //    EnableWindow(GetDlgItem(m_hwnd, nID), bEnable);
-     
 +    printf("SetDlgItem %d %d", nIDDlgItem, Enable);
 +    swift_SetDlgItem((Dialogs)*hDlg, ConvRC2ID(nIDDlgItem), Enable);
++
++    EnableWindow(GetDlgItem(hDlg, nIDDlgItem), Enable);
 +}
 +
 +static bool IsDlgItemChecked(HWND hDlg, UINT nIDDlgItem)
 +{
 +	return SendDlgItemMessage(hDlg, nIDDlgItem, BM_GETCHECK, 0, 0) == BST_CHECKED;
 +}
 +
 +static void SetDlgItemChecked(HWND hDlg, UINT nIDDlgItem, bool Checked)
 +{
 +	SendDlgItemMessage(hDlg, nIDDlgItem, BM_SETCHECK, Checked ? BST_CHECKED : BST_UNCHECKED, 0);
 +}
 +
 +
 +static void UpdateState(HWND hwndDlg)
 +{
 +	SetFocus(hwndDlg);
 +
 +	SerialTapeState State = SerialGetTapeState();
 +
 +	UINT nIDCheckButton;
 +
- 	switch (State)
- 	{
- 		case SerialTapeState::Playing:
- 			nIDCheckButton = IDC_PLAYING;
- 
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_PLAY, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_STOP, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_EJECT, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_REWIND, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_LOAD_TAPE, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_RECORD, false);
- 			break;
- 
- 		case SerialTapeState::Recording:
- 			nIDCheckButton = IDC_RECORDING;
- 
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_PLAY, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_STOP, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_EJECT, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_REWIND, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_LOAD_TAPE, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_RECORD, false);
- 			break;
- 
- 		case SerialTapeState::Stopped:
- 			nIDCheckButton = IDC_STOPPED;
- 
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_PLAY, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_STOP, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_EJECT, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_REWIND, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_LOAD_TAPE, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_RECORD, true);
- 			break;
- 
- 		case SerialTapeState::NoTape:
- 		default:
- 			nIDCheckButton = IDC_STOPPED;
- 
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_PLAY, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_STOP, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_EJECT, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_REWIND, false);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_LOAD_TAPE, true);
- 			EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_RECORD, true);
- 			break;
- 	}
++    switch (State)
++    {
++        case SerialTapeState::Playing:
++            nIDCheckButton = IDC_PLAYING;
++
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_PLAY, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_STOP, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_EJECT, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_REWIND, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_LOAD_TAPE, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_NEW_TAPE, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_RECORD, false);
++            break;
++
++        case SerialTapeState::Recording:
++            nIDCheckButton = IDC_RECORDING;
++
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_PLAY, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_STOP, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_EJECT, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_REWIND, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_LOAD_TAPE, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_NEW_TAPE, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_RECORD, false);
++            break;
++
++        case SerialTapeState::Stopped:
++            nIDCheckButton = IDC_STOPPED;
++
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_PLAY, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_STOP, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_EJECT, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_REWIND, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_LOAD_TAPE, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_NEW_TAPE, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_RECORD, SerialTapeIsUef());
++            break;
++
++        case SerialTapeState::NoTape:
++        default:
++            nIDCheckButton = IDC_STOPPED;
++
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_PLAY, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_STOP, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_EJECT, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_REWIND, false);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_LOAD_TAPE, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_NEW_TAPE, true);
++            EnableDlgItem(hwndDlg, IDC_TAPE_CONTROL_RECORD, false);
++            break;
++    }
++
++    mainWin->EnableSaveState(State != SerialTapeState::Recording);
 +
 +	CheckRadioButton(hwndDlg,
 +					 IDC_PLAYING,
 +					 IDC_STOPPED,
 +					 nIDCheckButton);
 +}
 +
- #ifndef __APPLE__
- 
- INT_PTR CALLBACK TapeControlDlgProc(HWND hwndDlg, UINT message, WPARAM wParam, LPARAM /* lParam */)
- {
- 	switch (message)
- 	{
- 		case WM_INITDIALOG:
- 			SetDlgItemText(hwndDlg, IDC_TAPE_FILENAME, TapeFileName);
- 			UpdateState(hwndDlg);
- 			return TRUE;
- 
- 		case WM_ACTIVATE:
- 			if (LOWORD(wParam) == WA_INACTIVE)
- 			{
- 				hCurrentDialog = nullptr;
- 			}
- 			else
- 			{
- 				hCurrentDialog = hwndTapeControl;
- 			}
- 			return FALSE;
- 
- 		case WM_COMMAND:
- 			switch (LOWORD(wParam))
- 			{
- 				case IDC_TAPE_CONTROL_MAP:
- 					if (HIWORD(wParam) == LBN_SELCHANGE)
- 					{
- 						LRESULT s = SendMessage(hwndMap, LB_GETCURSEL, 0, 0);
- 
- 						if (s != LB_ERR && s >= 0 && s < (int)TapeMap.size())
- 						{
- 							SetTapePosition(TapeMap[s].time);
- 						}
- 					}
- 					return FALSE;
- 
- 				case IDC_TAPE_CONTROL_PLAY:
- 					SerialStopTapeRecording(true);
- 					SerialPlayTape();
- 					UpdateState(hwndDlg);
- 					return TRUE;
- 
- 				case IDC_TAPE_CONTROL_STOP:
- 					SerialStopTapeRecording(true);
- 					SerialStopTape();
- 					UpdateState(hwndDlg);
- 					return TRUE;
- 
- 				case IDC_TAPE_CONTROL_EJECT:
- 					SerialStopTapeRecording(false);
- 					SerialEjectTape();
- 					SetDlgItemText(hwndDlg, IDC_TAPE_FILENAME, "");
- 					UpdateState(hwndDlg);
- 					return TRUE;
- 
- 				case IDC_TAPE_CONTROL_REWIND:
- 					RewindTape();
- 					UpdateState(hwndDlg);
- 					return TRUE;
- 
- 				case IDC_TAPE_CONTROL_LOAD_TAPE:
- 					mainWin->LoadTape();
- 					return TRUE;
- 
- 				case IDC_TAPE_CONTROL_RECORD:
- 					TapeControlRecord();
- 					UpdateState(hwndDlg);
- 					return TRUE;
- 
- 				case IDC_TAPE_CONTROL_UNLOCK: {
- 					bool Unlock = IsDlgItemChecked(hwndDlg, IDC_TAPE_CONTROL_UNLOCK);
- 					mainWin->SetUnlockTape(Unlock);
- 					return TRUE;
- 				}
- 
- 				case IDCANCEL:
- 					TapeControlCloseDialog();
- 					return TRUE;
- 			}
- 	}
- 
- 	return FALSE;
- }
- #else
- 
- 
 +long TC_WM_COMMAND(UINT32 cmdID)
 +{
 +	HWND hwndDlg = (HWND)&hwndtc;
- 	
++
++    
++    
 +	switch(cmdID)
 +	{
- 		case IDC_TAPE_CONTROL_MAP:
- // Select a row on the tape map
- // Handled by tableViewSelectionDidChange()
- // and in turn: beeb_getTableCellData
- 		{
- 			unsigned int s = swift_TCGetSelected();
- 			if (s >= 0 && s < (int)TapeMap.size())
- 			{
- 				SetTapePosition(TapeMap[s].time);
- 			}
- 			return FALSE;
- 		}
- 		case IDC_TAPE_CONTROL_PLAY:
- 			SerialStopTapeRecording(true);
- 			SerialPlayTape();
- 			UpdateState(hwndDlg);
- 			return TRUE;
- 
- 		case IDC_TAPE_CONTROL_STOP:
- 			SerialStopTapeRecording(true);
- 			SerialStopTape();
- 			UpdateState(hwndDlg);
- 			return TRUE;
- 
- 		case IDC_TAPE_CONTROL_EJECT:
- 			SerialStopTapeRecording(false);
- 			SerialEjectTape();
- 			SetDlgItemText(hwndDlg, IDC_TAPE_FILENAME, "");
- 			UpdateState(hwndDlg);
- 			return TRUE;
- 
- 		case IDC_TAPE_CONTROL_REWIND:
- 			RewindTape();
- 			UpdateState(hwndDlg);
- 			return TRUE;
- 
- 		case IDC_TAPE_CONTROL_LOAD_TAPE:
- 			mainWin->LoadTape();
- 			return TRUE;
- 
- 		case IDC_TAPE_CONTROL_RECORD:
- 			TapeControlRecord();
- 			UpdateState(hwndDlg);
- 			return TRUE;
- 
- 		case IDC_TAPE_CONTROL_UNLOCK: {
- 			bool Unlock = IsDlgItemChecked(hwndDlg, IDC_TAPE_CONTROL_UNLOCK);
- 			mainWin->SetUnlockTape(Unlock);
- 			return TRUE;
- 		}
- 
- 		case IDCANCEL:
- 			TapeControlCloseDialog();
- 			return TRUE;
- 	}
++        case IDC_TAPE_CONTROL_MAP:
++            // Select a row on the tape map
++            // Handled by tableViewSelectionDidChange()
++            // and in turn: beeb_getTableCellData
++            {
++                unsigned int s = swift_TCGetSelected();
++                if (s >= 0 && s < (int)TapeMap.size())
++                {
++                    SetTapePosition(TapeMap[s].time);
++                }
++            }
++            return FALSE;
++
++
++        case IDC_TAPE_CONTROL_PLAY:
++            SerialStopTapeRecording();
++            SerialPlayTape();
++            UpdateState(hwndDlg);
++            return TRUE;
++
++        case IDC_TAPE_CONTROL_STOP:
++            if (TapeState.Recording)
++            {
++                SerialStopTapeRecording();
++                SerialUpdateTapeClock();
++
++                if (SerialTapeIsModified())
++                {
++                    UEFResult Result = UEFFile.Save(TapeFileName);
++
++                    if (Result != UEFResult::Success)
++                    {
++                        mainWin->Report(MessageType::Error,
++                                        "Failed to write to tape file:\n %s", TapeFileName);
++                    }
++
++                    UEFFile.CreateTapeMap(TapeMap);
++                    TapeControlAddMapLines();
++                }
++            }
++
++            SerialStopTape();
++            UpdateState(hwndDlg);
++            return TRUE;
++
++        case IDC_TAPE_CONTROL_EJECT:
++            TapeControlEjectTape();
++            UpdateState(hwndDlg);
++            return TRUE;
++
++        case IDC_TAPE_CONTROL_REWIND:
++            RewindTape();
++            UpdateState(hwndDlg);
++            return TRUE;
++
++        case IDC_TAPE_CONTROL_LOAD_TAPE:
++            mainWin->LoadTape();
++            return TRUE;
++
++        case IDC_TAPE_CONTROL_NEW_TAPE:
++            TapeControlNewTape();
++            TapeControlSetFileName("(Untitled)");
++            UEFFile.CreateTapeMap(TapeMap);
++            TapeControlAddMapLines();
++            UpdateState(hwndDlg);
++            return TRUE;
++
++        case IDC_TAPE_CONTROL_RECORD:
++            SerialRecordTape();
++            UpdateState(hwndDlg);
++            return TRUE;
++
++        case IDC_TAPE_CONTROL_UNLOCK: {
++            bool Unlock = IsDlgItemChecked(hwndDlg, IDC_TAPE_CONTROL_UNLOCK);
++            mainWin->SetUnlockTape(Unlock);
++            return TRUE;
++        }
++
++        case IDCANCEL:
++            TapeControlCloseDialog();
++            return TRUE;
++    }
 +
 +	return false;
 +}
- #endif
 +
- void TapeControlRecord()
++/****************************************************************************/
++
++static void TapeControlEjectTape()
 +{
- 	if (!TapeState.Recording)
- 	{
- 		// Query for new file name
- 		char FileName[_MAX_PATH];
- 		FileName[0] = '\0';
- 
- 		if (mainWin->NewTapeImage(FileName, sizeof(FileName)))
- 		{
- 			CloseTape();
- 
- 			// Create file
- 			if (!SerialRecordTape(FileName))
- 			{
- 				mainWin->Report(MessageType::Error,
- 								"Error creating tape file:\n  %s", FileName);
- 			}
- 		}
- 	}
- 	UpdateState(hwndTapeControl);
++    SerialEjectTape();
++    TapeControlSetFileName("");
++}
++
++/****************************************************************************/
++
++static void TapeControlNewTape()
++{
++    mainWin->NewTape(TapeFileName, sizeof(TapeFileName));
 +}
 +
++/****************************************************************************/
++
 +void TapeControlCloseTape()
 +{
- //    SendMessage(hwndMap, LB_RESETCONTENT, 0, 0);
- 	beeb_TapeMap.clear();
- 	swift_TCReload();
- 	UpdateState(hwndTapeControl);
++    beeb_TapeMap.clear();
++	swift_TCReload(/*TapeMap*/);
++
++    SendMessage(hwndMap, LB_RESETCONTENT, 0, 0);
++    UpdateState(hwndTapeControl);
 +}
 +
++/****************************************************************************/
++
 +void TapeControlSetFileName(const char *FileName)
 +{
- 	SetDlgItemText(hwndTapeControl, IDC_TAPE_FILENAME, FileName);
++    SetDlgItemText(hwndTapeControl, IDC_TAPE_FILENAME, FileName);
 +}
 +
++/****************************************************************************/
++
 +void TapeControlSetUnlock(bool Unlock)
 +{
- 	SetDlgItemChecked(hwndTapeControl, IDC_TAPE_CONTROL_UNLOCK, Unlock);
++    SetDlgItemChecked(hwndTapeControl, IDC_TAPE_CONTROL_UNLOCK, Unlock);
 +}
++
++/****************************************************************************/
diff --cc XCode/Project/Src/apples.cpp
index 2b8c1a4,0000000..cd2dccf
mode 100644,000000..100644
--- a/XCode/Project/Src/apples.cpp
+++ b/XCode/Project/Src/apples.cpp
@@@ -1,713 -1,0 +1,718 @@@
 +//
 +//  apples.cpp
 +//  BeebEm
 +//
 +//  Created by Commander Coder on 09/04/2024.
 +//
 +
 +#include <stdio.h>
 +#include <windows.h>
 +#include "beebemrcids.h"
 +#include <string>
 +
 +#if ((defined(__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 101500))
 +#include <filesystem> // C++17 (or Microsoft-specific implementation in C++14)
 +#define HasC17
 +
 +#endif
 +
 +#include "BeebWin.h"
 +#include "Main.h"
 +#include "Thread.h"
 +#include "Messages.h"
 +
 +int __argc;
 +char** __argv;
 +
 +
 +void GetLocalTime(SYSTEMTIME* _t)
 +{
 +	std::time_t result = std::time(nullptr);
 +	_t = std::localtime(&result);
 +}
 +
 +
 +
 +DWORD GetTickCount() // milliseconds
 +{
 +	auto since_epoch = std::chrono::steady_clock::now().time_since_epoch();
 +	auto milli = std::chrono::duration_cast<std::chrono::milliseconds>(since_epoch);
 +	auto millis = milli.count();
 +	return (DWORD) millis;
 +}
 +
 +
 +void beebwin_ModifyMenu(
 +						UINT position,
 +						UINT newitem,
 +						LPCSTR newtext)
 +{
 +	auto id = ConvRC2ID(position);
 +	if (id>0)
 +		// check the selected item
 +		swift_ModifyMenu(id, ConvRC2ID(newitem), newtext);
 +}
 +
 +
 +void ModifyMenu(HMENU m_hMenu, UINT pf, UINT flags, UINT_PTR newID, LPCSTR str)
 +{
 +	beebwin_ModifyMenu(pf,
 +					   newID,
 +					   str);
 +}
 +
 +// set the tick on the menu with a 4 character identifier
 +void beebwin_SetMenuCheck(UINT cmd, bool check)
 +{
 +	auto id = ConvRC2ID(cmd);
 +	if (id>0)
 +	{
 +		// check the selected item
 +		swift_SetMenuCheck(id, check);
 +	}
 +	
 +}
 +
 +// set the tick on the menu with a 4 character identifier
 +void beebwin_CheckMenuRadioItem(UINT first, UINT last, UINT cmd)
 +{
 +	for (UINT v = first; v <= last; v++)
 +	{
 +		// uncheck all the items in the 'radio'
 +		beebwin_SetMenuCheck(v, false);
 +	}
 +	// check the selected item
 +	beebwin_SetMenuCheck(cmd, true);
 +}
 +
 +
 +void CheckMenuRadioItem(HMENU m_hMenu,
 +						UINT first,
 +						UINT last,
 +						UINT cmdSelectedMenuItem,
 +						UINT cmd)
 +{
 +	// switch between the items - assumes first and last are consecutive and
 +	// that 'SelectedMenuItem' is within that range
 +	beebwin_CheckMenuRadioItem(
 +							   first,
 +							   last,
 +							   cmdSelectedMenuItem);
 +}
 +
 +
 +// set the tick on the menu with a 4 character identifier
 +void beebwin_SetDlgCheck(HWND hwnd, UINT cmd, bool check)
 +{
 +	auto id = ConvRC2ID(cmd);
 +	if (id>0)
 +	{
 +		// check the selected item
 +		swift_SetDlgCheck((Dialogs)*hwnd, id, check);
 +	}
 +	
 +}
 +
 +void beebwin_CheckDlgRadioItem(HWND hwnd, UINT first, UINT last, UINT cmd)
 +{
 +	
 +	for (UINT v = first; v <= last; v++)
 +	{
 +		// uncheck all the items in the 'radio'
 +		beebwin_SetDlgCheck(hwnd, v, false);
 +	}
 +	// check the selected item
 +	beebwin_SetDlgCheck(hwnd, cmd, true);
 +}
 +
 +
 +void CheckRadioButton(HWND hwndDlg,
 +					  int first,
 +					  int last,
 +					  int checked)
 +{
 +	beebwin_CheckDlgRadioItem( hwndDlg,
 +							   first,
 +							   last,
 +							   checked);
 +}
 +
 +
 +int _vscprintf (const char * format, va_list pargs) {
 +	int retval;
 +	va_list argcopy;
 +	va_copy(argcopy, pargs);
 +	retval = vsnprintf(NULL, 0, format, argcopy);
 +	va_end(argcopy);
 +	return retval;
 + }
 +int vsprintf_s(char* f, int l, const char * format, va_list pargs)
 +{
 +	return vsnprintf(f,l,format,pargs);
 +}
 +
 +char* _strerror(const char *strErrMsg)
 +{
 +	static char errorstring[256];
 +	if (strErrMsg != NULL)
 +		sprintf(errorstring, "%s : %s", strErrMsg, strerror(errno));
 +	else
 +		sprintf(errorstring, "%s\n", strerror(errno));
 +	return errorstring;
 +}
 +
 +int SendMessage(HWND w, int a, size_t b, long c)
 +{
 +	return 0;
 +}
 +void DestroyWindow(HWND w)
 +{}
 +
 +void GetWindowRect(HWND h, RECT* r)
 +{
 +}
 +
++bool EnableWindow(HWND h, BOOL e)
++{
++    return true;
++}
++
 +#include "FileUtils.h"
 +
 +void _splitpath(const char *path,
 +				char *drive,
 +				char *dir,
 +				char *fname,
 +				char *ext)
 +{
 +	char d[300];
 +	char n[300];
 +	char e[300];
 +	sscanf(path, "%s/%s.%s", d,n,e);
 +	if (dir)
 +		strcpy(dir, d);
 +	if (fname)
 +		strcpy(fname, n);
 +	if (ext)
 +		strcpy(ext, e);
 +}
 +
 +void _makepath(char *path,
 +			   const char *drive,
 +	  const char *dir,
 +	  const char *fname,
 +	  const char *ext)
 +{
 +	char fpath[_MAX_PATH];
 +	strcpy(fpath, fname);
 +	if (fname && ext)
 +		sprintf(path, "%s/%s.%s", dir,fpath,ext);
 +	else
 +		sprintf(path, "%s/", dir);
 +}
 +
 +//SHFOLDERAPI
 +int SHGetFolderPath(HWND   hwnd,
 +					   int    csidl,
 +					   HANDLE hToken,
 +					   DWORD  dwFlags,
 +					   LPSTR  pszPath)
 +{
 +	if (csidl != CSIDL_PERSONAL)
 +		return 1; //error
 +	
 +	char userDataPath[PATH_MAX];
 +	swift_GetDocumentsDirectory(userDataPath, _MAX_PATH);
 +	// ../Documents/
 +	strcat(userDataPath, "BeebEm/");
 +	// ../Documents/BeebEm/
 +	
 +#if 0 //def DEBUG
 +	// look for path
 +	bool folderFound = FolderExists(userDataPath);
 +	if (folderFound)
 +	{
 +		// during debugging need to always copy the userdata from the Bundle
 +		fprintf(stdout,"*** REMOVING %s SO IT WILL GET A CLEAN COPY ***", userDataPath);
 +		int ret = swift_Remove(userDataPath);
 +		fprintf(stdout,"*** %d ***", ret);
 +	}
 +#endif
 +
 +	strcpy(pszPath, userDataPath);
 +
 +	return S_OK;
 +}
 +
 +LSTATUS RegSetValueEx(
 +HKEY       hKey,
 +LPCSTR     lpValueName,
 +				 DWORD      Reserved,
 +		  DWORD      dwType,
 +		  const BYTE *lpData,
 +		   DWORD      cbData
 +)
 +{
 +	return ERROR_SUCCESS;
 +}
 +LSTATUS RegQueryValueEx(
 +		HKEY    hKey,
 +		LPCSTR  lpValueName,
 +		LPDWORD lpReserved,
 +		LPDWORD lpType,
 +		LPBYTE  lpData,
 +		LPDWORD lpcbData
 +	  )
 +{
 +	std::string val(lpValueName);
 +	if (val.compare("UserDataFolder"))
 +	{
 +		return 1; //error
 +	}
 +	return ERROR_SUCCESS;
 +}
 +LSTATUS RegCreateKeyEx(
 +   HKEY                        hKey,
 +   LPCSTR                      lpSubKey,
 +   DWORD                       Reserved,
 +   LPSTR                       lpClass,
 +   DWORD                       dwOptions,
 +   REGSAM                      samDesired,
 +   const LPSECURITY_ATTRIBUTES lpSecurityAttributes,
 +   PHKEY                       phkResult,
 +   LPDWORD                     lpdwDisposition
 +)
 +{
 +	return ERROR_SUCCESS;
 +}
 +
 +LSTATUS RegOpenKeyEx(
 +   HKEY   hKey,
 +   LPCSTR lpSubKey,
 +   DWORD  ulOptions,
 +   REGSAM samDesired,
 +   PHKEY  phkResult
 +)
 +{
 +	// cannot open keys so
 +	return !ERROR_SUCCESS;
 +}
 +LSTATUS RegCloseKey( HKEY hKey)
 +{
 +	return ERROR_SUCCESS;
 +}
 +
 +DWORD GetModuleFileNameA(
 +   HMODULE hModule,
 +   LPSTR   lpFilename,
 +   DWORD   nSize
 +)
 +{
 +	// get the path of the executable file of the current process.
 +	// return the length of the string
 +	return 0;
 +}
 +
 +
 +int WSAGetLastError()
 +{
 +	return errno;
 +}
 +
 +
 +int MessageBox(HWND m_hWnd, const char* buffer, const char* WindowTitle, int Type) {
 +
 +	int type = Type &0xf;
 +	int button = (Type & 0xf00);
 +	int res = 0;
 +
 +	if (type == MB_ICONERROR ||
 +		type == MB_ICONWARNING ||
 +		type == MB_ICONINFORMATION ||
 +		type == MB_ICONQUESTION )
 +	{
 +		Type = (int)type;
 +		const char* msgtitle[5] {"Error:","Warning:","Info:","Question:"};
 +		const char* buttontitles[3] {"","YesNo:","OKCancel:"};
 +		fprintf(stderr,"%s: %s (%s)",msgtitle[Type],buffer,buttontitles[button]);
 +		
 +		int ret = swift_Report(buffer,msgtitle[Type],button);
 +		if (button == MB_YESNO)
 +		{
 +			res = ret==1?IDYES:IDNO;
 +		}
 +		else if (button == MB_OKCANCEL)
 +		{
 +			res = ret==1?IDOK:IDCANCEL;
 +		}
 +	}
 +
 +	return res;
 +}
 +
 +
 +BOOL SetWindowText(HWND    hWnd, LPTSTR lpString)
 +{
 +	return SetWindowText(hWnd, (LPCSTR) lpString);
 +}
 +
 +BOOL SetWindowText(HWND    hWnd, LPCSTR lpString)
 +{
 +	// set the window title via swift
 +	swift_SetWindowTitleWithCString(lpString);
 +	return true;
 +}
 +
 +bool PathIsRelative(const char * winPathString)
 +{
 +#ifdef HasC17
 +	std::filesystem::path path(winPathString); // Construct the path from a string.
 +
 +	if (path.is_absolute()) {
 +		// Arriving here if winPathString = "C:/tmp".
 +		return false;
 +	}
 +	if (path.is_relative()) {
 +		// Arriving here if winPathString = "".
 +		// Arriving here if winPathString = "tmp".
 +		// Arriving here in windows if winPathString = "/tmp". (see quote below)
 +		return true;
 +	}
 +#else
 +	if (winPathString[0] != '/')
 +		// this is relative address as first character is NOT '/'
 +		return true;
 +#endif
 +
 +	return false;
 +}
 +
 +
 +void SetMenu(HWND w, bool s)
 +{
 +	
 +}
 +
 +
 +DWORD CheckMenuItem( HMENU hMenu,  UINT  uIDCheckItem,UINT  uCheck)
 +{
 +	swift_SetMenuCheck(ConvRC2ID(uIDCheckItem), uCheck);
 +	return uCheck;   // should be the previous value of this item
 +}
 +
 +
 +DWORD EnableMenuItem(  HMENU hMenu,  UINT  uIDCheckItem,UINT  uEnable)
 +{
 +	swift_SetMenuEnable(ConvRC2ID(uIDCheckItem), uEnable);
 +	return uEnable;  // should be the previous value of this item
 +}
 +
 +void _itoa(int i, CHAR* c, int l)
 +{
 +	snprintf(c, l, "%X ",i);
 +}
 +
 +int GetSystemMetrics(int  x)
 +{
 +	// value should never be used
 +	return 0;
 +}
 +
 +void TextToSpeechResetState()
 +{
 +	
 +}
 +
 +HMENU GetMenu(HWND m)
 +{
 +	return 0;
 +}
 +
 +HDC GetDC(HWND m)
 +{
 +	return 0;
 +}
 +
 +void ReleaseDC(HWND m_hWnd, HDC m_hDC)
 +{
 +	
 +}
 +
 +void DeleteObject(HBITMAP x)
 +{
 +	
 +}
 +
 +void DeleteDC(HDC m_hDCBitmap)
 +{
 +
 +}
 +
 +UINT_PTR SetTimer(HWND hWnd, UINT_PTR  nIDEvent, UINT uElapse, TIMERPROC lpTimerFunc) {
 +	
 +	if (mainWin == NULL)
 +		return 0;
 +	
 +	if (mainWin->TIMER_PRINTER == nIDEvent)
 +	{
 +		mainWin->CopyPrinterBufferToClipboard();
 +		return 1;
 +	}
 +	fprintf(stderr, "Trying to set timer %d for %d microsec", nIDEvent, uElapse);
 +	return 0;
 +	
 +}
 +
 +BOOL KillTimer(HWND hWnd, UINT_PTR  nIDEvent) {return 0;}
 +
 +BOOL SetWindowPos( HWND hWnd, HWND hWndInsertAfter,
 +		int  X,int  Y,
 +		int  cx,int  cy,
 +		UINT uFlags
 +				  ) {return false;}
 +
 +HWND SetFocus(HWND focus) {return 0;}
 +
 +
 +
 +LRESULT SendDlgItemMessage(
 +   HWND   hDlg,
 +   int    nIDDlgItem,
 +   UINT   Msg,
 +   WPARAM wParam,
 +   LPARAM lParam
 +)
 +{
 +	
 +	if (Msg == BM_SETCHECK){
 +		swift_SetDlgCheck((Dialogs)*hDlg, nIDDlgItem, wParam);
 +//	e.g. 	hwndTapeControl, IDC_TAPE_CONTROL_UNLOCK
 +//	e.g. 	Modals::tapeControl, 'tcul'
 +	}
 +
 +	return 0;
 +}
 +
 +void SetDlgItemText(int nID, const std::string& str)
 +{
 +	swift_SetDlgItemText(Modals::serialPort, ConvRC2ID(nID), str.c_str());
 +}
 +
 +
 +
 +BOOL SetDlgItemText(
 +  HWND   hDlg,
 +  int    nIDDlgItem,
 +  LPCSTR lpString
 +)
 +{
 +	return swift_SetDlgItemText((Dialogs)*hDlg, ConvRC2ID(nIDDlgItem), lpString);
 +}
 +
 +UINT GetDlgItemText(
 +   HWND  hDlg,
 +   int   nIDDlgItem,
 +  LPSTR lpString,
 +	int   cchMax
 +)
 +{
 +	bool ok = swift_GetDlgItemText((Dialogs)*hDlg, ConvRC2ID(nIDDlgItem), lpString, cchMax);
 +	return ok;
 +}
 +
 +HWND GetDlgItem(
 +  HWND hDlg,
 +  int  nIDDlgItem
 +)
 +{
 +	return hDlg;
 +}
 +
 +
 +HWND GetFocus()
 +{
 +	return 0;
 +}
 +
 +
 +int WSACleanup()
 +{
 +	return 0;
 +}
 +
 +void SetEvent(HANDLE)
 +{
 +	
 +}
 +
 +
 +void FreeLibrary(HMODULE)
 +{
 +	
 +}
 +
 +bool GetFullPathName(const char* c, int l, const char* p, char** f)
 +{
 +	return 0;
 +}
 +
 +void PathCanonicalize(const char* c, const char* p)
 +{
 +	
 +}
 +
 +void GetClientRect(HWND h, RECT* r){}
 +void InvalidateRect(HWND h, RECT* r, bool b){}
 +DWORD GetWindowLong(HWND wnd, long s){return 0;}
 +void SetWindowLong(HWND m_hWnd, int f, DWORD s){}
 +
 +
 +
 +void MoveWindow(HWND m_hWnd, int x, int y, int w, int h, bool b){}
 +void ShowWindow(HWND m_hWnd, int x){}
 +void RemoveMenu(HWND w, int a, int b){}
 +
 +
 +#include <queue>
 +#include <mutex>
 +
 +
 +extern std::queue< std::tuple<UINT,int,long> > buffer;
 +extern std::mutex mtx;
 +
 +void PostMessage(HWND wnd, int s, int t, long l)
 +{
 +	switch (s)
 +	{
 +		case WM_IP232_ERROR:
 +		{
 +			auto i = std::tuple<UINT,int,long>{s,t,l};
 +			std::lock_guard<std::mutex> lock(mtx);
 +			buffer.push(i);
 +		}
 +			break;
 +		default:
 +			break;
 +	}
 +}
 +void ShellExecute(HWND m_hWnd, void* a, char* p, void* b, void* c, int f){}
 +
 +
 +int SHCreateDirectoryEx(void* a, const char* f, void *b)
 +{
 +	// checked if Application Support/BeebEm/UserData exists
 +	// it doesn't so create it and copy the files
 +	mode_t mode = 0755;
 +	mkdir(f, mode);
 +	return ERROR_SUCCESS;
 +}
 +
 +extern int_fast32_t m_RGB32[256];
 +extern int_fast16_t m_RGB16[256];
 +
 +
 +HGDIOBJ SelectObject(HDC hdc, HGDIOBJ ppvBits)
 +{
 +	return (HGDIOBJ)1;
 +}
 +
 +
 +HGDIOBJ CreateDIBSection(HDC hdc, const BITMAPINFO *pbmi,
 +							   UINT usage, void **ppvBits,
 +							   int hSection, DWORD offset)
 +{
 +
 +	*ppvBits = (char *)calloc(pbmi->bmiHeader.biSizeImage,1);
 +
 +	fprintf(stderr, "Base Address = %08lx\n", (unsigned long) ppvBits);
 +	
 +	// just in case usage ever changes
 +	int COLS = 64;
 +	if (usage==DIB_RGB_COLORS)
 +		COLS = 64;
 +	
 +	for (int i = 0; i < COLS + 4; ++i)
 +	{
 +	  m_RGB32[i] = ((( ((pbmi->bmiColors[i].rgbRed) << 8)  + (pbmi->bmiColors[i].rgbGreen )) << 8) + (pbmi->bmiColors[i].rgbBlue));
 +	  m_RGB32[i] |= 0xff000000;
 +
 +	  m_RGB16[i] = ((( ((pbmi->bmiColors[i].rgbRed >> 3) << 5)  + (pbmi->bmiColors[i].rgbGreen >> 3)) << 5) + (pbmi->bmiColors[i].rgbBlue >> 3));
 +
 +	//      printf("RGB32[%d] = %08x, RGB16[%d] = %04x\n", i, m_RGB32[i], i, m_RGB16[i]);
 +
 +	}
 +	
 +	return (HGDIOBJ)1;
 +}
 +
 +bool SHFileOperation(SHFILEOPSTRUCT* a)
 +{
 +	if (a->wFunc == FO_COPY)
 +	{
 +		// using SWIFT Foundation to copy all the files in pFrom
 +		a->fAnyOperationsAborted = false;
 +		bool res = swift_CopyDirectoryRecursively(a->pFrom, a->pTo);
 +		if (!res)
 +		{
 +			return 1; //error
 +		}
 +	}
 +	return ERROR_SUCCESS;
 +}
 +void GetMonitorInfo(HMONITOR monitor, MONITORINFO* info){}
 +HMONITOR MonitorFromWindow(HWND wnd, int s){return 0L;}
 +
 +MMRESULT joySetCapture(HWND Wnd, int jid, int v, bool f)
 +{
 +	swift_JoystickCapture();
 +	return JOYERR_NOERROR;
 +}
 +MMRESULT joyGetDevCaps(int jid, JOYCAPS* jc, int l)
 +{
 +	jc->wXmin = 0;
 +	jc->wYmin = 0;
 +	jc->wXmax = 65536;
 +	jc->wYmax = 65536;
 +	return JOYERR_NOERROR;
 +}
 +
 +void* std_ThreadFunc(void* parameter)
 +{
 +	Thread* pThread = reinterpret_cast<Thread*>(parameter);
 +	long res = (long)pThread->ThreadFunc();
 +	return (void *)res;
 +}
 +
 +
 +void InitializeCriticalSection(int*){}
 +void EnterCriticalSection(int*){}
 +void LeaveCriticalSection(int*){}
 +void DeleteCriticalSection(int*){}
 +
 +int GetCurrentThreadId() {return 0;}
 +
 +HHOOK SetWindowsHookEx(
 +  int       idHook,
 +  HOOKPROC  lpfn,
 +  HINSTANCE hmod,
 +  DWORD     dwThreadId
 +)
 +{
 +	return 0;
 +}
 +BOOL UnhookWindowsHookEx(
 +  HHOOK hhk
 +)
 +{
 +	return 0;
 +}
 +
 +LRESULT CallNextHookEx(
 +   HHOOK  hhk,
 +   int    nCode,
 +   WPARAM wParam,
 +   LPARAM lParam
 +)
 +{
 +	return 0;
 +}
diff --cc XCode/Project/Src/apples.h
index 989d560,0000000..07cbf8e
mode 100644,000000..100644
--- a/XCode/Project/Src/apples.h
+++ b/XCode/Project/Src/apples.h
@@@ -1,771 -1,0 +1,780 @@@
 +//
 +//  apples.h
 +//  BeebEm
 +//
 +//  Created by Commander Coder on 01/04/2024.
 +//
 +
 +#ifndef apples_h
 +#define apples_h
 +
 +
 +#include <stdio.h>
 +#include <stdint.h>
 +
 +#include <string> // c++ std::string
 +
 +#include <sys/syslimits.h>
 +#include <sys/types.h>
 +#include <sys/stat.h>
 +#include <unistd.h>
 +
 +#include "appleKeyCodes.h"
 +
 +
 +typedef uint32_t DWORD;   // DWORD = unsigned 32 bit value
 +typedef uint16_t WORD;    // WORD = unsigned 16 bit value
 +typedef uint8_t BYTE;     // BYTE = unsigned 8 bit value
 +
 +typedef uint32_t LONG;   // LONG = unsigned 32 bit value
 +typedef uint32_t UINT;   // UINT = unsigned 32 bit value
 +typedef uint32_t UINT32; // UINT32 = unsigned 32 bit value
 +typedef uint8_t UINT8;   // UINT8 = unsigned 8 bit value
 +typedef int32_t INT;     // INT = signed 32 bit value
 +typedef int16_t INT16;   // INT16 = signed 16 bit value
 +
 +typedef float FLOAT;
 +
 +typedef uint32_t ULONG_PTR;
 +typedef ULONG_PTR DWORD_PTR;
 +
 +
 +#define BOOL bool
 +
 +
 +typedef uint32_t UINT_PTR; //
 +typedef uint32_t* HWND; //  typedef uint32_t*
 +typedef uint32_t* HINSTANCE; //
 +typedef uint32_t* HMODULE; //
 +typedef uint32_t* HDC; //
 +typedef uint32_t* HACCEL; //
 +typedef uint32_t HRESULT; //
 +typedef uint32_t LRESULT; //
 +typedef uint32_t MMRESULT; //
 +typedef uint32_t HMONITOR; //
 +
 +typedef uint32_t* WNDPROC; //
 +typedef uint32_t* TIMERPROC; //
 +typedef uint32_t* HANDLE; //
 +typedef HANDLE HKEY;
 +typedef long LPARAM;
 +typedef long WPARAM; //
 +typedef uint32_t* HGDIOBJ; //
 +typedef uint32_t* HMENU; //
 +typedef uint32_t* HBITMAP; //
 +typedef HANDLE HHOOK;
++typedef int32_t INT_PTR; //
++
 +
 +#define CALLBACK /**/
 +int GetCurrentThreadId();
 +#define WH_CBT 5
 +#define HCBT_ACTIVATE 5
 +typedef LRESULT (*HOOKPROC)(int nCode, WPARAM wParam, LPARAM lParam);
 +
 +HHOOK SetWindowsHookEx(
 +  int       idHook,
 +  HOOKPROC  lpfn,
 +  HINSTANCE hmod,
 +  DWORD     dwThreadId
 +);
 +
 +BOOL UnhookWindowsHookEx(
 +  HHOOK hhk
 +);
 +LRESULT CallNextHookEx(
 +   HHOOK  hhk,
 +   int    nCode,
 +   WPARAM wParam,
 +   LPARAM lParam
 +);
 +typedef struct tagPOINT {
 +  LONG x;
 +  LONG y;
 +} POINT, *PPOINT, *NPPOINT, *LPPOINT;
 +
 +#define CSIDL_PERSONAL -1
 +#define SHGFP_TYPE_CURRENT -1
 +
 +typedef int CRITICAL_SECTION;
 +extern void InitializeCriticalSection(int*);
 +extern void EnterCriticalSection(int*);
 +extern void LeaveCriticalSection(int*);
 +extern void DeleteCriticalSection(int*);
 +
 +#define HKEY_CURRENT_USER NULL
 +#define CFG_REG_KEY NULL
 +#define NOERROR 0
 +#define S_OK 0
 +#define ERROR_SUCCESS 0
 +#define KEY_ALL_ACCESS -1
 +#define REG_SZ 4
 +#define REG_BINARY 3
 +typedef unsigned char BYTE;
 +typedef BYTE *PBYTE;
 +typedef BYTE *LPBYTE;
 +//typedef CHAR *LPSTR;
 +typedef char *LPSTR;
 +//typedef __nullterminated CONST CHAR *LPCSTR;
 +typedef const char *LPCSTR;
 +#define LPTSTR char *
++#define LPCTSTR const char *
++
 +
 +typedef char REGSAM;
 +typedef char LPSECURITY_ATTRIBUTES;
 +typedef HKEY *PHKEY;
 +typedef DWORD *LPDWORD;
 +
 +typedef uint32_t LSTATUS; //
 +LSTATUS RegSetValueEx(
 +HKEY       hKey,
 +LPCSTR     lpValueName,
 +				 DWORD      Reserved,
 +          DWORD      dwType,
 +          const BYTE *lpData,
 +           DWORD      cbData
 +);
 +LSTATUS RegQueryValueEx(
 +		HKEY    hKey,
 +		LPCSTR  lpValueName,
 +		LPDWORD lpReserved,
 +		LPDWORD lpType,
 +		LPBYTE  lpData,
 +		LPDWORD lpcbData
 +	  );
 +LSTATUS RegCloseKey( HKEY hKey);
 +LSTATUS RegCreateKeyEx(
 +   HKEY                        hKey,
 +   LPCSTR                      lpSubKey,
 +   DWORD                       Reserved,
 +   LPSTR                       lpClass,
 +   DWORD                       dwOptions,
 +   REGSAM                      samDesired,
 +   const LPSECURITY_ATTRIBUTES lpSecurityAttributes,
 +   PHKEY                       phkResult,
 +   LPDWORD                     lpdwDisposition);
 +LSTATUS RegOpenKeyEx(
 +   HKEY   hKey,
 +   LPCSTR lpSubKey,
 +   DWORD  ulOptions,
 +   REGSAM samDesired,
 +   PHKEY  phkResult
 +);
 +
 +typedef uint32_t* ISpVoice;//
 +typedef uint32_t ISpObjectToken;//
 +typedef wchar_t WCHAR;//
 +typedef uint32_t TCHAR;//
 +
 +DWORD GetModuleFileName(
 +   HMODULE hModule,
 +   LPSTR   lpFilename,
 +   DWORD   nSize
 +);
 +
 +typedef struct joycaps_tag {
 +  WORD wMid;
 +  WORD wPid;
 +//  char szPname[MAXPNAMELEN];
 +  UINT wXmin;
 +  UINT wXmax;
 +  UINT wYmin;
 +  UINT wYmax;
 +  UINT wZmin;
 +  UINT wZmax;
 +  UINT wNumButtons;
 +  UINT wPeriodMin;
 +  UINT wPeriodMax;
 +  UINT wRmin;
 +  UINT wRmax;
 +  UINT wUmin;
 +  UINT wUmax;
 +  UINT wVmin;
 +  UINT wVmax;
 +  UINT wCaps;
 +  UINT wMaxAxes;
 +  UINT wNumAxes;
 +  UINT wMaxButtons;
 +//  char szRegKey[MAXPNAMELEN];
 +//  char szOEMVxD[MAX_JOYSTICKOEMVXDNAME];
 +} JOYCAPS, *PJOYCAPS, *NPJOYCAPS, *LPJOYCAPS;
 +
 +#define JOYERR_NOERROR -1
 +#define JOYERR_UNPLUGGED 2
 +#define JOYSTICKID1 1
 +MMRESULT joySetCapture(HWND Wnd, int jid, int v, bool f);
 +MMRESULT joyGetDevCaps(int jid, JOYCAPS* jc, int l);
 +
 +
 +
 +
 +typedef struct tagBITMAPINFOHEADER {
 +  DWORD biSize;
 +  LONG  biWidth;
 +  LONG  biHeight;
 +  WORD  biPlanes;
 +  WORD  biBitCount;
 +  DWORD biCompression;
 +  DWORD biSizeImage;
 +  LONG  biXPelsPerMeter;
 +  LONG  biYPelsPerMeter;
 +  DWORD biClrUsed;
 +  DWORD biClrImportant;
 +} BITMAPINFOHEADER, *LPBITMAPINFOHEADER, *PBITMAPINFOHEADER;
 +
 +typedef struct tagRGBQUAD {
 +  BYTE rgbBlue;
 +  BYTE rgbGreen;
 +  BYTE rgbRed;
 +  BYTE rgbReserved;
 +} RGBQUAD;
 +
 +
 +// from Carbon
 +struct RECT {
 +  short               top;
 +  short               left;
 +  short               bottom;
 +  short               right;
 +};
 +typedef struct RECT                     RECT;
 +
 +
 +#define GWL_STYLE -1
 +#define MONITOR_DEFAULTTONEAREST -1
 +HMONITOR MonitorFromWindow(HWND wnd, int s);
 +typedef struct tagMONITORINFO {
 +  DWORD cbSize;
 +  RECT  rcMonitor;
 +  RECT  rcWork;
 +  DWORD dwFlags;
 +} MONITORINFO, *LPMONITORINFO;
 +
 +void GetMonitorInfo(HMONITOR monitor, MONITORINFO* info);
 +
 +#define _MAX_PATH PATH_MAX
 +#define MAX_PATH PATH_MAX
 +#define _MAX_DRIVE 32
 +#define _MAX_DIR 512
 +#define _MAX_FNAME 96
 +#define _MAX_EXT 32
 +#define u_short uint16_t
 +
 +#define CHAR char
 +#define WM_APP 0
 +
 +#define EXPORT ;
 +
 +#define ZeroMemory(Destination,Length) RtlZeroMemory((Destination),(Length))
 +#define RtlZeroMemory(Destination,Length) memset((Destination),0,(Length))
 +
 +#define SYSTEMTIME struct tm
 +void GetLocalTime(SYSTEMTIME* _t);
 +#define wYear tm_year
 +#define wMonth tm_mon
 +#define wDay tm_mday
 +#define wHour tm_hour
 +#define wMinute tm_min
 +#define wSecond tm_sec
 +#define wMilliseconds tm_sec // no milliseconds
 +#define wDayOfWeek tm_wday
 +
 +// ECONET
 +#include <netdb.h>
 +#include <arpa/inet.h>
 +#include <sys/socket.h>
 +#include <sys/ioctl.h>
 +#include <sys/select.h>
 +struct in_addr_econet {
 +  union {
 +	struct {
 +	  u_char s_b1;
 +	  u_char s_b2;
 +	  u_char s_b3;
 +	  u_char s_b4;
 +	} S_un_b;
 +	struct {
 +	  u_short s_w1;
 +	  u_short s_w2;
 +	} S_un_w;
 +	in_addr_t S_addr;
 +  } S_un;
 +  u_long s_addr;
 +};
 +typedef unsigned short USHORT;
 +typedef struct in_addr IN_ADDR;
 +
 +#define ioctlsocket ioctl
 +#define closesocket close
 +
 +#define SOCKET int
 +#define INVALID_SOCKET -1
 +#define SOCKET_ERROR -1
 +#define SOCKADDR sockaddr
 +#define WSAEWOULDBLOCK -1
 +#define IPPROTO_UDP             17              /* user datagram protocol */
 +#define INADDR_NONE             0xffffffff              /* -1 return */
 +#define INADDR_ANY              (u_int32_t)0x00000000
 +#define INADDR_BROADCAST        (u_int32_t)0xffffffff   /* must be masked */
 +
 +
 +int WSAGetLastError();
 +
 +
 +#define BYTE __uint8_t
 +#define WORD __uint16_t
 +#define LOBYTE(w) ((BYTE)(w))
 +#define HIBYTE(w) ((BYTE)(((WORD)(w) >> 8) & 0xFF))
 +
 +
 +// used for Files
 +#define _stricmp strcasecmp
 +#define _strnicmp strncasecmp
 +#define stricmp strcasecmp
 +#define strnicmp strncasecmp
 +char* _strerror(const char *strErrMsg);
 +
 +
 +// Serial
 +#define EVENPARITY 1
 +#define ODDPARITY 0
 +#define NOPARITY 2
 +
 +#define LOWORD(l)           ((WORD)(((DWORD_PTR)(l)) & 0xffff))
 +#define HIWORD(l)           ((WORD)((((DWORD_PTR)(l)) >> 16) & 0xffff))
 +#define MAKELPARAM(wLow, wHigh) (((DWORD)wHigh << 16) | ((DWORD)wLow & 0xffff))
 +
 +extern int __argc;
 +extern char** __argv;
 +
 +#define LB_ADDSTRING -1
 +#define LB_INSERTSTRING -1
 +#define LB_DELETESTRING -1
 +#define LB_GETTEXT -1
 +#define EM_SETSEL -1
 +#define LB_GETTEXTLEN -1
 +#define LB_RESETCONTENT -1
 +#define LB_FINDSTRING -1
 +#define LB_ERR -1
++#define LB_SETCURSEL -1
 +int SendMessage(HWND w, int a, size_t b, long c);
 +void DestroyWindow(HWND w);
 +void ModifyMenu(HMENU m_hMenu, UINT pf, UINT flags, UINT_PTR newID, LPCSTR str);
 +
 +// used in BeebMem.h
 +extern DWORD GetTickCount();
 +
 +extern int _vscprintf (const char * format, va_list pargs);
 +int vsprintf_s(char* f, int l, const char * format, va_list pargs);
 +
 +extern void _splitpath(const char *path,
 +				char *drive,
 +				char *dir,
 +				char *fname,
 +				char *ext);
 +extern void _makepath(char *path,
 +					  const char *drive,
 +	   const char *dir,
 +	   const char *fname,
 +	   const char *ext);
 +
 +#define MOVEFILE_REPLACE_EXISTING 0
 +extern void MoveFileEx(const char* dest, const char* orig, DWORD flags);
 +
 +bool PathIsRelative(const char* path);
 +
 +int SHGetFolderPath(HWND   hwnd,
 +					 int    csidl,
 +					 HANDLE hToken,
 +					 DWORD  dwFlags,
 +					 LPSTR  pszPath);
 +
 +template < typename T, int N >
 +int _countof( T ( & arr )[ N ] )
 +{
 +	return std::extent< T[ N ] >::value;
 +}
 +
 +enum Dialogs {
 +   breakoutBox = 256
 +   , tapeControl
 +   , debugWindow
 +   , teletextSelect
 +};
 +
 +enum Modals {
 +   keyboardLinks = 0
 +   , selectKey
 +   , romConfig
 +   , exportFiles
 +   , keyboardMapping
 +   , serialPort
 +};
 +
 +
 +extern "C" bool swift_IsMiniaturized();
 +extern "C" bool swift_JoystickCapture();
 +
 +extern "C" void swift_SetModelText(Modals m, const char* n);
 +extern "C" int swift_GetSelectionMark(Modals m);
 +extern "C" int swift_SetSelectionMark(Modals m, int sel);
 +extern "C" void swift_SetFocus(Modals m);
 +
 +extern "C" void swift_TCSelectItem(long item);
 +extern "C" void swift_TCReload();
 +extern "C" unsigned int swift_TCGetSelected();
 +
 +extern "C" void swift_GetBundleDirectory(const char* bundlePath, int length);
 +extern "C" void swift_GetResourcePath(const char* resourcePath, int length, const char* filename);
 +extern "C" void swift_GetDocumentsDirectory(const char* appPath, int length);
 +
 +extern "C" bool swift_CopyDirectoryRecursively(const char* sourcePath, const char* targetPath);
 +extern "C" void swift_saveScreen(const char * filename);
 +
 +extern "C" bool swift_PListSetValue(const char * value, const char * data);
 +extern "C" const char * swift_PListGetValue(const char * value);
 +
 +
 +extern "C" bool swift_SetMenuCheck(unsigned int cmd, char check);
 +extern "C" bool swift_SetMenuEnable(unsigned int cmd, char enable);
 +extern "C" int swift_SetMenuItemTextWithCString(unsigned int cmd, const char* text);
 +extern "C" int swift_ModifyMenu(unsigned int cmd, unsigned int newitem, const char* itemtext);
 +
 +
 +extern "C" bool swift_SetDlgCheck(unsigned short dlg, unsigned int cmd, char check);
 +extern "C" bool swift_GetDlgCheck(unsigned short dlg, unsigned int cmd);
 +
 +extern "C" bool swift_SetDlgItem(unsigned short dlg, unsigned int cmd, bool enabled);
 +
 +
 +
 +extern "C" bool swift_SetDlgItemText(unsigned short dlg, unsigned int cmd, const char* text);
 +extern "C" bool swift_GetDlgItemText(unsigned short dlg, unsigned int cmd, const char* text, int len);
 +
 +extern "C" int swift_Remove(const char* path);
 +
 +// used in BeebWinDx.h
 +extern "C" void swift_SetWindowTitleWithCString(const char* title);
 +
 +#include "Model.h"
 +enum KB_LEDS { CASS, CAPS, SHIFT, HD0, HD1, HD2, HD3, FD0, FD1 };
 +extern "C" int swift_SetLED(KB_LEDS led, bool on);
 +extern "C" int swift_SetMachineType(Model machinetype);
 +
 +#define SIZE_RESTORED -1
 +#define SIZE_MINIMIZED -1
 +void GetWindowRect(HWND h, RECT* r);
 +void GetClientRect(HWND h, RECT* r);
 +void InvalidateRect(HWND h, RECT* r, bool b);
++bool EnableWindow(HWND h,BOOL bEnable);
 +
 +void CheckRadioButton(HWND hwndDlg,
 +					  int first,
 +					  int last,
 +					  int checked);
 +
 +
 +//#define IDD_SELECT_KEY			Modals::selectKey
 +//#define IDD_USERKYBRD			Modals::keyboardMapping
 +
 +//#define IDD_BREAKOUT			Dialogs::breakoutBox
 +//#define IDD_TAPECONTROL			Dialogs::tapeControl
 +//#define IDD_DEBUG				Dialogs::debugWindow
 +
 +
 +extern "C" int swift_SetCurSel(Modals mod, int m);
 +
 +
 +extern "C" int swift_OpenDialog(Dialogs dlg, void* dialogClass);
 +extern "C" int swift_CloseDialog(Dialogs dlg);
 +extern "C" int swift_DoModal(Modals mod, void* dialogClass);
 +extern "C" int swift_EndModal(bool ok);
 +
 +
 +extern "C" void swift_UKSetAssignedTo(const char* title);
 +extern "C" void swift_buttonSetControlValue(unsigned int cmd, int state);
 +
 +void beebwin_ModifyMenu(
 +						UINT position,
 +						UINT newitem,
 +						LPCSTR newtext);
 +void beebwin_SetMenuCheck(UINT cmd, bool check);
 +void beebwin_CheckMenuRadioItem(UINT first, UINT last, UINT cmd);
 +
 +int beebwin_KeyUpDown(long, long,long);
 +
 +#define WS_POPUP -1
 +#define WS_OVERLAPPEDWINDOW -1
 +#define WIN_STYLE -1
 +#define WM_CLOSE 0x0010
 +#define SW_MAXIMIZE -1
 +#define SW_RESTORE -1
 +#define SW_SHOWNORMAL -1
++
 +DWORD GetWindowLong(HWND wnd, long s);
 +void SetWindowLong(HWND m_hWnd, int f, DWORD s);
 +BOOL SetWindowText(HWND    hWnd, LPCSTR lpString);
 +BOOL SetWindowText(HWND    hWnd, LPTSTR lpString);
 +typedef  enum
 +{
 +  DIB_RGB_COLORS = 0x00,
 +  DIB_PAL_COLORS = 0x01,
 +  DIB_PAL_INDICES = 0x02
 +} DIBColors;
 +#define BI_RGB 255
 +void MoveWindow(HWND m_hWnd, int x, int y, int w, int h, bool b);
 +void ShowWindow(HWND m_hWnd, int x);
 +
 +
 +void PostMessage(HWND wnd, int s, int t, long l);
 +void ShellExecute(HWND m_hWnd, void* a, char* p, void* b, void* c, int f);
 +
 +
 +int SHCreateDirectoryEx(void* a, const char* f, void *b);
 +
 +
 +// delay the next update of the cpu (i.e. Exec6502Instruction) by this accumulation of
 +// this time
 +extern "C" void swift_sleepCPU(unsigned long microseconds);
 +#define Sleep swift_sleepCPU
 +extern "C" void swift_sleepThread(unsigned long microseconds);
 +
 +
 +extern "C" int swift_GetFilesWithPreview (const char *path, int bytes, const char* directory, bool multiFiles, const char *filter);
 +extern "C" int swift_SaveFile (const char *path, int bytes, const char *filter, const char *directory);
 +extern "C" int swift_MoveFile (const char *src, const char *dest );
 +
 +extern "C" int swift_SelectFolder (const char *path, int bytes, const char* title);
 +
 +
 +extern "C" int swift_setPasteboard ( const char* clipboard, long length);
 +extern "C" bool swift_getPasteboard ( char* clipboard, long length);
 +
 +extern "C" void swift_InitExportDialog (char* dfsNames[][6], int max, int columns);
 +extern "C" int swift_SelectedFiles ( int fileSelected[], int max);
 +
 +extern "C" int swift_Report ( const char* message, const char* title, int buttonType);
 +
 +
 +#define MB_ICONERROR 0
 +#define MB_ICONWARNING 1
 +#define MB_ICONINFORMATION 2
 +#define MB_ICONQUESTION 3
 +#define MB_NONE 0x000 //none
 +#define MB_YESNO 0x100
 +#define MB_OKCANCEL 0x200
 +
 +#ifndef IDYES
 +#define IDYES 0x10
 +#define IDNO 0x20
 +#define IDOK 0x30
 +#define IDCANCEL 0x40
 +#endif
 +
 +#define ID_FDC_ACORN                      39901
 +#define ID_FDC_OPUS                       39902
 +#define ID_FDC_WATFORD                    39903
 +
++#define MS_CTS_ON 0x0010
++
 +
 +int MessageBox(HWND m_hWnd, const char* buffer, const char* WindowTitle, int Type);
 +
 +
 +struct bmiData;
 +#define BITMAPINFO bmiData
 +HGDIOBJ SelectObject(HDC hdc, HGDIOBJ ppvBits);
 +HGDIOBJ CreateDIBSection(HDC hdc, const BITMAPINFO *pbmi,
 +							   UINT usage, void **ppvBits,
 +					 int hSection, DWORD offset);
 +
 +
 +void SetMenu(HWND w, bool s);
 +void RemoveMenu(HWND w, int a, int b);
 +#define MF_CHECKED 1
 +#define MF_UNCHECKED 0
 +#define MF_GRAYED 0
 +#define MF_ENABLED 1
 +
 +#define MF_BYCOMMAND -1
 +
 +DWORD CheckMenuItem(  HMENU hMenu,  UINT  uIDCheckItem,UINT  uCheck);
 +DWORD EnableMenuItem(  HMENU hMenu,  UINT  uIDCheckItem,UINT  uEnable);
 +
 +void _itoa(int i, CHAR* c, int l);
 +
 +int GetSystemMetrics(int);
 +#define SM_CXSCREEN 0
 +#define SM_CYSCREEN 0
 +#define SM_CXSIZEFRAME 0
 +#define SM_CYSIZEFRAME 0
 +#define SM_CYMENUSIZE 0
 +#define SM_CYCAPTION 0
 +
 +#define WS_OVERLAPPED 0
 +#define WS_CAPTION 0
 +#define WS_SYSMENU 0
 +#define WS_MINIMIZEBOX 0
 +#define WS_MAXIMIZEBOX 0
 +#define WS_SIZEBOX 0
 +
 +void TextToSpeechResetState();
 +HMENU GetMenu(HWND);
 +HDC GetDC(HWND);
 +
 +void ReleaseDC(HWND m_hWnd, HDC m_hDC);
 +void DeleteObject(HBITMAP x);
 +void DeleteDC(HDC m_hDCBitmap);
 +
 +
 +UINT_PTR SetTimer(HWND hWnd, UINT_PTR  nIDEvent, UINT uElapse, TIMERPROC lpTimerFunc);
 +BOOL KillTimer(HWND hWnd, UINT_PTR  nIDEvent);
 +
 +
 +#define HWND_TOP 0
 +#define SWP_NOSIZE 0
 +#define SWP_NOMOVE 0
 +#define SWP_SHOWWINDOW 0
 +#define SWP_NOACTIVATE 0
 +
 +BOOL SetWindowPos( HWND hWnd, HWND hWndInsertAfter,
 +        int  X,int  Y,
 +		int  cx,int  cy,
 +		UINT uFlags
 +);
 +
 +HWND SetFocus(HWND focus);
 +
 +
 +void CheckMenuRadioItem(HMENU m_hMenu,
 +						UINT first,
 +						UINT last,
 +						UINT cmdSelectedMenuItem,
 +						UINT cmd);
 +
 +
 +#define BM_GETCHECK 0
 +#define BST_CHECKED 1
 +#define BM_SETCHECK 2
 +#define BST_UNCHECKED 3
 +
 +LRESULT SendDlgItemMessage(
 +   HWND   hDlg,
 +   int    nIDDlgItem,
 +   UINT   Msg,
 +   WPARAM wParam,
 +   LPARAM lParam
 +);
 +
 +
 +#define BM_GETCHECK 0
 +#define BST_CHECKED 1
 +#define BM_SETCHECK 2
 +#define BST_UNCHECKED 3
 +
 +BOOL SetDlgItemText(
 +  HWND   hDlg,
 +  int    nIDDlgItem,
 +  LPCSTR lpString
 +);
 +
 +UINT GetDlgItemText(
 +   HWND  hDlg,
 +   int   nIDDlgItem,
 +   LPSTR lpString,
 +    int   cchMax
 +);
 +
 +
 +HWND GetDlgItem(
 +  HWND hDlg,
 +  int  nIDDlgItem
 +);
 +
 +
 +HWND GetFocus();
 +
 +int WSACleanup();
 +
 +void SetEvent(HANDLE);
 +
 +void FreeLibrary(HMODULE);
 +
 +
 +bool GetFullPathName(const char* c, int l, const char* p, char** f);
 +void PathCanonicalize(const char* c, const char* p);
 +
- typedef char* PCZZSTR;//
++typedef const char* PCZZSTR;//
 +typedef uint32_t LPVOID;//
 +typedef uint32_t PCSTR;//
 +typedef uint32_t FILEOP_FLAGS;//
 +#define FO_COPY -1
 +
 +typedef struct _SHFILEOPSTRUCTA {
 +  HWND         hwnd;
 +  UINT         wFunc;
 +  PCZZSTR      pFrom;
 +  PCZZSTR      pTo;
 +  FILEOP_FLAGS fFlags;
 +  BOOL         fAnyOperationsAborted;
 +  LPVOID       hNameMappings;
 +  PCSTR        lpszProgressTitle;
 +} SHFILEOPSTRUCTA, *LPSHFILEOPSTRUCTA, SHFILEOPSTRUCT ;
 +
 +bool SHFileOperation(SHFILEOPSTRUCT* a);
 +
 +
 +extern "C" int swift_ReleaseSoundBuffer(int);
 +extern "C" int swift_CreateSoundBuffer(WORD, DWORD, DWORD, WORD, WORD);
 +extern "C" void swift_StopStream(int);
 +extern "C" void swift_PlayStream(int);
 +extern "C" int  swift_BufferedStreams(int);
 +
 +extern "C" void swift_SoundInit();
 +extern "C" void swift_SubmitStream(int outputType, BYTE* buffer, int size);
 +// index: outputtype 1 = 8 bit, 1 channel, 2 = 16 bit, 2 channel
 +
 +
 +#define WM_COMMAND_def 273
 +
 +#define WM_INPUT 255
 +#define WM_MOUSEMOVE 512
 +#define WM_LBUTTONDOWN 513
 +#define WM_LBUTTONUP 514
 +#define WM_LBUTTONDBLCLK 515
 +#define WM_RBUTTONDOWN 516
 +#define WM_RBUTTONUP 517
 +#define WM_RBUTTONDBLCLK 518
 +#define WM_MBUTTONDOWN 519
 +#define WM_MBUTTONUP 520
 +#define WM_MBUTTONDBLCLK 521
 +
 +
 +#define MM_JOY1MOVE 0x3A0
 +#define MM_JOY2MOVE 0x3A1
 +#define MM_JOY1ZMOVE 0x3A2
 +#define MM_JOY2ZMOVE 0x3A3
 +#define MM_JOY1BUTTONDOWN 0x3B5
 +#define MM_JOY2BUTTONDOWN 0x3B6
 +#define MM_JOY1BUTTONUP 0x3B7
 +#define MM_JOY2BUTTONUP 0x3B8
 +
 +#define JOY_BUTTON1         0x0001
 +#define JOY_BUTTON2         0x0002
 +#define JOY_BUTTON3         0x0004
 +#define JOY_BUTTON4         0x0008
 +
 +
 +#ifndef GET_X_LPARAM
 +#define GET_X_LPARAM(lp)   ((int)(short)LOWORD(lp))
 +#define GET_Y_LPARAM(lp)   ((int)(short)HIWORD(lp))
 +#endif
 +
 +#define MK_LBUTTON 0x001
 +#define MK_RBUTTON 0x002
 +#define MK_MBUTTON 0x010
 +
 +void* std_ThreadFunc(void* parameter);
 +
 +#endif /* apples_h */
